# Lista blanca de or√≠genes separados por espacio
set $allowed_origin "";

# Para cada origen que quieras permitir
if ($http_origin ~* (https://frontend1\.local)) {
    set $allowed_origin $http_origin;
}
if ($http_origin ~* (https://frontend2\.example\.com)) {
    set $allowed_origin $http_origin;
}
if ($http_origin ~* (https://miapp\.otrodominio\.com)) {
    set $allowed_origin $http_origin;
}

# Si es un origen permitido, lo devolvemos
add_header 'Access-Control-Allow-Origin' "$allowed_origin" always;
add_header 'Access-Control-Allow-Credentials' 'true' always;
add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
add_header 'Access-Control-Allow-Headers' 'Authorization, Content-Type, Accept, Origin' always;

# Cabeceras adicionales
add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
add_header X-Content-Type-Options "nosniff";
add_header Referrer-Policy "no-referrer-when-downgrade";
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

proxy_cookie_path / "/; Secure; HttpOnly; SameSite=None";
