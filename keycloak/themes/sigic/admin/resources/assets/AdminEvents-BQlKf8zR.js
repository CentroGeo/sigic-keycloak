import{jsx as e,jsxs as c,Fragment as ye}from"react/jsx-runtime";import{d as J,L as Te,aH as _e,ba as be,cA as fe,aP as ge,bR as Ae,ao as Ce,c8 as Ee,cQ as w,u as Re,a as X,e as ve,l as Oe,j as Ie,bd as ke,aM as Fe,dz as Ne,bm as Pe,au as m,aG as G,aN as Se,aL as d,dA as De,w as Le,aT as we,f as Ge,n as Me,ay as xe,az as M,F as Ue,K as A,N as C,bn as x,bo as U,ai as H,U as I,W as E,Y as y,A as He,h as V,M as Ve,m as Be}from"./main-Dml5vH_M.js";import{useState as u,useMemo as Ke}from"react";import{D as je}from"./DropdownPanel-CdQAMxBj.js";import{a as We}from"./CodeEditor-C7HQ48Ys.js";import{u as ze,F as Ze}from"./useFormatDate-Puc65BKQ.js";import{D as B}from"./DatePicker-CU4S68sS.js";import{p as Je}from"./pickBy-BQkB_pck.js";import{D as Xe,a as K,b as j,c as W}from"./DescriptionListTerm-DCQWux3S.js";const z=38,Ye=({text:t,children:n})=>{const a=t||"",i=a.length>z,T=a.substring(0,z);return i?e(_e,{content:t,children:n(T+"â€¦")}):n(a)},Qe=t=>t.operationType==="DELETE"?!1:t.resourceType==="USER"||t.resourceType==="GROUP_MEMBERSHIP"||t.resourceType==="GROUP"||t.resourceType==="CLIENT"||t.resourceType==="ORGANIZATION"||t.resourceType==="ORGANIZATION_MEMBERSHIP"||t.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||t.resourceType==="CLIENT_SCOPE"||t.resourceType==="AUTH_FLOW"||t.resourcePath?.startsWith("roles-by-id"),qe=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),$e=(t,n)=>{const a=qe.exec(n.resourcePath);if(!a)return console.warn("event didn't contain a valid link",n),"";const i=a[1];return n.resourceType==="CLIENT"||n.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?be({realm:t,clientId:i,tab:n.resourceType==="CLIENT"?"settings":"authorization"}):n.resourceType==="GROUP"?fe({realm:t,id:i}):n.resourceType==="CLIENT_SCOPE"?ge({realm:t,id:i,tab:"settings"}):n.resourceType==="USER"||n.resourceType==="GROUP_MEMBERSHIP"?Ae({realm:t,id:i,tab:"settings"}):n.resourceType==="AUTH_FLOW"?Ce({realm:t,id:i,usedBy:"-"}):n.resourcePath?.startsWith("roles-by-id")?Ee({realm:t,id:i,tab:"details"}):n.resourceType==="ORGANIZATION"?w({realm:t,id:i,tab:"settings"}):n.resourceType==="ORGANIZATION_MEMBERSHIP"?w({realm:t,id:i,tab:"members"}):""},ea=({event:t})=>{const{realm:n}=J();return e(Ye,{text:t.resourcePath,children:a=>Qe(t)?e(Te,{to:$e(n,t),children:a}):e("span",{children:a})})},aa=t=>e(ea,{event:t}),Z=({titleKey:t,onClose:n,children:a})=>{const{t:i}=X();return e(Ve,{variant:Be.medium,title:i(t),isOpen:!0,onClose:n,children:a})},ra=t=>c(Xe,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[t.details&&Object.entries(t.details).map(([n,a])=>c(K,{children:[e(j,{children:n}),e(W,{children:a})]},n)),t.error&&c(K,{children:[e(j,{children:"error"}),e(W,{children:t.error})]},"error")]}),pa=({resourcePath:t})=>{const{adminClient:n}=Re(),{t:a}=X(),{realm:i}=J(),T=ve(),Y=ze(),Q=T.enums?.resourceType,q=T.enums?.operationType,[R,k]=u(0),[$,F]=u(!1),[ee,ae]=u(!1),[re,te]=u(!1),[_,se]=u({}),N={resourceTypes:[],operationTypes:[],resourcePath:t||"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},[p,P]=u(),[ne,oe]=u(),[b,S]=u(),ie={resourceTypes:a("resourceTypes"),operationTypes:a("operationTypes"),resourcePath:a("resourcePath"),dateFrom:a("dateFrom"),dateTo:a("dateTo"),authClient:a("client"),authUser:a("userId"),authRealm:a("realm"),authIpAddress:a("ipAddress")},D=Oe({mode:"onChange",defaultValues:N}),{getValues:v,reset:O,formState:{isDirty:L},control:f}=D;Ie(()=>n.realms.getConfigEvents({realm:i}),r=>{oe(r?.adminEventsEnabled)},[]);function le(r,s){return n.realms.findAdminEvents({resourcePath:t,..._,realm:i,first:r,max:s})}function ce(){F(!1),g()}function de(){O(),g()}function ue(r){const s={...v()};delete s[r],O({...N,...s}),g()}function pe(r,s){const o=v(),l=o[r],h=Array.isArray(l)?l.filter(me=>me!==s):l;O({...o,[r]:h}),g()}function g(){const r=Je(v(),s=>s!==""||Array.isArray(s)&&s.length>0);t&&delete r.resourcePath,se(r),k(R+1)}const he=Ke(()=>b?.representation?ke(JSON.parse(b.representation)):"",[b?.representation]);return c(ye,{children:[p&&e(Z,{titleKey:"auth",onClose:()=>P(void 0),children:c(Fe,{"aria-label":"authData","data-testid":"auth-dialog",variant:Ne.compact,children:[e(Pe,{children:c(m,{children:[e(G,{children:a("attribute")}),e(G,{children:a("value")})]})}),c(Se,{children:[c(m,{children:[e(d,{children:a("realm")}),e(d,{children:p.authDetails?.realmId})]}),c(m,{children:[e(d,{children:a("client")}),e(d,{children:p.authDetails?.clientId})]}),c(m,{children:[e(d,{children:a("user")}),e(d,{children:p.authDetails?.userId})]}),c(m,{children:[e(d,{children:a("ipAddress")}),e(d,{children:p.authDetails?.ipAddress})]})]})]})}),b&&e(Z,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>S(void 0),children:e(We,{readOnly:!0,value:he,language:"json"})}),!ne&&e(De,{type:"adminEvents"}),e(Le,{loader:le,detailColumns:[{name:"details",enabled:r=>r.details!==void 0,cellRenderer:ra}],isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:e(Me,{...D,children:c(xe,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(M,{children:e(je,{buttonText:a("searchForAdminEvent"),setSearchDropdownOpen:F,searchDropdownOpen:$,marginRight:"2.5rem",width:"15vw",children:c(Ue,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[e(A,{label:a("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:e(C,{name:"resourceTypes",control:f,render:({field:r})=>e(x,{className:"keycloak__events_search__type_select","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:a("hide"),collapsedText:a("showRemaining")},variant:U.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>ae(s),selections:r.value,onSelect:s=>{const o=s.toString(),l=r.value.includes(o)?r.value.filter(h=>h!==o):[...r.value,o];r.onChange(l)},onClear:()=>{r.onChange([])},isOpen:ee,"aria-labelledby":"resourceTypes",chipGroupComponent:e(I,{children:r.value.map(s=>e(E,{onClick:o=>{o.stopPropagation(),r.onChange(r.value.filter(l=>l!==s))},children:s},s))}),children:Q?.map(s=>e(H,{value:s,children:s},s))})})}),e(A,{label:a("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:e(C,{name:"operationTypes",control:f,render:({field:r})=>e(x,{className:"keycloak__events_search__type_select","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:a("hide"),collapsedText:a("showRemaining")},variant:U.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>te(s),selections:r.value,onSelect:s=>{const o=s.toString(),l=r.value.includes(o)?r.value.filter(h=>h!==o):[...r.value,o];r.onChange(l)},onClear:()=>{r.onChange([])},isOpen:re,"aria-labelledby":"operationTypes",chipGroupComponent:e(I,{children:r.value.map(s=>e(E,{onClick:o=>{o.stopPropagation(),r.onChange(r.value.filter(l=>l!==s))},children:s},s))}),children:q?.map(s=>e(H,{value:s,children:s},s.toString()))})})}),!t&&e(y,{name:"resourcePath",label:a("resourcePath")}),e(y,{name:"authRealm",label:a("realm")}),e(y,{name:"authClient",label:a("client")}),e(y,{name:"authUser",label:a("userId")}),e(y,{name:"authIpAddress",label:a("ipAddress")}),e(A,{label:a("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(C,{name:"dateFrom",control:f,render:({field:r})=>e(B,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,o)=>r.onChange(o),inputProps:{id:"kc-dateFrom"}})})}),e(A,{label:a("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(C,{name:"dateTo",control:f,render:({field:r})=>e(B,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,o)=>r.onChange(o),inputProps:{id:"kc-dateTo"}})})}),c(He,{children:[e(V,{variant:"primary",onClick:ce,"data-testid":"search-events-btn",isDisabled:!L,children:a("searchAdminEventsBtn")}),e(V,{variant:"secondary",onClick:de,isDisabled:!L,children:a("resetBtn")})]})]})})}),e(M,{children:Object.entries(_).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(_).map(r=>{const[s,o]=r;return s==="resourcePath"&&t?null:e(I,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:ie[s],onClick:()=>ue(s),children:typeof o=="string"?e(E,{isReadOnly:!0,children:o}):o.map(l=>e(E,{onClick:()=>pe(s,l),children:l},l))},s)})})})]})}),actions:[{title:a("auth"),onRowClick:r=>P(r)},{title:a("representation"),onRowClick:r=>S(r)}],columns:[{name:"time",displayKey:"time",cellRenderer:r=>Y(new Date(r.time),Ze)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:aa},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[we(10)]},{name:"",displayKey:"user",cellRenderer:r=>r.authDetails?.userId||""}],emptyState:e(Ge,{message:a("emptyAdminEvents"),instructions:a("emptyAdminEventsInstructions"),primaryActionText:a("refresh"),onPrimaryAction:()=>k(R+1)}),isSearching:Object.keys(_).length>0},R)]})};export{pa as A};
//# sourceMappingURL=AdminEvents-BQlKf8zR.js.map
