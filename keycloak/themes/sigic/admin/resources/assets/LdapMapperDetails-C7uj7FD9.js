import{jsx as a,jsxs as I,Fragment as B}from"react/jsx-runtime";import{u as H,l as G,b as U,d as R,a as Y,V as $,j as z,o as J,B as W,q as V,eZ as L,J as Z,y as Q,D as v,P as X,n as _,Y as D,K as ee,N as ae,bn as te,bo as re,ai as oe,O as ne,A as pe,h as M,p as se}from"./main-Dml5vH_M.js";import{useState as y}from"react";import{u as ie}from"./ConfirmDialog-BN0phSta.js";import{c as de,D as le}from"./DynamicComponents-Cxsqsl9R.js";import{F as ce}from"./FormAccess-Dgk035ov.js";import{V as me}from"./ViewHeader-CnGpO8mW.js";import{u as ue}from"./useParams-Cmi1OAEj.js";import"react-dom";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./KeySelect-Ba6sDuzD.js";import"./MultiLineInput-BnUu5qtj.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./translationFormatter-DtFomvax.js";import"./useLocaleSort-DeXbTEE9.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";function xe(){const{adminClient:l}=H(),p=G(),[i,O]=y(),[c,P]=y(),{id:g,mapperId:o}=ue(),m=U(),{realm:f}=R(),{t:e}=Y(),{addAlert:h,addError:b}=$(),[k,w]=y(!1),[C,x]=y(0),K=()=>x(C+1);z(async()=>{const r=await l.components.listSubComponents({id:g,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const t=await l.components.findOne({id:o});return{components:r,fetchedMapper:t}}return{components:r}},({components:r,fetchedMapper:t})=>{if(O(t),P(r),o!=="new"&&!t)throw new Error(e("notFound"));t&&T(t)},[]);const T=r=>{J(r,p.setValue)},q=async r=>{const t=se(r),n={...t,config:Object.entries(t.config||{}).reduce((u,[N,S])=>(u[N]=Array.isArray(S)?S:[S],u),{})};try{o==="new"?(await l.components.create(n),m(L({realm:f,id:r.parentId,tab:"mappers"}))):await l.components.update({id:o},n),T(n),h(e(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),V.success)}catch(u){b(o==="new"?"mappingCreatedError":"mappingUpdatedError",u)}},F=async r=>{try{const t=await l.userStorageProvider.mappersSync({parentId:i?.parentId||"",id:o,direction:r});h(e("syncLDAPGroupsSuccessful",{result:t.status}))}catch(t){b("syncLDAPGroupsError",t)}K()},[E,j]=ie({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:W.danger,onConfirm:async()=>{try{await l.components.del({id:i.id}),h(e("mappingDeletedSuccess"),V.success),m(L({id:g,realm:f,tab:"mappers"}))}catch(r){b("mappingDeletedError",r)}}}),A=Z({control:p.control,name:"providerId"});if(!c)return a(Q,{});const d=o==="new",s=c.find(r=>r.id===A);return I(B,{children:[a(j,{}),a(me,{titleKey:i?i.name:e("createNewMapper"),dropdownItems:d?void 0:[a(v,{onClick:E,children:e("delete")},"delete"),...s?.metadata.fedToKeycloakSyncSupported?[a(v,{onClick:()=>F("fedToKeycloak"),children:e(s.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...s?.metadata.keycloakToFedSyncSupported?[a(v,{onClick:()=>{F("keycloakToFed")},children:e(s.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},C),a(X,{variant:"light",isFilled:!0,children:a(_,{...p,children:I(ce,{role:"manage-realm",isHorizontal:!0,onSubmit:p.handleSubmit(()=>q(p.getValues())),children:[!d&&a(D,{name:"id",label:e("id"),isDisabled:!0}),a(D,{name:"name",label:e("name"),labelIcon:e("mapperNameHelp"),isDisabled:!d,rules:{required:e("required")}}),a("input",{type:"hidden",defaultValue:d?g:i?i.parentId:"","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),a("input",{type:"hidden",defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper","data-testid":"ldap-mapper-provider-type",...p.register("providerType")}),d?a(ee,{label:e("mapperType"),labelIcon:a(ne,{helpText:s?.helpText?s.helpText:e("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:a(ae,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>a(te,{toggleId:"kc-providerId",typeAheadAriaLabel:e("mapperType"),onToggle:()=>w(!k),isOpen:k,onSelect:t=>{T({providerId:t,...Object.fromEntries(c.find(n=>n.id===t)?.properties.filter(n=>n.type==="List").map(n=>[de(n.name),n.options?.[0]])||[])}),w(!1)},selections:r.value,variant:re.typeahead,"aria-label":e("selectMapperType"),children:c.map(t=>a(oe,{value:t.id,children:t.id},t.id))})})}):a(D,{name:"providerId",label:e("mapperType"),labelIcon:s?.helpText?s.helpText:e("mapperTypeHelp"),rules:{required:e("required")},isDisabled:!d}),!!A&&a(le,{properties:s?.properties}),I(pe,{children:[a(M,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:e("save")}),a(M,{variant:"link",onClick:()=>m(d?-1:`/${f}/user-federation/ldap/${i.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:e("cancel")})]})]})})})]})}export{xe as default};
//# sourceMappingURL=LdapMapperDetails-C7uj7FD9.js.map
