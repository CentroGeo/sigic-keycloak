import{jsxs as o,Fragment as x,jsx as e}from"react/jsx-runtime";import{u as ae,a as P,d as V,l as re,j as ne,dA as ie,w as le,aT as oe,f as ce,L as de,bR as me,dB as E,I as pe,aH as ue,n as he,ay as ye,az as S,F as ve,Y as b,K as _,N as g,bn as fe,bo as be,ai as _e,U as w,W as F,A as ge,h as N}from"./main-Dml5vH_M.js";import{useState as d}from"react";import{D as Fe}from"./DropdownPanel-CdQAMxBj.js";import{u as ke,F as Te}from"./useFormatDate-Puc65BKQ.js";import{u as Ce}from"./useLocaleSort-DeXbTEE9.js";import"./AdminEvents-BQlKf8zR.js";import{W as De}from"./warning-triangle-icon-DjlHdM0O.js";import{p as Ae}from"./pickBy-BQkB_pck.js";import{D as O}from"./DatePicker-CU4S68sS.js";import{D as Ie,a as L,b as R,c as U}from"./DescriptionListTerm-DCQWux3S.js";const Ee=a=>a.error?e(ue,{content:a.error,children:o("span",{children:[e(E,{status:"warning",children:e(De,{})}),a.type]})}):o("span",{children:[e(E,{status:"success",children:e(pe,{})}),a.type]}),Se=a=>o(Ie,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[a.details&&Object.entries(a.details).map(([i,c])=>o(L,{children:[e(R,{children:i}),e(U,{children:c})]},i)),a.error&&o(L,{children:[e(R,{children:"error"}),e(U,{children:a.error})]},"error")]}),we=a=>{const{t:i}=P(),{realm:c}=V();return o(x,{children:[a.userId&&e(de,{to:me({realm:c,id:a.userId,tab:"settings"}),children:a.userId},`link-${a.time}-${a.type}`),!a.userId&&i("noUserDetails")]})},$e=({user:a,client:i})=>{const{adminClient:c}=ae(),{t:r}=P(),j=Ce(),{realm:k}=V(),B=ke(),[u,T]=d(0),[K,C]=d(!1),[G,$]=d(!1),[W,z]=d(),[H,M]=d(),[m,Y]=d({}),D={client:i||"",dateFrom:"",dateTo:"",user:a||"",type:[],ipAddress:""},q={client:r("client"),dateFrom:r("dateFrom"),dateTo:r("dateTo"),user:r("userId"),type:r("eventType"),ipAddress:r("ipAddress")},A=re({mode:"onChange",defaultValues:D}),{getValues:h,reset:y,formState:{isDirty:I},control:v,handleSubmit:J}=A;ne(()=>c.realms.getConfigEvents({realm:k}),s=>{M(s?.eventsEnabled),z(j(s?.enabledEventTypes||[],t=>t))},[]);function Q(s,t){return c.realms.findEvents({client:i,user:a,...m,realm:k,first:s,max:t})}function X(){C(!1),p()}function Z(){y(),p()}function ee(s){const t={...h()};delete t[s],y({...D,...t}),p()}function se(s,t){const n=h(),l=n[s],f=Array.isArray(l)?l.filter(te=>te!==t):l;y({...n,[s]:f}),p()}function p(){const s=Ae(h(),t=>t!==""||Array.isArray(t)&&t.length>0);a&&delete s.user,i&&delete s.client,Y(s),T(u+1)}return o(x,{children:[!H&&e(ie,{type:"userEvents"}),e(le,{loader:Q,detailColumns:[{name:"details",enabled:s=>s.details!==void 0,cellRenderer:Se}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:e(he,{...A,children:o(ye,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(S,{children:e(Fe,{buttonText:r("searchUserEventsBtn"),setSearchDropdownOpen:C,searchDropdownOpen:K,marginRight:"2.5rem",width:"15vw",children:o(ve,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:J(X),isHorizontal:!0,children:[!a&&e(b,{name:"user",label:r("userId"),"data-testid":"userId-searchField"}),e(_,{label:r("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:e(g,{name:"type",control:v,render:({field:s})=>e(fe,{className:"keycloak__events_search__type_select","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:r("hide"),collapsedText:r("showRemaining")},variant:be.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:t=>$(t),selections:s.value,onSelect:t=>{const n=t.toString(),l=s.value.includes(n)?s.value.filter(f=>f!==n):[...s.value,n];s.onChange(l)},onClear:()=>{s.onChange([])},isOpen:G,"aria-labelledby":"eventType",chipGroupComponent:e(w,{children:s.value.map(t=>e(F,{onClick:n=>{n.stopPropagation(),s.onChange(s.value.filter(l=>l!==t))},children:r(`eventTypes.${t}.name`)},t))}),children:W?.map(t=>e(_e,{value:t,children:r(`eventTypes.${t}.name`)},t))})})}),!i&&e(b,{name:"client",label:r("client"),"data-testid":"client-searchField"}),e(_,{label:r("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(g,{name:"dateFrom",control:v,render:({field:s})=>e(O,{className:"pf-v5-u-w-100",value:s.value,onChange:(t,n)=>s.onChange(n),inputProps:{id:"kc-dateFrom"}})})}),e(_,{label:r("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(g,{name:"dateTo",control:v,render:({field:s})=>e(O,{className:"pf-v5-u-w-100",value:s.value,onChange:(t,n)=>s.onChange(n),inputProps:{id:"kc-dateTo"}})})}),e(b,{name:"ipAddress",label:r("ipAddress"),"data-testid":"ipAddress-searchField"}),o(ge,{children:[e(N,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!I,children:r("searchUserEventsBtn")}),e(N,{variant:"secondary",onClick:Z,isDisabled:!I,children:r("resetBtn")})]})]})})}),e(S,{children:Object.entries(m).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(m).map(s=>{const[t,n]=s;return t==="user"&&a||t==="client"&&i?null:e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:q[t],onClick:()=>ee(t),isClosable:!0,children:typeof n=="string"?e(F,{isReadOnly:!0,children:n}):n.map(l=>e(F,{onClick:()=>se(t,l),children:r(`eventTypes.${l}.name`)},l))},t)})})})]})}),columns:[{name:"time",displayKey:"time",cellRenderer:s=>B(new Date(s.time),Te)},...a?[]:[{name:"userId",cellRenderer:we}],{name:"type",displayKey:"eventType",cellRenderer:Ee},{name:"ipAddress",displayKey:"ipAddress",transforms:[oe(10)]},...i?[]:[{name:"clientId",displayKey:"client"}]],emptyState:e(ce,{message:r("emptyUserEvents"),instructions:r("emptyUserEventsInstructions"),primaryActionText:r("refresh"),onPrimaryAction:()=>T(u+1)}),isSearching:Object.keys(m).length>0},u)]})};export{$e as U};
//# sourceMappingURL=UserEvents-D0ZF_c1b.js.map
