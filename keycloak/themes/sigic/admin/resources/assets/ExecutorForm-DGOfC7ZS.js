import{jsxs as u,Fragment as R,jsx as o}from"react/jsx-runtime";import{u as J,a as Q,b as U,V as W,e as X,l as Y,j as Z,P as _,K as $,N as ee,bn as te,bo as oe,ai as re,O as S,n as ae,A as ce,h as g,L as k,ep as h,q as se}from"./main-Dml5vH_M.js";import{useState as l}from"react";import{D as ie}from"./DynamicComponents-Cxsqsl9R.js";import{F as ne}from"./FormAccess-Dgk035ov.js";import{V as le}from"./ViewHeader-CnGpO8mW.js";import{u as F}from"./useParams-Cmi1OAEj.js";import"react-dom";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./KeySelect-Ba6sDuzD.js";import"./MultiLineInput-BnUu5qtj.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./translationFormatter-DtFomvax.js";import"./useLocaleSort-DeXbTEE9.js";import"./ConfirmDialog-BN0phSta.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";const I={config:{},executor:""};function Ne(){const{adminClient:P}=J(),{t:c}=Q(),C=U(),{realm:d,profileName:i}=F(),{executorName:n}=F(),{addAlert:A,addError:N}=W(),[O,T]=l(!1),p=X().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[m,H]=l([]),[D,G]=l([]),[v,L]=l([]),[j,B]=l([]),f=Y({defaultValues:I}),{control:q,reset:y,handleSubmit:w}=f,a=!!n,E=e=>{const r=e.find(s=>s.name===i)?.executors?.find(s=>s.executor===n);r&&y({config:r.configuration})};Z(()=>P.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{L(e.globalProfiles),B(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const K=async()=>{const e=f.getValues(),t=j.map(r=>{if(r.name!==i)return r;const s=(r.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(a){const V=r.executors.find(M=>M.executor===n);V.configuration={...V.configuration,...e.config}}return a?r:{...r,executors:s}});try{await P.clientPolicies.createProfiles({profiles:t,globalProfiles:v}),A(c(a?"updateExecutorSuccess":"addExecutorSuccess"),se.success),C(h({realm:d,profileName:i}))}catch(r){N(a?"updateExecutorError":"addExecutorError",r)}},x=v.find(e=>e.name===i),b=p?.find(e=>e.id===n),z=b?.properties.map(e=>{const t=a?e.defaultValue:"";return{...e,defaultValue:t}});return u(R,{children:[o(le,{titleKey:a?n:c("addExecutor"),divider:!0}),u(_,{variant:"light",children:[u(ne,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",isReadOnly:!!x,children:[o($,{label:c("executorType"),fieldId:"kc-executorType",labelIcon:m.length>0&&m[0].helpText!==""?o(S,{helpText:m[0].helpText,fieldLabelId:"executorTypeHelpText"}):a?o(S,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:o(ee,{name:"executor",defaultValue:"",control:q,render:({field:e})=>o(te,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:t=>T(t),onSelect:t=>{y({...I,executor:t.toString()});const r=p?.filter(s=>s.id===t);H(r??[]),G(r?.[0].properties??[]),T(!1)},selections:a?n:e.value,variant:oe.single,"data-testid":"executorType-select","aria-label":c("executorType"),isOpen:O,maxHeight:580,isDisabled:a,children:p?.map(t=>o(re,{"data-testid":t.id,selected:t.id===e.value,value:t.id,description:t.helpText,children:t.id},t.id))})})}),o(ae,{...f,children:o(ie,{properties:a?z:D})}),!x&&u(ce,{children:[o(g,{variant:"primary",onClick:()=>w(K)(),"data-testid":"addExecutor-saveBtn",children:c(a?"save":"add")}),o(g,{variant:"link",component:e=>o(k,{...e,to:h({realm:d,profileName:i})}),"data-testid":"addExecutor-cancelBtn",children:c("cancel")})]})]}),a&&x&&o("div",{className:"kc-backToProfile",children:o(g,{component:e=>o(k,{...e,to:h({realm:d,profileName:i})}),variant:"primary",children:c("back")})})]})]})}export{Ne as default};
//# sourceMappingURL=ExecutorForm-DGOfC7ZS.js.map
