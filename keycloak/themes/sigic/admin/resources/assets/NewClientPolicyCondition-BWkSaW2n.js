import{jsxs as f,Fragment as z,jsx as e}from"react/jsx-runtime";import{u as $,a as J,V as M,b as Q,d as U,c as W,e as X,l as Y,j as Z,P as _,K as ii,N as oi,bn as ni,bo as ei,ai as ti,O as si,n as ai,A as ri,h as g,em as P,L as ci,q as di}from"./main-Dml5vH_M.js";import{useState as r}from"react";import{D as li}from"./DynamicComponents-Cxsqsl9R.js";import{F as pi}from"./FormAccess-Dgk035ov.js";import{V as mi}from"./ViewHeader-CnGpO8mW.js";import{c as I}from"./camelCase-CfPy5VTc.js";import"react-dom";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./KeySelect-Ba6sDuzD.js";import"./MultiLineInput-BnUu5qtj.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./translationFormatter-DtFomvax.js";import"./useLocaleSort-DeXbTEE9.js";import"./ConfirmDialog-BN0phSta.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";import"./capitalize-BoQP_j-K.js";import"./_baseSlice-F8doVSIJ.js";function Hi(){const{adminClient:v}=$(),{t:n}=J(),{addAlert:N,addError:x}=M(),h=Q(),{realm:C}=U(),[D,b]=r(!1),[d,F]=r(!1),[V,T]=r([]),[w,G]=r([]),[O,H]=r(),[p,j]=r(""),[k,S]=r([]),{policyName:c,conditionName:t}=W(),B=X(),m=Y(),A=B.componentTypes?.["org.keycloak.services.clientpolicy.condition.ClientPolicyConditionProvider"],E=s=>{m.reset({config:s.configuration||{}})};Z(()=>v.clientPolicies.listPolicies({includeGlobalPolicies:!0}),s=>{if(T(s.policies??[]),t){let i=s.policies?.find(o=>o.name===c);i===void 0&&(i=s.globalPolicies?.find(o=>o.name===c),F(i!==void 0));const l=i?.conditions?.find(o=>o.condition===t),u=A?.find(o=>o.id===t);H(l),S(u?.properties),E(l)}},[]);const L=async s=>{const i=s.config,l=()=>k.reduce((o,a)=>(o[a.name]=i[a.name],o),{}),u=V.map(o=>{if(o.name!==c)return o;let a=o.conditions??[];if(t){const q={condition:O?.condition,configuration:l()},y=a.findIndex(R=>t===R.condition);if(y===-1)return;const K=[...a.slice(0,y),q,...a.slice(y+1)];return{...o,conditions:K}}return a=a.concat({condition:w[0].condition,configuration:l()}),{...o,conditions:a}});try{await v.clientPolicies.updatePolicy({policies:u}),T(u),h(P({realm:C,policyName:c})),N(n(t?"updateClientConditionSuccess":"createClientConditionSuccess"),di.success)}catch(o){x("createClientConditionError",o)}};return f(z,{children:[e(mi,{titleKey:n(t?d?"viewCondition":"editCondition":"addCondition"),divider:!0}),f(_,{variant:"light",children:[f(pi,{isHorizontal:!0,role:"manage-realm",isReadOnly:d,className:"pf-v5-u-mt-lg",onSubmit:m.handleSubmit(L),children:[e(ii,{label:n("conditionType"),fieldId:"conditionType",labelIcon:e(si,{helpText:p?`${I(p.replace(/-/g," "))}Help`:"conditionsHelp",fieldLabelId:"conditionType"}),children:e(oi,{name:"conditions",defaultValue:"any-client",control:m.control,render:({field:s})=>e(ni,{placeholderText:n("selectACondition"),className:"kc-conditionType-select","data-testid":"conditionType-select",toggleId:"provider",isDisabled:!!t,onToggle:i=>b(i),onSelect:i=>{s.onChange(i),S(i.properties),j(i.id),G([{condition:i.id}]),b(!1)},selections:t||p,variant:ei.single,"aria-label":n("conditionType"),isOpen:D,children:A?.map(i=>e(ti,{"data-testid":i.id,selected:i.id===s.value,description:n(I(i.id.replace(/-/g," "))),value:i,children:i.id},i.id))})})}),e(ai,{...m,children:e(li,{properties:k})}),!d&&f(ri,{children:[e(g,{variant:"primary",type:"submit","data-testid":"addCondition-saveBtn",isDisabled:p===""&&!t&&d,children:n(t?"save":"add")}),e(g,{variant:"link","data-testid":"addCondition-cancelBtn",onClick:()=>h(P({realm:C,policyName:c})),children:n("cancel")})]})]}),d&&e("div",{className:"kc-backToProfile",children:e(g,{component:s=>e(ci,{...s,to:P({realm:C,policyName:c})}),variant:"primary",children:n("back")})})]})]})}export{Hi as default};
//# sourceMappingURL=NewClientPolicyCondition-BWkSaW2n.js.map
