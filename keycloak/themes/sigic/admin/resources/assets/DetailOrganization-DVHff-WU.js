import{jsx as e,jsxs as y,Fragment as _}from"react/jsx-runtime";import{u as D,d as Z,b as ve,a as L,V as K,J as re,Z as ee,B as j,d$ as ye,N as ce,D as Y,z as H,j as te,y as fe,K as Ce,ag as ke,ah as Ie,aj as me,dQ as Te,dR as Se,U as Oe,W as Pe,dS as Me,h as U,di as Ee,a5 as we,O as ze,ai as oe,l as ne,o as De,M as ue,m as he,n as ae,F as pe,$ as Le,b1 as se,aq as ie,p as Ae,c as xe,P as $,f as J,e0 as Fe,w as ge,T as B,S as Ve,Y as Q,aI as Ue,aJ as Ke,L as Re,bR as Be,c7 as Ne,aO as qe,A as Ge,cQ as He}from"./main-Dml5vH_M.js";import{F as _e}from"./FormAccess-Dgk035ov.js";import{A as $e}from"./AttributeForm-yvG_5yiW.js";import{u as je,R as We}from"./RoutableTabs-D0MTj5jQ.js";import{u as be}from"./useParams-Cmi1OAEj.js";import{V as Qe}from"./ViewHeader-CnGpO8mW.js";import{u as X}from"./ConfirmDialog-BN0phSta.js";import{useState as I,useRef as Ye,useCallback as Je,useEffect as Xe}from"react";import{M as Ze}from"./ManageOrderDialog-DVYSmySu.js";import{D as le}from"./SwitchControl-DVIXTwQM.js";import{d as et}from"./debounce-DrUiQQ8A.js";import{s as tt}from"./sortBy-D3c44bb2.js";import{M as nt}from"./MembersModal-qkfTMBCn.js";import{S as at,C as it}from"./SearchInputComponent-CtocLptu.js";import{t as rt}from"./translationFormatter-DtFomvax.js";import{O as ot,c as st}from"./OrganizationForm-5HZ-V2MA.js";import{A as de}from"./AdminEvents-BQlKf8zR.js";import{a as F,b as V,T as lt}from"./Tabs-swfKYDgo.js";import"react-dom";import"./KeyValueInput-CataZRq4.js";import"./KeySelect-Ba6sDuzD.js";import"./PageHandler-BQ1_55gR.js";import"./DynamicComponents-Cxsqsl9R.js";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./MultiLineInput-BnUu5qtj.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./useLocaleSort-DeXbTEE9.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";import"./constants-BclHbWtx.js";import"./DataListControl-CvcP3gqt.js";import"./Droppable-BYpgxtpN.js";import"./_baseFlatten-BhRqdSvr.js";import"./differenceBy-BpiYyOKy.js";import"./DropdownPanel-CdQAMxBj.js";import"./useFormatDate-Puc65BKQ.js";import"./DatePicker-CU4S68sS.js";import"./pickBy-BQkB_pck.js";import"./DescriptionListTerm-DCQWux3S.js";const dt=({save:t})=>{const{adminClient:n}=D(),{realm:l}=Z(),g=ve(),{t:r}=L(),{addAlert:a,addError:o}=K(),i=re({name:"id"}),s=re({name:"name"}),{setValue:h}=ee(),[k,p]=X({titleKey:"disableConfirmOrganizationTitle",messageKey:"disableConfirmOrganization",continueButtonLabel:"disable",onConfirm:()=>{h("enabled",!1),t()}}),[f,d]=X({titleKey:"organizationDelete",messageKey:"organizationDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:j.danger,onConfirm:async()=>{try{await n.organizations.delById({id:i}),a(r("organizationDeletedSuccess")),g(ye({realm:l}))}catch(u){o("organizationDeleteError",u)}}});return e(ce,{name:"enabled",render:({field:{value:u,onChange:C}})=>y(_,{children:[e(d,{}),e(p,{}),e(Qe,{titleKey:s||"",divider:!1,dropdownItems:[e(Y,{"data-testid":"delete-client",onClick:f,children:r("delete")},"delete")],isEnabled:u,onToggle:O=>{O?(C(O),t()):k()}})]})})},ct=({name:t,label:n,helpText:l,defaultValue:g,isRequired:r,variant:a="typeahead",isDisabled:o})=>{const{adminClient:i}=D(),{t:s}=L(),{control:h,getValues:k,formState:{errors:p}}=ee(),f=k(t),[d,u,C]=H(),[O,P]=I(""),v=Ye(),[c,E]=I([]),[A,N]=I(""),q=Je(et(N,1e3),[]);te(async()=>{const m={max:20,realmOnly:!0};return A&&(m.search=A),await i.identityProviders.find(m)},E,[A]);const W=m=>{const w=m.map(S=>e(oe,{value:S,selected:f?.includes(S.alias),children:S.alias},S.alias));return w.length===0?e(oe,{value:"",children:s("noResultsFound")}):w};return c?y(Ce,{label:s(n),isRequired:r,labelIcon:l?e(ze,{helpText:l,fieldLabelId:n}):void 0,fieldId:t,children:[e(ce,{name:t,defaultValue:g,control:h,rules:{validate:m=>r&&m.filter(w=>w!==void 0).length===0?s("required"):void 0},render:({field:m})=>e(ke,{id:t,onOpenChange:u,toggle:w=>e(me,{"data-testid":t,ref:w,variant:"typeahead",onClick:u,isExpanded:d,isFullWidth:!0,isDisabled:o,status:p[t]?"danger":void 0,children:y(Te,{isPlain:!0,children:[e(Se,{value:O||m.value,onClick:u,onChange:(S,x)=>{C(!0),P(x),q(x)},autoComplete:"off",innerRef:v,placeholderText:s("selectAUser"),...m.value&&{"aria-activedescendant":m.value},role:"combobox",isExpanded:d,"aria-controls":"select-create-typeahead-listbox",children:a==="typeaheadMulti"&&Array.isArray(m.value)&&e(Oe,{"aria-label":"Current selections",children:m.value.map((S,x)=>e(Pe,{onClick:M=>{M.stopPropagation(),m.onChange(m.value.filter(z=>z!==S))},children:S},x))})}),e(Me,{children:!!A&&e(U,{variant:"plain",onClick:()=>{P(""),N(""),m.onChange([]),v?.current?.focus()},"aria-label":s("clear"),children:e(Ee,{"aria-hidden":!0})})})]})}),isOpen:d,selected:m.value,onSelect:(w,S)=>{const M=S.alias;if(a!=="typeaheadMulti"){const z=m.value.includes(M);z?m.onChange([]):m.onChange([M]),P(z?"":M||""),C(!1)}else{const z=m.value.find(R=>R===M)?m.value.filter(R=>R!==M):[...m.value,M];m.onChange(z)}},"aria-label":s(t),children:e(Ie,{children:W(c)})})}),p[t]&&e(we,{message:s("required")})]}):e(fe,{})},mt=({orgId:t,identityProvider:n,onClose:l})=>{const{adminClient:g}=D(),{t:r}=L(),{addAlert:a,addError:o}=K(),i=ne({mode:"onChange"}),{handleSubmit:s,formState:h,setValue:k}=i,{getValues:p}=ee();Xe(()=>De({...n,alias:[n?.alias],hideOnLogin:n?.hideOnLogin},k),[]);const f=async d=>{try{const u=await g.identityProviders.findOne({alias:d.alias[0]});if(!u)throw new Error(r("notFound"));const{config:C}=Ae(d);u.config={...u.config,...C},u.hideOnLogin=d.hideOnLogin??!0,await g.identityProviders.update({alias:d.alias[0]},u),n||await g.organizations.linkIdp({orgId:t,alias:d.alias[0]}),a(r(n?"linkUpdatedSuccessful":"linkSuccessful")),l()}catch(u){o(n?"linkUpdatedError":"linkError",u)}};return e(ue,{variant:he.small,title:r("linkIdentityProvider"),isOpen:!0,onClose:l,actions:[e(ie,{formState:h,"data-testid":"confirm",form:"form",allowInvalid:!0,allowNonDirty:!0,children:r("save")},"confirm"),e(U,{id:"modal-cancel","data-testid":"cancel",variant:j.link,onClick:l,children:r("cancel")},"cancel")],children:e(ae,{...i,children:y(pe,{id:"form",onSubmit:s(f),children:[e(ct,{name:"alias",label:r("identityProvider"),defaultValue:[],isRequired:!0,isDisabled:!!n}),e(Le,{name:se("config.kc.org.domain"),label:r("domain"),controller:{defaultValue:""},options:[{key:"",value:r("none")},{key:"ANY",value:r("any")},...p("domains").map(d=>({key:d,value:d}))],menuAppendTo:"parent"}),e(le,{name:"hideOnLogin",label:r("hideOnLoginPage"),labelIcon:r("hideOnLoginPageHelp"),defaultValue:!0}),e(le,{name:se("config.kc.org.broker.redirect.mode.email-matches"),label:r("redirectWhenEmailMatches"),labelIcon:r("redirectWhenEmailMatchesHelp"),stringify:!0})]})})})},ut=({row:t,refresh:n})=>{const{adminClient:l}=D(),{addAlert:g,addError:r}=K(),{t:a}=L(),o=async i=>{try{await l.identityProviders.update({alias:t.alias},{...t,hideOnLogin:i}),g(a("linkUpdatedSuccessful")),n()}catch(s){r("linkUpdatedError",s)}};return e(Ve,{label:a("on"),labelOff:a("off"),isChecked:t.hideOnLogin,onChange:(i,s)=>o(s)})},ht=()=>{const{adminClient:t}=D(),{t:n}=L(),{id:l}=xe(),{addAlert:g,addError:r}=K(),[a,o]=I(0),i=()=>o(a+1),[s,h]=I(!1),[k,p]=I(!1),[f,d]=I(),[u,C]=H();te(async()=>t.identityProviders.find({max:1}),c=>{p(c.length===1)},[]);const O=async()=>{const c=await t.organizations.listIdentityProviders({orgId:l});return tt(c,"alias")},[P,v]=X({titleKey:"identityProviderUnlink",messageKey:"identityProviderUnlinkConfirm",continueButtonLabel:"unLinkIdentityProvider",continueButtonVariant:j.danger,onConfirm:async()=>{try{await t.organizations.unLinkIdp({orgId:l,alias:f.alias}),d(void 0),g(n("unLinkSuccessful")),i()}catch(c){r("unLinkError",c)}}});return y(_,{children:[s&&e(Ze,{orgId:l,onClose:()=>{h(!1),i()}}),y($,{variant:"light",children:[e(v,{}),u&&e(mt,{orgId:l,identityProvider:f,onClose:()=>{C(),i()}}),k?e(ge,{loader:O,ariaLabelKey:"identityProviders",searchPlaceholderKey:"searchProvider",toolbarItem:y(_,{children:[e(B,{children:e(U,{onClick:()=>{d(void 0),C()},children:n("linkIdentityProvider")})}),e(B,{children:e(U,{"data-testid":"manageDisplayOrder",variant:"link",onClick:()=>h(!0),children:n("manageDisplayOrder")})})]}),actions:[{title:n("edit"),onRowClick:c=>{d(c),C()}},{title:n("unLinkIdentityProvider"),onRowClick:c=>{d(c),P()}}],columns:[{name:"alias"},{name:"config['kc.org.domain']",displayKey:"domain"},{name:"providerId",displayKey:"providerDetails"},{name:"hideOnLogin",displayKey:"hideOnLoginPage",cellRenderer:c=>e(ut,{row:c,refresh:i})}],emptyState:e(J,{message:n("emptyIdentityProviderLink"),instructions:n("emptyIdentityProviderLinkInstructions"),primaryActionText:n("linkIdentityProvider"),onPrimaryAction:C})},a):e(J,{icon:Fe,message:n("noIdentityProvider"),instructions:n("noIdentityProviderInstructions")})]})]})},pt=({orgId:t,onClose:n})=>{const{adminClient:l}=D(),{addAlert:g,addError:r}=K(),{t:a}=L(),o=ne(),{handleSubmit:i,formState:s}=o,h=async k=>{try{const p=new FormData;for(const f in k)p.append(f,k[f]);await l.organizations.invite({orgId:t},p),g(a("inviteSent")),n()}catch(p){r("inviteSentError",p)}};return e(ue,{variant:he.small,title:a("inviteMember"),isOpen:!0,onClose:n,actions:[e(ie,{formState:s,"data-testid":"save",form:"form",allowInvalid:!0,allowNonDirty:!0,children:a("send")},"confirm"),e(U,{id:"modal-cancel","data-testid":"cancel",variant:j.link,onClick:n,children:a("cancel")},"cancel")],children:e(ae,{...o,children:y(pe,{id:"form",onSubmit:i(h),children:[e(Q,{name:"email",label:a("email"),rules:{required:a("required")},autoFocus:!0}),e(Q,{name:"firstName",label:a("firstName")}),e(Q,{name:"lastName",label:a("lastName")})]})})})},gt=t=>{const{realm:n}=Z();return e(Re,{to:Be({realm:n,id:t.id,tab:"settings"}),children:t.username})},bt=()=>{const{t}=L(),{adminClient:n}=D(),{id:l}=be(),{addAlert:g,addError:r}=K(),[a,o]=I(0),i=()=>o(a+1),[s,h]=H(),[k,p]=H(),[f,d]=H(),[u,C]=I([]),[O,P]=I(""),[v,c]=I(""),[E,A]=I([]),[N,q]=I(!1),W=[{value:"Managed",label:"Managed"},{value:"Unmanaged",label:"Unmanaged"}],m=()=>{q(!N)},w=(b,T)=>{E.includes(T)?A(E.filter(G=>G!==T)):A([...E,T]),q(!1),i()},S=async(b,T)=>{try{const G=E.length===1?E[0]:void 0;return await n.organizations.listMembers({orgId:l,first:b,max:T,search:v,membershipType:G})}catch(G){return r("organizationsMembersListError",G),[]}},x=b=>{P(b)},M=()=>{c(O),i()},z=()=>{P(""),c(""),i()},R=async b=>{try{await Promise.all(b.map(T=>n.organizations.delMember({orgId:l,userId:T.id}))),g(t("organizationUsersLeft",{count:b.length}))}catch(T){r("organizationUsersLeftError",T)}i()};return y(_,{children:[k&&e(nt,{membersQuery:()=>n.organizations.listMembers({orgId:l}),onAdd:async b=>{try{await Promise.all(b.map(T=>n.organizations.addMember({orgId:l,userId:T.id}))),g(t("organizationUsersAdded",{count:b.length}))}catch(T){r("organizationUsersAddedError",T)}},onClose:()=>{p(),i()}}),f&&e(pt,{orgId:l,onClose:d}),e(ge,{loader:S,isPaginated:!0,ariaLabelKey:"membersList",onSelect:b=>C([...b]),canSelectAll:!0,toolbarItem:y(_,{children:[e(B,{children:e(at,{value:O,onChange:x,onSearch:M,onClear:z,placeholder:t("searchMembers"),"aria-label":t("searchMembers")})}),e(B,{children:e(Ue,{onOpenChange:h,toggle:b=>e(me,{ref:b,onClick:h,isExpanded:s,variant:"primary",children:t("addMember")}),isOpen:s,children:y(Ke,{children:[e(Y,{onClick:()=>{p(),h()},children:t("addRealmUser")}),e(Y,{onClick:()=>{d(),h()},children:t("inviteMember")})]})})}),e(B,{children:e(U,{variant:"plain",isDisabled:u.length===0,onClick:()=>R(u),children:t("removeMember")})}),e(B,{children:e(it,{filterPlaceholderText:t("filterByMembershipType"),isOpen:N,options:W,onOpenChange:b=>q(b),onToggleClick:m,onSelect:w,selectedItems:E,width:"260px"})})]}),actions:[{title:t("remove"),onRowClick:async b=>{await R([b])}}],columns:[{name:"username",cellRenderer:gt},{name:"email"},{name:"firstName"},{name:"lastName"},{name:"membershipType",cellFormatters:[rt(t)]}],emptyState:e(J,{message:t("emptyMembers"),instructions:t("emptyMembersInstructions"),secondaryActions:[{text:t("addRealmUser"),onClick:p},{text:t("inviteMember"),onClick:d}]}),isSearching:E.length>0},a)]})};function ln(){const{adminClient:t}=D(),{addAlert:n,addError:l}=K(),{realm:g,realmRepresentation:r}=Z(),{id:a}=be(),{t:o}=L(),i=ne(),s=async v=>{try{const c=st(v);await t.organizations.updateById({id:a},c),n(o("organizationSaveSuccess"))}catch(c){l("organizationSaveError",c)}};te(()=>t.organizations.findOne({id:a}),v=>{if(!v)throw new Error(o("notFound"));i.reset({...v,domains:v.domains?.map(c=>c.name),attributes:Ne(v.attributes)})},[a]);const h=v=>je(He({realm:g,id:a,tab:v})),k=h("settings"),p=h("attributes"),f=h("members"),d=h("identityProviders"),u=h("events"),{hasAccess:C}=qe(),[O,P]=I("adminEvents");return e($,{variant:"light",className:"pf-v5-u-p-0",children:y(ae,{...i,children:[e(dt,{save:()=>s(i.getValues())}),y(We,{"data-testid":"organization-tabs","aria-label":o("organization"),isBox:!0,mountOnEnter:!0,children:[e(F,{id:"settings","data-testid":"settingsTab",title:e(V,{children:o("settings")}),...k,children:e($,{children:y(_e,{role:"anyone",onSubmit:i.handleSubmit(s),isHorizontal:!0,children:[e(ot,{readOnly:!0}),y(Ge,{children:[e(ie,{formState:i.formState,"data-testid":"save",children:o("save")}),e(U,{onClick:()=>i.reset(),"data-testid":"reset",variant:"link",children:o("reset")})]})]})})}),e(F,{id:"attributes","data-testid":"attributeTab",title:e(V,{children:o("attributes")}),...p,children:e($,{variant:"light",children:e($e,{form:i,save:s,reset:()=>i.reset({...i.getValues()}),name:"attributes"})})}),e(F,{id:"members","data-testid":"membersTab",title:e(V,{children:o("members")}),...f,children:e(bt,{})}),e(F,{id:"identityProviders","data-testid":"identityProvidersTab",title:e(V,{children:o("identityProviders")}),...d,children:e(ht,{})}),r?.adminEventsEnabled&&C("view-events")&&e(F,{"data-testid":"admin-events-tab",title:e(V,{children:o("adminEvents")}),...u,children:y(lt,{activeKey:O,onSelect:(v,c)=>P(c),children:[e(F,{eventKey:"adminEvents",title:e(V,{children:o("adminEvents")}),children:e(de,{resourcePath:`organizations/${a}`})}),e(F,{eventKey:"membershipEvents",title:e(V,{children:o("membershipEvents")}),children:e(de,{resourcePath:`organizations/${a}/members`})})]})})]})]})})}export{ln as default};
//# sourceMappingURL=DetailOrganization-DVHff-WU.js.map
