import{jsxs as c,jsx as e,Fragment as q}from"react/jsx-runtime";import{u as x,a as M,Z as G,j as N,K as V,N as U,h as v,aM as j,bm as z,au as b,aG as S,aN as A,aL as k,a4 as B,a5 as F,O as _,R as L}from"./main-Dml5vH_M.js";import{useState as R,useMemo as D}from"react";import{G as Z}from"./GroupPickerDialog-eQJqBPQt.js";import{U as $}from"./NewPolicyDialog-Diogklhm.js";import{A as J,S as Q}from"./AddRoleMappingModal-FlNvMd3n.js";import{C as W}from"./ClientSelect-DJq4F1jh.js";import{s as X}from"./sortBy-D3c44bb2.js";const O=s=>s.map(({id:r})=>r),Y=({name:s,label:r,helpText:a,defaultValue:t,isDisabled:y=!1,isRequired:n,variant:h="typeaheadMulti"})=>{const{adminClient:u}=x(),{t:p}=M(),{control:m,setValue:f,getValues:T,formState:{errors:i}}=G(),l=T(s),[K,I]=R(!1),[C,g]=R([]);N(()=>l&&l.length>0?Promise.all(l.map(o=>u.groups.findOne({id:o}))):Promise.resolve([]),o=>{g(o.flat().filter(d=>d))},[]);const P=h==="typeahead";return c(V,{label:p(r),labelIcon:e(_,{helpText:p(a),fieldLabelId:"groups"}),fieldId:"groups",isRequired:n,children:[e(U,{name:s,control:m,defaultValue:t,rules:{validate:o=>n&&o&&o.length>0},render:({field:o})=>c(q,{children:[K&&e(Z,{type:P?"selectOne":"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:d=>{P?(o.onChange(O(d||[])),g(d||[])):(o.onChange([...o.value||[],...O(d||[])]),g([...C,...d||[]])),I(!1)},onClose:()=>{I(!1)},filterGroups:C}),e(v,{"data-testid":"select-group-button",isDisabled:y,variant:"secondary",onClick:()=>{I(!0)},children:p("addGroups")})]})}),C.length>0&&c(j,{variant:"compact",children:[e(z,{children:c(b,{children:[e(S,{children:p("groups")}),e(S,{"aria-hidden":"true"})]})}),e(A,{children:C.map(o=>c(b,{children:[e(k,{children:o.path}),e(k,{children:e(v,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(B,{}),onClick:()=>{f(s,[...O((C||[]).filter(({id:d})=>d!==o.id))]),g([...C.filter(({id:d})=>d!==o.id)])}})})]},o.id))})]}),i[s]&&e(F,{message:p("requiredGroups")})]})},E=({name:s,isRadio:r=!1})=>{const{adminClient:a}=x(),{t}=M(),{getValues:y,setValue:n,formState:{errors:h}}=G(),u=y(s)||[],[p,m]=R(!1),[f,T]=R([]);return N(async()=>{if(u.length>0){const i=await Promise.all(u.map(l=>a.roles.findOneById({id:l})));return Promise.all(i.map(async l=>({role:l,client:l.clientRole?await a.clients.findOne({id:l?.containerId}):void 0})))}return[]},T,[]),c(V,{label:t(r?"role":"roles"),labelIcon:e(_,{helpText:t(r?"selectRole":"policyRolesHelp"),fieldLabelId:"roles"}),fieldId:s,isRequired:!0,children:[p&&e(J,{id:"role",type:"roles",title:t("selectRole"),actionLabel:t("select"),isRadio:r,onAssign:i=>{n(s,[...r?[]:u,...i.filter(l=>l.role.id!==void 0).map(l=>l.role.id)]),T(r?i:[...f,...i]),m(!1)},onClose:()=>m(!1)}),e(v,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>m(!0),children:t(r?"selectRole":"addRoles")}),f.length>0&&c(j,{variant:"compact",children:[e(z,{children:c(b,{children:[e(S,{children:t("roles")}),e(S,{"aria-hidden":"true"})]})}),e(A,{children:f.map(i=>c(b,{children:[e(k,{children:e(Q,{role:i.role,client:i.client})}),e(k,{children:e(v,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(B,{}),onClick:()=>{n(s,u.filter(l=>l!==i.role.id)),T(f.filter(l=>l.role.id!==i.role.id))}})})]},i.role.id))})]}),h[s]&&e(F,{message:t("requiredRoles")})]})},w=s=>e(W,{...s,clientKey:"id"}),H={users:$,clients:w,groups:Y,roles:E},ee=s=>s in H,ce=({resourceType:s,withEnforceAccessTo:r=!0})=>{const{t:a}=M(),t=G(),y=t.getValues("resources"),n=s.toLowerCase(),[h,u]=R(y?.some(f=>f!==s)||!r);function p(){return ee(n)?H[n]:null}const m=p();return c(q,{children:[r&&c(V,{label:a("enforceAccessTo"),labelIcon:e(_,{helpText:a("enforceAccessToHelpText"),fieldLabelId:"enforce-access-to"}),fieldId:"EnforceAccessTo",hasNoPaddingTop:!0,isRequired:!0,children:[e(L,{id:"allResources","data-testid":"allResources",isChecked:!h,name:"EnforceAccessTo",label:a("allResourceType",{resourceType:s}),onChange:()=>{u(!1),t.setValue("resources",[])},className:"pf-v5-u-mb-md"}),e(L,{id:"specificResources","data-testid":"specificResources",isChecked:h,name:"EnforceAccessTo",label:a("specificResourceType",{resourceType:s}),onChange:()=>{u(!0),t.setValue("resources",[])},className:"pf-v5-u-mb-md"})]}),h&&m&&e(m,{name:r?"resources":"resource",label:`${n}Resources`,helpText:a("resourceTypeHelpText",{resourceType:n}),defaultValue:[],variant:r?"typeaheadMulti":"typeahead",isRequired:r,isRadio:!r})]})};function de({clientId:s}){const{adminClient:r}=x(),[a,t]=R();return N(()=>r.clients.getResourceServer({id:s}),t,[s]),D(()=>{const n=a?.authorizationSchema?.resourceTypes;return n?X(Object.values(n),"type"):[]},[a])}export{H as C,ce as R,de as u};
//# sourceMappingURL=useSortedResourceTypes-D-nXlE6v.js.map
