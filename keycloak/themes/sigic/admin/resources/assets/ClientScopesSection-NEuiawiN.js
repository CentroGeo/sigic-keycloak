import{jsxs as F,Fragment as V,jsx as t}from"react/jsx-runtime";import{useState as s}from"react";import{u as E,d as R,a as I,V as N,B as G,q as T,al as Q,P as X,w as Y,aT as O,aU as v,T as b,h as Z,L as j,aV as _,aI as $,aJ as ee,D as te,aj as oe,aW as ne,aP as ae}from"./main-Dml5vH_M.js";import{g as le}from"./utils-C-TUnOch.js";import{A as u,r as re,C as B,a as ce,c as se}from"./ClientScopeTypes-DwzbyHD6.js";import{u as ie}from"./ConfirmDialog-BN0phSta.js";import{V as pe}from"./ViewHeader-CnGpO8mW.js";import{u as de,m as me}from"./useLocaleSort-DeXbTEE9.js";import{S as Se,C as ue,a as he,n as ye,t as fe,p as ge}from"./SearchFilter-CfoaCrQT.js";import"react-dom";import"./filter-icon-BO7Evf9d.js";const Ce=o=>{const{adminClient:i}=E(),{t:n}=I(),{addAlert:d,addError:h}=N();return t(ce,{clientScope:o,type:o.type,all:!0,onSelect:async m=>{try{await se(i,o,m),d(n("clientScopeSuccess"),T.success),o.refresh()}catch(p){h("clientScopeError",p)}}})},we=({id:o,name:i})=>{const{realm:n}=R();return t(j,{to:ae({realm:n,id:o,tab:"settings"}),children:i},o)};function Be(){const{adminClient:o}=E(),{realm:i}=R(),{t:n}=I(),{addAlert:d,addError:h}=N(),[m,p]=s(!1),[a,y]=s([]),[l,D]=s("name"),[K,f]=s(u.none),[L,g]=s("all"),x=de(),[P,U]=s(0),r=()=>{y([]),U(P+1)},M=async(e,A,c)=>{const S=await o.clientScopes.listDefaultClientScopes(),q=await o.clientScopes.listDefaultOptionalClientScopes(),H=await o.clientScopes.find(),J=l==="name"?ye(c):l==="type"?fe(K):ge(L),z=H.map(C=>({...C,type:S.find(w=>w.name===C.name)?B.default:q.find(w=>w.name===C.name)?B.optional:u.none})).filter(J);return x(z,me("name")).slice(e,Number(e)+Number(A))},[k,W]=ie({titleKey:n("deleteClientScope",{count:a.length,name:a[0]?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:G.danger,onConfirm:async()=>{const e=await o.clientScopes.find();if(Object.keys(e).length-a.length>0)try{for(const c of a){try{await re(o,c)}catch(S){console.warn("could not remove scope",S.response?.data?.errorMessage||S)}await o.clientScopes.del({id:c.id})}d(n("deletedSuccessClientScope"),T.success),r()}catch(c){h("deleteErrorClientScope",c)}else d(n("notAllowedToDeleteAllClientScopes"),T.danger)}});return F(V,{children:[t(W,{}),t(pe,{titleKey:"clientScopes",subKey:"clientScopeExplain",helpUrl:Q.clientScopesUrl}),t(X,{variant:"light",className:"pf-v5-u-p-0",children:t(Y,{loader:M,ariaLabelKey:"clientScopeList",searchPlaceholderKey:l==="name"?"searchForClientScope":void 0,isSearching:l!=="name",searchTypeComponent:t(he,{searchType:l,onSelect:e=>D(e),withProtocol:!0}),isPaginated:!0,onSelect:e=>y([...e]),canSelectAll:!0,toolbarItem:F(V,{children:[t(Se,{searchType:l,type:K,onSelect:e=>{D(e),g("all"),f(u.none),r()},onType:e=>{f(e),g("all"),r()},protocol:L,onProtocol:e=>{g(e),f(u.none),r()}}),t(b,{children:t(Z,{component:e=>t(j,{...e,to:_({realm:i})}),children:n("createClientScope")})}),t(b,{children:t(ue,{selectedRows:a,refresh:r})}),t(b,{children:t($,{shouldFocusToggleOnSelect:!0,onOpenChange:e=>p(e),toggle:e=>t(oe,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:e,onClick:()=>p(!m),variant:"plain",children:t(ne,{})}),isOpen:m,children:t(ee,{children:t(te,{"data-testid":"delete",isDisabled:a.length===0,onClick:()=>{k(),p(!1)},children:n("delete")})})})})]}),actions:[{title:n("delete"),onRowClick:e=>{y([e]),k()}}],columns:[{name:"name",cellRenderer:we},{name:"type",displayKey:"assignedType",cellRenderer:e=>t(Ce,{...e,refresh:r})},{name:"protocol",displayKey:"protocol",cellRenderer:e=>le(n,e.protocol??"openid-connect"),transforms:[O(15)]},{name:"attributes['gui.order']",displayKey:"displayOrder",cellFormatters:[v()],transforms:[O(15)]},{name:"description",cellFormatters:[v()]}]},P)})]})}export{Be as default};
//# sourceMappingURL=ClientScopesSection-NEuiawiN.js.map
