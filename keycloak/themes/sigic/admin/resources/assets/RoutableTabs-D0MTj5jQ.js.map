{"version":3,"file":"RoutableTabs-D0MTj5jQ.js","sources":["../../../../../../../src/components/routable-tabs/RoutableTabs.tsx"],"sourcesContent":["import {\n  Tab,\n  TabProps,\n  Tabs,\n  TabsComponent,\n  TabsProps,\n} from \"@patternfly/react-core\";\nimport {\n  Children,\n  JSXElementConstructor,\n  PropsWithChildren,\n  ReactElement,\n  isValidElement,\n} from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport {\n  Path,\n  generatePath,\n  matchRoutes,\n  useHref,\n  useLocation,\n  useParams,\n} from \"react-router-dom\";\nimport { useServerInfo } from \"../../context/server-info/ServerInfoProvider\";\nimport { PageHandler } from \"../../page/PageHandler\";\nimport { TAB_PROVIDER } from \"../../page/constants\";\nimport { routes } from \"../../routes\";\nimport useIsFeatureEnabled, { Feature } from \"../../utils/useIsFeatureEnabled\";\n\n// TODO: Remove the custom 'children' props and type once the following issue has been resolved:\n// https://github.com/patternfly/patternfly-react/issues/6766\ntype ChildElement = ReactElement<TabProps, JSXElementConstructor<TabProps>>;\ntype Child = ChildElement | boolean | null | undefined;\n\n// TODO: Figure out why we need to omit 'ref' from the props.\ntype RoutableTabsProps = {\n  children: Child | Child[];\n  defaultLocation?: Partial<Path>;\n} & Omit<\n  TabsProps,\n  \"ref\" | \"activeKey\" | \"defaultActiveKey\" | \"component\" | \"children\"\n>;\n\nexport const RoutableTabs = ({\n  children,\n  defaultLocation,\n  ...otherProps\n}: RoutableTabsProps) => {\n  const { pathname } = useLocation();\n  const params = useParams();\n  const { componentTypes } = useServerInfo();\n  const tabs = componentTypes?.[TAB_PROVIDER] || [];\n  const isFeatureEnabled = useIsFeatureEnabled();\n  const { t } = useTranslation();\n\n  // Extract event keys from children\n  const eventKeys = Children.toArray(children)\n    .filter((child): child is ChildElement => isValidElement(child))\n    .map((child) => child.props.eventKey.toString());\n\n  const keyLength = eventKeys[0]?.split(\"/\").length;\n\n  const matchedPaths = (matchRoutes(routes, pathname) || []).map(\n    (match) => match.route.path,\n  );\n\n  // To render a dynamic tab we need to be on the right route, but also have the right number of path segments.\n  // Otherwise we might render this tab on a sub tab, which is not what we want.\n  const matchedTabs = tabs\n    .filter((tab) => {\n      const tabPath = tab.metadata.path;\n      return (\n        matchedPaths.includes(tabPath) &&\n        tabPath.split(\"/\").length === keyLength\n      );\n    })\n    .map((tab) => {\n      const tabPath = tab.metadata.path;\n      const generateTabPath = generatePath(tabPath, {\n        ...params,\n        ...tab.metadata.params,\n      });\n      eventKeys.push(generateTabPath);\n      return {\n        ...tab,\n        pathname: generateTabPath,\n      };\n    });\n\n  // Determine if there is an exact match.\n  const exactMatch = eventKeys.find(\n    (eventKey) => eventKey === decodeURI(pathname),\n  );\n\n  // Determine which event keys at least partially match the current path, then sort them so the nearest match ends up on top.\n  const nearestMatch = eventKeys\n    .filter((eventKey) => pathname.includes(eventKey))\n    .sort((a, b) => a.length - b.length)\n    .pop();\n\n  return (\n    <Tabs\n      activeKey={\n        exactMatch ?? nearestMatch ?? defaultLocation?.pathname ?? pathname\n      }\n      component={TabsComponent.nav}\n      inset={{\n        default: \"insetNone\",\n        xl: \"insetLg\",\n        \"2xl\": \"inset2xl\",\n      }}\n      unmountOnExit\n      mountOnEnter\n      {...otherProps}\n    >\n      {children as any}\n      {isFeatureEnabled(Feature.DeclarativeUI) &&\n        matchedTabs.map<any>((tab) => (\n          <DynamicTab key={tab.id} eventKey={tab.pathname} title={t(tab.id)}>\n            <PageHandler page={tab} providerType={TAB_PROVIDER} />\n          </DynamicTab>\n        ))}\n    </Tabs>\n  );\n};\n\ntype DynamicTabProps = {\n  title: string;\n  eventKey: string;\n};\n\nconst DynamicTab = ({\n  children,\n  ...props\n}: PropsWithChildren<DynamicTabProps>) => {\n  const href = useHref(props.eventKey);\n\n  return (\n    <Tab href={href} {...props}>\n      {children}\n    </Tab>\n  );\n};\n\nexport const useRoutableTab = (to: Partial<Path>) => ({\n  eventKey: to.pathname ?? \"\",\n  href: useHref(to),\n});\n"],"names":["RoutableTabs","children","defaultLocation","otherProps","pathname","useLocation","params","useParams","componentTypes","useServerInfo","tabs","TAB_PROVIDER","isFeatureEnabled","useIsFeatureEnabled","t","useTranslation","eventKeys","Children","child","isValidElement","keyLength","matchedPaths","matchRoutes","routes","match","matchedTabs","tab","tabPath","generateTabPath","generatePath","exactMatch","eventKey","nearestMatch","a","b","jsxs","Tabs","TabsComponent","Feature","jsx","DynamicTab","PageHandler","props","href","useHref","Tab","useRoutableTab","to"],"mappings":"mWA2CO,MAAMA,EAAe,CAAC,CAC3B,SAAAC,EACA,gBAAAC,EACA,GAAGC,CACL,IAAyB,CACjB,KAAA,CAAE,SAAAC,CAAS,EAAIC,EAAY,EAC3BC,EAASC,EAAU,EACnB,CAAE,eAAAC,CAAe,EAAIC,EAAc,EACnCC,EAAOF,IAAiBG,CAAY,GAAK,CAAC,EAC1CC,EAAmBC,EAAoB,EACvC,CAAE,EAAAC,CAAE,EAAIC,EAAe,EAGvBC,EAAYC,EAAS,QAAQhB,CAAQ,EACxC,OAAQiB,GAAiCC,EAAeD,CAAK,CAAC,EAC9D,IAAKA,GAAUA,EAAM,MAAM,SAAS,UAAU,EAE3CE,EAAYJ,EAAU,CAAC,GAAG,MAAM,GAAG,EAAE,OAErCK,GAAgBC,EAAYC,EAAQnB,CAAQ,GAAK,CAAA,GAAI,IACxDoB,GAAUA,EAAM,MAAM,IACzB,EAIMC,EAAcf,EACjB,OAAQgB,GAAQ,CACT,MAAAC,EAAUD,EAAI,SAAS,KAE3B,OAAAL,EAAa,SAASM,CAAO,GAC7BA,EAAQ,MAAM,GAAG,EAAE,SAAWP,CAAA,CAEjC,EACA,IAAKM,GAAQ,CACN,MAAAC,EAAUD,EAAI,SAAS,KACvBE,EAAkBC,EAAaF,EAAS,CAC5C,GAAGrB,EACH,GAAGoB,EAAI,SAAS,MAAA,CACjB,EACD,OAAAV,EAAU,KAAKY,CAAe,EACvB,CACL,GAAGF,EACH,SAAUE,CACZ,CAAA,CACD,EAGGE,EAAad,EAAU,KAC1Be,GAAaA,IAAa,UAAU3B,CAAQ,CAC/C,EAGM4B,EAAehB,EAClB,OAAQe,GAAa3B,EAAS,SAAS2B,CAAQ,CAAC,EAChD,KAAK,CAACE,EAAGC,IAAMD,EAAE,OAASC,EAAE,MAAM,EAClC,IAAI,EAGL,OAAAC,EAACC,EAAA,CACC,UACEN,GAAcE,GAAgB9B,GAAiB,UAAYE,EAE7D,UAAWiC,EAAc,IACzB,MAAO,CACL,QAAS,YACT,GAAI,UACJ,MAAO,UACT,EACA,cAAa,GACb,aAAY,GACX,GAAGlC,EAEH,SAAA,CAAAF,EACAW,EAAiB0B,EAAQ,aAAa,GACrCb,EAAY,IAAUC,GACpBa,EAACC,EAAwB,CAAA,SAAUd,EAAI,SAAU,MAAOZ,EAAEY,EAAI,EAAE,EAC9D,SAAAa,EAACE,EAAY,CAAA,KAAMf,EAAK,aAAcf,CAAc,CAAA,CAAA,EADrCe,EAAI,EAErB,CACD,CAAA,CAAA,CACL,CAEJ,EAOMc,EAAa,CAAC,CAClB,SAAAvC,EACA,GAAGyC,CACL,IAA0C,CAClC,MAAAC,EAAOC,EAAQF,EAAM,QAAQ,EAEnC,OACGH,EAAAM,EAAA,CAAI,KAAAF,EAAa,GAAGD,EAClB,SAAAzC,EACH,CAEJ,EAEa6C,EAAkBC,IAAuB,CACpD,SAAUA,EAAG,UAAY,GACzB,KAAMH,EAAQG,CAAE,CAClB"}