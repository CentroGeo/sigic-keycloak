{"version":3,"file":"UserFederationLdapSettings-BeHextUw.js","sources":["../../../../../../../src/user-federation/ldap/mappers/LdapMapperList.tsx","../../../../../../../src/user-federation/UserFederationLdapSettings.tsx"],"sourcesContent":["import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport {\n  Action,\n  KeycloakDataTable,\n  ListEmptyState,\n  useAlerts,\n  useFetch,\n} from \"@keycloak/keycloak-ui-shared\";\nimport {\n  AlertVariant,\n  Button,\n  ButtonVariant,\n  ToolbarItem,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, To, useNavigate, useParams } from \"react-router-dom\";\nimport { useAdminClient } from \"../../../admin-client\";\nimport { useConfirmDialog } from \"../../../components/confirm-dialog/ConfirmDialog\";\nimport useLocaleSort, { mapByKey } from \"../../../utils/useLocaleSort\";\n\nexport type LdapMapperListProps = {\n  toCreate: To;\n  toDetail: (mapperId: string) => To;\n};\n\ntype MapperLinkProps = ComponentRepresentation & {\n  toDetail: (mapperId: string) => To;\n};\n\nconst MapperLink = ({ toDetail, ...mapper }: MapperLinkProps) => (\n  <Link to={toDetail(mapper.id!)}>{mapper.name}</Link>\n);\n\nexport const LdapMapperList = ({ toCreate, toDetail }: LdapMapperListProps) => {\n  const { adminClient } = useAdminClient();\n\n  const navigate = useNavigate();\n  const { t } = useTranslation();\n  const { addAlert, addError } = useAlerts();\n  const [key, setKey] = useState(0);\n  const refresh = () => setKey(key + 1);\n\n  const [mappers, setMappers] = useState<ComponentRepresentation[]>([]);\n  const localeSort = useLocaleSort();\n\n  const { id } = useParams<{ id: string }>();\n\n  const [selectedMapper, setSelectedMapper] =\n    useState<ComponentRepresentation>();\n\n  useFetch(\n    () =>\n      adminClient.components.find({\n        parent: id,\n        type: \"org.keycloak.storage.ldap.mappers.LDAPStorageMapper\",\n      }),\n    (mapper) => {\n      setMappers(\n        localeSort(\n          mapper.map((mapper) => ({\n            ...mapper,\n            name: mapper.name,\n            type: mapper.providerId,\n          })),\n          mapByKey(\"name\"),\n        ),\n      );\n    },\n    [key],\n  );\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: t(\"deleteMappingTitle\", { mapperId: selectedMapper?.id }),\n    messageKey: \"deleteMappingConfirm\",\n    continueButtonLabel: \"delete\",\n    continueButtonVariant: ButtonVariant.danger,\n    onConfirm: async () => {\n      try {\n        await adminClient.components.del({\n          id: selectedMapper!.id!,\n        });\n        refresh();\n        addAlert(t(\"mappingDeletedSuccess\"), AlertVariant.success);\n        setSelectedMapper(undefined);\n      } catch (error) {\n        addError(\"mappingDeletedError\", error);\n      }\n    },\n  });\n\n  return (\n    <>\n      <DeleteConfirm />\n      <KeycloakDataTable\n        key={key}\n        loader={mappers}\n        ariaLabelKey=\"ldapMappersList\"\n        searchPlaceholderKey=\"searchForMapper\"\n        toolbarItem={\n          <ToolbarItem>\n            <Button\n              data-testid=\"add-mapper-btn\"\n              variant=\"primary\"\n              component={(props) => <Link {...props} to={toCreate} />}\n            >\n              {t(\"addMapper\")}\n            </Button>\n          </ToolbarItem>\n        }\n        actions={[\n          {\n            title: t(\"delete\"),\n            onRowClick: (mapper) => {\n              setSelectedMapper(mapper);\n              toggleDeleteDialog();\n            },\n          } as Action<ComponentRepresentation>,\n        ]}\n        columns={[\n          {\n            name: \"name\",\n            cellRenderer: (row) => <MapperLink {...row} toDetail={toDetail} />,\n          },\n          {\n            name: \"type\",\n          },\n        ]}\n        emptyState={\n          <ListEmptyState\n            message={t(\"emptyMappers\")}\n            instructions={t(\"emptyMappersInstructions\")}\n            primaryActionText={t(\"emptyPrimaryAction\")}\n            onPrimaryAction={() => navigate(toCreate)}\n          />\n        }\n      />\n    </>\n  );\n};\n","import type ComponentRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/componentRepresentation\";\nimport {\n  KeycloakSpinner,\n  useAlerts,\n  useFetch,\n} from \"@keycloak/keycloak-ui-shared\";\nimport {\n  AlertVariant,\n  PageSection,\n  Tab,\n  TabTitleText,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { useParams } from \"react-router-dom\";\nimport { useAdminClient } from \"../admin-client\";\nimport {\n  RoutableTabs,\n  useRoutableTab,\n} from \"../components/routable-tabs/RoutableTabs\";\nimport { useRealm } from \"../context/realm-context/RealmContext\";\nimport {\n  LdapComponentRepresentation,\n  UserFederationLdapForm,\n  serializeFormData,\n} from \"./UserFederationLdapForm\";\nimport { LdapMapperList } from \"./ldap/mappers/LdapMapperList\";\nimport {\n  UserFederationLdapParams,\n  toUserFederationLdap,\n} from \"./routes/UserFederationLdap\";\nimport { toUserFederationLdapMapper } from \"./routes/UserFederationLdapMapper\";\nimport { ExtendedHeader } from \"./shared/ExtendedHeader\";\n\nexport default function UserFederationLdapSettings() {\n  const { adminClient } = useAdminClient();\n\n  const { t } = useTranslation();\n  const form = useForm<LdapComponentRepresentation>({ mode: \"onChange\" });\n  const { realm } = useRealm();\n  const { id } = useParams<UserFederationLdapParams>();\n  const { addAlert, addError } = useAlerts();\n  const [component, setComponent] = useState<ComponentRepresentation>();\n  const [refreshCount, setRefreshCount] = useState(0);\n\n  const refresh = () => setRefreshCount((count) => count + 1);\n\n  useFetch(\n    () => adminClient.components.findOne({ id: id! }),\n    (component) => {\n      if (!component) {\n        throw new Error(t(\"notFound\"));\n      }\n\n      setComponent(component);\n      setupForm(component);\n    },\n    [id, refreshCount],\n  );\n\n  const settingsTab = useRoutableTab(\n    toUserFederationLdap({ realm, id: id!, tab: \"settings\" }),\n  );\n  const mappersTab = useRoutableTab(\n    toUserFederationLdap({ realm, id: id!, tab: \"mappers\" }),\n  );\n\n  const setupForm = (component: ComponentRepresentation) => {\n    form.reset({});\n    form.reset(component);\n    form.setValue(\n      \"config.periodicChangedUsersSync\",\n      component.config?.[\"changedSyncPeriod\"]?.[0] !== \"-1\",\n    );\n\n    form.setValue(\n      \"config.periodicFullSync\",\n      component.config?.[\"fullSyncPeriod\"]?.[0] !== \"-1\",\n    );\n  };\n\n  const onSubmit = async (formData: LdapComponentRepresentation) => {\n    try {\n      await adminClient.components.update(\n        { id: id! },\n        serializeFormData(formData),\n      );\n      addAlert(t(\"userProviderSaveSuccess\"), AlertVariant.success);\n      refresh();\n    } catch (error) {\n      addError(\"userProviderSaveError\", error);\n    }\n  };\n\n  if (!component) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <FormProvider {...form}>\n      <ExtendedHeader\n        provider=\"LDAP\"\n        noDivider\n        editMode={component.config?.editMode}\n        save={() => form.handleSubmit(onSubmit)()}\n      />\n      <PageSection variant=\"light\" className=\"pf-v5-u-p-0\">\n        <RoutableTabs\n          defaultLocation={toUserFederationLdap({\n            realm,\n            id: id!,\n            tab: \"settings\",\n          })}\n          isBox\n        >\n          <Tab\n            id=\"settings\"\n            title={<TabTitleText>{t(\"settings\")}</TabTitleText>}\n            {...settingsTab}\n          >\n            <PageSection variant=\"light\">\n              <UserFederationLdapForm id={id} onSubmit={onSubmit} />\n            </PageSection>\n          </Tab>\n          <Tab\n            id=\"mappers\"\n            title={<TabTitleText>{t(\"mappers\")}</TabTitleText>}\n            data-testid=\"ldap-mappers-tab\"\n            {...mappersTab}\n          >\n            <LdapMapperList\n              toCreate={toUserFederationLdapMapper({\n                realm,\n                id: id!,\n                mapperId: \"new\",\n              })}\n              toDetail={(mapperId) =>\n                toUserFederationLdapMapper({\n                  realm,\n                  id: id!,\n                  mapperId,\n                })\n              }\n            />\n          </Tab>\n        </RoutableTabs>\n      </PageSection>\n    </FormProvider>\n  );\n}\n"],"names":["MapperLink","toDetail","mapper","jsx","Link","LdapMapperList","toCreate","adminClient","useAdminClient","navigate","useNavigate","useTranslation","addAlert","addError","useAlerts","key","setKey","useState","refresh","mappers","setMappers","localeSort","useLocaleSort","id","useParams","selectedMapper","setSelectedMapper","useFetch","mapByKey","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","ButtonVariant","AlertVariant","error","jsxs","Fragment","KeycloakDataTable","ToolbarItem","Button","props","row","ListEmptyState","UserFederationLdapSettings","t","form","useForm","realm","useRealm","component","setComponent","refreshCount","setRefreshCount","count","setupForm","settingsTab","useRoutableTab","toUserFederationLdap","mappersTab","onSubmit","formData","serializeFormData","FormProvider","ExtendedHeader","PageSection","RoutableTabs","Tab","TabTitleText","UserFederationLdapForm","toUserFederationLdapMapper","mapperId","KeycloakSpinner"],"mappings":"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"}