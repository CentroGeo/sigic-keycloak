import{jsxs as b,Fragment as N,jsx as e}from"react/jsx-runtime";import{a as M,Z as K,J as A,a$ as be,b0 as ye,N as w,S as re,K as F,a1 as se,a2 as J,a5 as le,O as R,$ as Ee,u as ee,j as te,bn as ae,bo as ne,ai as z,F as he,a3 as Ve,l as Ae,e as Ke,V as Ce,b as Be,d as ve,aO as He,B as de,q as L,cH as Ue,cI as ce,y as qe,a8 as Ie,n as Ge,P as Je,bi as je,w as $e,T as ze,h as _e,L as Se,cJ as pe,f as We,bj as Ye,D as W,cK as Ze}from"./main-Dml5vH_M.js";import{useState as I,useMemo as Qe}from"react";import{u as Z}from"./ConfirmDialog-BN0phSta.js";import{D as Xe}from"./DynamicComponents-Cxsqsl9R.js";import{F as Y,b as et}from"./FormAccess-Dgk035ov.js";import{P as tt}from"./PermissionTab-DRVls294.js";import{u as at,R as nt}from"./RoutableTabs-D0MTj5jQ.js";import{V as it}from"./ViewHeader-CnGpO8mW.js";import{u as ie}from"./useParams-Cmi1OAEj.js";import{T as Q,S as c,F as X,O as ot,D as rt,a as st}from"./OIDCGeneralSettings-CzsQFNx1.js";import{S as lt,D as dt}from"./SamlGeneralSettings-sZY3WEng.js";import{E as ct}from"./ExpandableSection-CRQBD4mp.js";import{G as pt}from"./GeneralSettings-DkFjDz2h.js";import{M as me}from"./MultiLineInput-BnUu5qtj.js";import{A as mt}from"./AdminEvents-BQlKf8zR.js";import{a as j,b as $}from"./Tabs-swfKYDgo.js";import"react-dom";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./KeySelect-Ba6sDuzD.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./translationFormatter-DtFomvax.js";import"./useLocaleSort-DeXbTEE9.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";import"./Trans-BHLWmjXF.js";import"./PageHandler-BQ1_55gR.js";import"./constants-BclHbWtx.js";import"./SwitchControl-DVIXTwQM.js";/* empty css                           */import"./ClientIdSecret-CkCa_19T.js";import"./RedirectUrl-D3h2eZTv.js";import"./DropdownPanel-CdQAMxBj.js";import"./useFormatDate-Puc65BKQ.js";import"./DatePicker-CU4S68sS.js";import"./pickBy-BQkB_pck.js";import"./DescriptionListTerm-DCQWux3S.js";const ue=({field:n,label:t,defaultValue:a,labelForEmpty:r="none"})=>{const{adminClient:d}=ee(),{t:i}=M(),{control:s}=K(),[l,g]=I(),[p,v]=I(!1);return te(()=>d.authenticationManagement.getFlows(),y=>g(y.filter(u=>u.providerId==="basic-flow")),[]),e(F,{label:i(t),labelIcon:e(R,{helpText:i(`${t}Help`),fieldLabelId:t}),fieldId:t,children:e(w,{name:n,defaultValue:a,control:s,render:({field:y})=>e(ae,{toggleId:t,onToggle:()=>v(!p),onSelect:u=>{y.onChange(u),v(!1)},selections:y.value||i(r),variant:ne.single,"aria-label":i(t),isOpen:p,children:[...a===""?[e(z,{value:"",children:i(r)},"empty")]:[],...l?.map(u=>e(z,{selected:u.alias===y.value,value:u.alias,children:u.alias},u.id))||[]]})})})},fe=["IMPORT","LEGACY","FORCE"],ut=({isOIDC:n,isSAML:t})=>{const{t:a}=M(),{control:r,register:d,setValue:i,formState:{errors:s}}=K(),g=A({control:r,name:"config.filteredByClaim",defaultValue:"false"})==="true",v=be()(ye.TransientUsers),u=A({control:r,name:"config.doNotStoreUsers",defaultValue:"false"})==="false";return b(N,{children:[!n&&!t&&e(Q,{field:"config.defaultScope",label:"scopes"}),e(c,{field:"storeToken",label:"storeTokens",fieldType:"boolean"}),(t||n)&&e(c,{field:"addReadTokenRoleOnCreate",label:"storedTokensReadable",fieldType:"boolean"}),!n&&!t&&b(N,{children:[e(c,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(c,{field:"config.disableUserInfo",label:"disableUserInfo"})]}),n&&e(c,{field:"config.isAccessTokenJWT",label:"isAccessTokenJWT"}),e(c,{field:"trustEmail",label:"trustEmail",fieldType:"boolean"}),e(c,{field:"linkOnly",label:"accountLinkingOnly",fieldType:"boolean"}),e(c,{field:"hideOnLogin",label:"hideOnLoginPage",fieldType:"boolean"}),(!t||n)&&e(X,{label:"filteredByClaim",children:e(w,{name:"config.filteredByClaim",defaultValue:"false",control:r,render:({field:f})=>e(re,{id:"filteredByClaim",label:a("on"),labelOff:a("off"),isChecked:f.value==="true",onChange:(x,h)=>{f.onChange(h.toString())}})})}),(!t||n)&&g&&b(N,{children:[b(F,{label:a("claimFilterName"),labelIcon:e(R,{helpText:a("claimFilterNameHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-name",isRequired:!0,children:[e(se,{isRequired:!0,id:"kc-claim-filter-name","data-testid":"claimFilterName",validated:s.config?.claimFilterName?J.error:J.default,...d("config.claimFilterName",{required:!0})}),s.config?.claimFilterName&&e(le,{message:a("required")})]}),b(F,{label:a("claimFilterValue"),labelIcon:e(R,{helpText:a("claimFilterValueHelp"),fieldLabelId:"claimFilterName"}),fieldId:"kc-claim-filter-value",isRequired:!0,children:[e(se,{isRequired:!0,id:"kc-claim-filter-value","data-testid":"claimFilterValue",validated:s.config?.claimFilterValue?J.error:J.default,...d("config.claimFilterValue",{required:!0})}),s.config?.claimFilterValue&&e(le,{message:a("required")})]})]}),e(ue,{field:"firstBrokerLoginFlowAlias",label:"firstBrokerLoginFlowAliasOverride",defaultValue:"",labelForEmpty:""}),e(ue,{field:"postBrokerLoginFlowAlias",label:"postBrokerLoginFlowAlias",defaultValue:""}),v&&e(X,{label:"doNotStoreUsers",children:e(w,{name:"config.doNotStoreUsers",defaultValue:"false",control:r,render:({field:f})=>e(re,{id:"doNotStoreUsers",label:a("on"),labelOff:a("off"),isChecked:f.value==="true",onChange:(x,h)=>{f.onChange(h.toString()),h&&i("config.syncMode","IMPORT")}})})}),u&&e(Ee,{name:"config.syncMode",label:a("syncMode"),labelIcon:a("syncModeHelp"),options:fe.map(f=>({key:f,value:a(`syncModes.${f.toLocaleLowerCase()}`)})),controller:{defaultValue:fe[0],rules:{required:a("required")}}}),e(c,{field:"config.caseSensitiveOriginalUsername",label:"caseSensitiveOriginalUsername"})]})},ft={unspecified:"",none:"none",consent:"consent",login:"login",select_account:"select_account"},gt=()=>{const{t:n}=M(),{control:t}=K(),[a,r]=I(!1),[d,i]=I(!1);return e(ct,{toggleText:n("advanced"),onToggle:()=>r(!a),isExpanded:a,children:b(he,{isHorizontal:!0,children:[e(c,{label:"passLoginHint",field:"config.loginHint"}),e(c,{label:"passMaxAge",field:"config.passMaxAge"}),e(c,{label:"passCurrentLocale",field:"config.uiLocales"}),e(c,{field:"config.backchannelSupported",label:"backchannelLogout"}),e(c,{field:"config.sendIdTokenOnLogout",label:"sendIdTokenOnLogout",defaultValue:"true"}),e(c,{field:"config.sendClientIdOnLogout",label:"sendClientIdOnLogout"}),e(c,{field:"config.disableUserInfo",label:"disableUserInfo"}),e(c,{field:"config.disableNonce",label:"disableNonce"}),e(c,{field:"config.disableTypeClaimCheck",label:"disableTypeClaimCheck"}),e(Q,{field:"config.defaultScope",label:"scopes"}),e(X,{label:"prompt",children:e(w,{name:"config.prompt",defaultValue:"",control:t,render:({field:s})=>e(ae,{toggleId:"prompt",onToggle:()=>i(!d),onSelect:l=>{s.onChange(l),i(!1)},selections:s.value||n("prompts.unspecified"),variant:ne.single,"aria-label":n("prompt"),isOpen:d,children:Object.entries(ft).map(([l,g])=>e(z,{selected:g===s.value,value:g,children:n(`prompts.${l}`)},l))})})}),e(c,{field:"config.acceptsPromptNoneForwardFromClient",label:"acceptsPromptNone"}),e(F,{label:n("allowedClockSkew"),labelIcon:e(R,{helpText:n("allowedClockSkewHelp"),fieldLabelId:"allowedClockSkew"}),fieldId:"allowedClockSkew",children:e(w,{name:"config.allowedClockSkew",defaultValue:0,control:t,render:({field:s})=>{const l=Number(s.value);return e(Ve,{"data-testid":"allowedClockSkew",inputName:"allowedClockSkew",min:0,max:2147483,value:l,readOnly:!0,onPlus:()=>s.onChange(l+1),onMinus:()=>s.onChange(l-1),onChange:g=>{const p=Number(g.target.value);s.onChange(p<0?0:p)}})}})}),e(Q,{field:"config.forwardParameters",label:"forwardParameters"})]})})},ge=["exact","minimum","maximum","better"],bt=()=>{const{t:n}=M(),{control:t}=K(),[a,r]=I(!1);return b(N,{children:[e(F,{label:n("comparison"),labelIcon:e(R,{helpText:n("comparisonHelp"),fieldLabelId:"comparison"}),fieldId:"comparison",children:e(w,{name:"config.authnContextComparisonType",defaultValue:ge[0],control:t,render:({field:d})=>e(ae,{toggleId:"comparison",direction:"up",onToggle:i=>r(i),onSelect:i=>{d.onChange(i.toString()),r(!1)},selections:d.value,variant:ne.single,"aria-label":n("comparison"),isOpen:a,children:ge.map(i=>e(z,{selected:i===d.value,value:i,children:n(i)},i))})})}),e(F,{label:n("authnContextClassRefs"),fieldId:"kc-authnContextClassRefs",labelIcon:e(R,{helpText:n("authnContextClassRefsHelp"),fieldLabelId:"authnContextClassRefs"}),children:e(me,{name:"config.authnContextClassRefs","aria-label":n("identify-providers:authnContextClassRefs"),addButtonLabel:"addAuthnContextClassRef","data-testid":"classref-field"})}),e(F,{label:n("authnContextDeclRefs"),fieldId:"kc-authnContextDeclRefs",labelIcon:e(R,{helpText:n("authnContextDeclRefsHelp"),fieldLabelId:"authnContextDeclRefs"}),children:e(me,{name:"config.authnContextDeclRefs","aria-label":n("identify-providers:authnContextDeclRefs"),addButtonLabel:"addAuthnContextDeclRef","data-testid":"declref-field"})})]})},yt=({onChange:n,value:t,save:a,toggleDeleteDialog:r})=>{const{adminClient:d}=ee(),{t:i}=M(),{alias:s}=ie(),[l,g]=I(),{addAlert:p,addError:v}=Ce(),{setValue:y,formState:u,control:f}=K(),x=A({control:f,name:"config.validateSignature"}),h=A({control:f,name:"config.useMetadataDescriptorUrl"}),T=A({control:f,name:"config.metadataDescriptorUrl"});te(()=>d.identityProviders.findOne({alias:s}),C=>{if(!C)throw new Error(i("notFound"));g(C)},[]);const[E,k]=Z({titleKey:"disableProvider",messageKey:i("disableConfirmIdentityProvider",{provider:s}),continueButtonLabel:"disable",onConfirm:()=>{n(!t),a()}}),_=async(C,P)=>{try{const D=await d.identityProviders.importFromUrl({providerId:C,fromUrl:P});D.signingCertificate?(y("config.signingCertificate",D.signingCertificate),p(i("importKeysSuccess"),L.success)):v("importKeysError",i("importKeysErrorNoSigningCertificate"))}catch(D){v("importKeysError",D)}},B=async C=>{try{await d.identityProviders.reloadKeys({alias:C})?p(i("reloadKeysSuccess"),L.success):p(i("reloadKeysSuccessButFalse"),L.warning)}catch(P){v("reloadKeysError",P)}};return b(N,{children:[e(k,{}),e(it,{titleKey:Ye(l?l.displayName?l.displayName:l.providerId:""),divider:!1,dropdownItems:[...l?.providerId?.includes("saml")&&x==="true"&&h==="true"&&T&&!u.isDirty&&t?[e(W,{onClick:()=>B(l.alias),children:i("reloadKeys")},"reloadKeys")]:l?.providerId?.includes("saml")&&x==="true"&&h!=="true"&&T&&!u.isDirty?[e(W,{onClick:()=>_(l.providerId,T),children:i("importKeys")},"importKeys")]:[],e(Ie,{},"separator"),e(W,{onClick:()=>r(),children:i("delete")},"delete")],isEnabled:t,onToggle:C=>{C?(n(C),a()):E()}})]})},ht=({name:n,mapperId:t,provider:a})=>{const{realm:r}=ve(),{alias:d}=ie();return e(Se,{to:Ze({realm:r,alias:d,providerId:a?.providerId,id:t}),children:n})};function ra(){const{adminClient:n}=ee(),{t}=M(),{alias:a,providerId:r}=ie(),d=be(),i=Ae(),{handleSubmit:s,getValues:l,reset:g}=i,[p,v]=I(),[y,u]=I(),f=Ke(),x=Qe(()=>{const o=["org.keycloak.broker.social.SocialIdentityProvider","org.keycloak.broker.provider.IdentityProvider"];for(const m of o){const O=f.componentTypes?.[m]?.find(({id:S})=>S===r);if(O)return O}},[f,r]),{addAlert:h,addError:T}=Ce(),E=Be(),{realm:k,realmRepresentation:_}=ve(),[B,C]=I(0),P=()=>C(B+1),{hasAccess:D}=He();te(()=>n.identityProviders.findOne({alias:a}),o=>{if(!o)throw new Error(t("notFound"));g(o),v(o),o.config.authnContextClassRefs&&i.setValue("config.authnContextClassRefs",JSON.parse(o.config?.authnContextClassRefs)),o.config.authnContextDeclRefs&&i.setValue("config.authnContextDeclRefs",JSON.parse(o.config?.authnContextDeclRefs))},[]);const oe=o=>ce({realm:k,alias:a,providerId:r,tab:o}),H=o=>at(oe(o)),xe=H("settings"),Te=H("mappers"),ke=H("permissions"),Fe=H("events"),U=async o=>{const m=o||l(),O=m.config?.authnContextClassRefs;m.config?.authnContextClassRefs&&(m.config.authnContextClassRefs=JSON.stringify(m.config.authnContextClassRefs));const S=m.config?.authnContextDeclRefs;m.config?.authnContextDeclRefs&&(m.config.authnContextDeclRefs=JSON.stringify(m.config.authnContextDeclRefs));try{await n.identityProviders.update({alias:a},{...m,config:{...p?.config,...m.config},alias:a,providerId:r}),O&&(m.config.authnContextClassRefs=O),S&&(m.config.authnContextDeclRefs=S),g(m),h(t("updateSuccessIdentityProvider"),L.success)}catch(G){T("updateErrorIdentityProvider",G)}},[Re,we]=Z({titleKey:"deleteProvider",messageKey:t("deleteConfirmIdentityProvider",{provider:a}),continueButtonLabel:"delete",continueButtonVariant:de.danger,onConfirm:async()=>{try{await n.identityProviders.del({alias:a}),h(t("deletedSuccessIdentityProvider"),L.success),E(Ue({realm:k}))}catch(o){T("deleteErrorIdentityProvider",o)}}}),[Pe,De]=Z({titleKey:"deleteProviderMapper",messageKey:t("deleteMapperConfirm",{mapper:y?.name}),continueButtonLabel:"delete",continueButtonVariant:de.danger,onConfirm:async()=>{try{await n.identityProviders.delMapper({alias:a,id:y?.mapperId}),h(t("deleteMapperSuccess"),L.success),P(),E(ce({providerId:r,alias:a,tab:"mappers",realm:k}))}catch(o){T("deleteErrorIdentityProvider",o)}}});if(!p)return e(qe,{});const q=p.providerId.includes("oidc"),V=p.providerId.includes("saml"),Oe=!q&&!V,Ne=async()=>{const[o,m]=await Promise.all([n.identityProviders.findMappers({alias:a}),n.identityProviders.findMapperTypes({alias:a})]);return o.map(S=>{const G=Object.values(m).find(Me=>S.identityProviderMapper===Me.id);return{...G,name:S.name,type:G?.name,mapperId:S.id}})},Le=[{title:t("generalSettings"),panel:b(Y,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:s(U),children:[Oe&&e(pt,{create:!1,id:r}),q&&e(ot,{}),V&&e(lt,{isAliasReadonly:!0}),x&&e(Xe,{stringify:!0,properties:x.properties})]})},{title:t("oidcSettings"),isHidden:!q,panel:b(N,{children:[e(rt,{readOnly:!1}),b(he,{isHorizontal:!0,className:"pf-v5-u-py-lg",children:[e(Ie,{}),e(st,{create:!1})]}),e(gt,{})]})},{title:t("samlSettings"),isHidden:!V,panel:e(dt,{readOnly:!1})},{title:t("reqAuthnConstraints"),isHidden:!V,panel:e(Y,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:s(U),children:e(bt,{})})},{title:t("advancedSettings"),panel:b(Y,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:s(U),children:[e(ut,{isOIDC:q,isSAML:V}),e(et,{name:"idp-details",isSubmit:!0,reset:g})]})}];return b(Ge,{...i,children:[e(we,{}),e(De,{}),e(w,{name:"enabled",control:i.control,defaultValue:!0,render:({field:o})=>e(yt,{value:o.value||!1,onChange:o.onChange,save:U,toggleDeleteDialog:Re})}),e(Je,{variant:"light",className:"pf-v5-u-p-0",children:b(nt,{isBox:!0,defaultLocation:oe("settings"),children:[e(j,{id:"settings",title:e($,{children:t("settings")}),...xe,children:e(je,{label:t("jumpToSection"),className:"pf-v5-u-px-lg",sections:Le})}),e(j,{id:"mappers","data-testid":"mappers-tab",title:e($,{children:t("mappers")}),...Te,children:e($e,{emptyState:e(We,{message:t("noMappers"),instructions:t("noMappersInstructions"),primaryActionText:t("addMapper"),onPrimaryAction:()=>E(pe({realm:k,alias:a,providerId:p.providerId,tab:"mappers"}))}),loader:Ne,ariaLabelKey:"mappersList",searchPlaceholderKey:"searchForMapper",toolbarItem:e(ze,{children:e(_e,{id:"add-mapper-button",component:o=>e(Se,{...o,to:pe({realm:k,alias:a,providerId:p.providerId,tab:"mappers"})}),"data-testid":"addMapper",children:t("addMapper")})}),columns:[{name:"name",displayKey:"name",cellRenderer:o=>e(ht,{...o,provider:p})},{name:"category",displayKey:"category"},{name:"type",displayKey:"type"}],actions:[{title:t("delete"),onRowClick:o=>{u(o),Pe()}}]},B)}),d(ye.AdminFineGrainedAuthz)&&e(j,{id:"permissions","data-testid":"permissionsTab",title:e($,{children:t("permissions")}),...ke,children:e(tt,{id:a,type:"identityProviders"})}),_?.adminEventsEnabled&&D("view-events")&&e(j,{"data-testid":"admin-events-tab",title:e($,{children:t("adminEvents")}),...Fe,children:e(mt,{resourcePath:`identity-provider/instances/${a}`})})]})})]})}export{ra as default};
//# sourceMappingURL=DetailSettings-Cc5RWKWf.js.map
