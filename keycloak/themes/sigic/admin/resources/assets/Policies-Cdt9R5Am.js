import{as as H,ar as $,dI as re,dJ as oe,a as k,L as R,ap as le,l as ce,z as W,aI as de,n as me,F as pe,Y as v,$ as ue,A as he,h as F,aj as Pe,u as ye,V as ge,d as fe,b as be,j as ve,q as Ce,aS as xe,y as De,P as Ne,dK as q,dL as B,ax as Te,aM as ke,bm as Ee,au as I,aG as g,aN as Se,aL as p,dM as we,br as Ae,bj as Le,bq as _e,bp as je,T as Y,f as J}from"./main-Dml5vH_M.js";import*as G from"react";import{useEffect as ze,useState as f}from"react";import{jsxs as r,jsx as e,Fragment as b}from"react/jsx-runtime";import{u as Ie}from"./ConfirmDialog-BN0phSta.js";import{a as Re,b as Fe,c as Me,D as Oe}from"./DescriptionListTerm-DCQWux3S.js";import{N as U}from"./NewPolicyDialog-Diogklhm.js";import{u as He}from"./useIsAdminPermissionsClient-IDuSpu5V.js";const $e=s=>{var{className:t,children:l}=s,i=H(s,["className","children"]);return G.createElement("div",Object.assign({className:$(re.panelHeader,t)},i),l)};$e.displayName="PanelHeader";var M;(function(s){s.ul="ul",s.ol="ol",s.dl="dl"})(M||(M={}));const Ge=s=>{var{children:t=null,className:l="",component:i=M.ul,isPlain:a=!1}=s,c=H(s,["children","className","component","isPlain"]);const o=i;return G.createElement(o,Object.assign({},c,{className:$(a&&oe.modifiers.plain,l)}),t)};Ge.displayName="TextList";var O;(function(s){s.li="li",s.dt="dt",s.dd="dd"})(O||(O={}));const Ke=s=>{var{children:t=null,className:l="",component:i=O.li}=s,a=H(s,["children","className","component"]);const c=i;return G.createElement(c,Object.assign({},a,{className:$(l)}),t)};Ke.displayName="TextListItem";function es(s){return e(Q,{...s})}function Q({name:s,array:t,convert:l,link:i}){const{t:a}=k();return r(Re,{children:[e(Fe,{children:a(s)}),r(Me,{children:[t?.map(c=>{const o=typeof c=="string"?c:l(c);return i?e(R,{to:i(c),className:"pf-v5-u-pr-sm",children:o},o):e("span",{className:"pf-v5-u-pr-sm",children:o},o)}),t?.length===0&&e("i",{children:a("none")})]})]})}const Ve=({array:s})=>{const{t}=k();return!s||s.length<=1?null:e(le,{color:"blue",children:t("more",{count:s.length-1})})},qe=({types:s,search:t,onSearch:l,type:i})=>{const{t:a}=k(),c=ce({mode:"onChange"}),{reset:o,formState:{isDirty:C},handleSubmit:y}=c,[x,u]=W(),E=m=>{u(),l(m)};return ze(()=>o(t),[t]),e(de,{onOpenChange:u,toggle:m=>r(Pe,{"data-testid":"searchdropdown_dorpdown",ref:m,onClick:u,className:"keycloak__client_authentication__searchdropdown",children:[i==="resource"&&a("searchClientAuthorizationResource"),i==="policy"&&a("searchClientAuthorizationPolicy"),i==="permission"&&a("searchClientAuthorizationPermission")]}),isOpen:x,children:e(me,{...c,children:r(pe,{isHorizontal:!0,className:"keycloak__client_authentication__searchdropdown_form",onSubmit:y(E),children:[e(v,{name:"name",label:a("name")}),i==="resource"&&r(b,{children:[e(v,{name:"type",label:a("type")}),e(v,{name:"uris",label:a("uris")}),e(v,{name:"owner",label:a("owner")})]}),i!=="resource"&&i!=="policy"&&e(v,{name:"resource",label:a("resource")}),i!=="policy"&&e(v,{name:"scope",label:a("scope")}),i!=="resource"&&e(ue,{name:"type",label:a("type"),controller:{defaultValue:""},options:[{key:"",value:a("allTypes")},...(s||[]).map(({type:m,name:S})=>({key:m,value:S}))]}),r(he,{children:[e(F,{variant:"primary",type:"submit","data-testid":"search-btn",isDisabled:!C,children:a("search")}),e(F,{variant:"link","data-testid":"revert-btn",onClick:()=>l({}),children:a("clear")})]})]})})})},Be=({row:s})=>r(b,{children:[s.dependentPolicies?.[0]?.name," ",e(Ve,{array:s.dependentPolicies})]}),ss=({clientId:s,isDisabled:t=!1})=>{const{adminClient:l}=ye(),{t:i}=k(),{addAlert:a,addError:c}=ge(),{realm:o}=fe(),C=be(),[y,x]=f(),[u,E]=f(),[m,S]=f(),[K,X]=f(0),Z=()=>X(K+1),[w,ee]=f(10),[A,L]=f(0),[D,se]=f({}),[V,N]=W(),h=He(s);ve(async()=>{const n=await l.clients.listPolicies({first:A,max:w+1,id:s,permission:"false",...D});return await Promise.all([l.clients.listPolicyProviders({id:s}),...(n||[]).map(async P=>{const d=await l.clients.listDependentPolicies({id:s,policyId:P.id});return{...P,dependentPolicies:d,isExpanded:!1}})])},([n,...P])=>{S(n.filter(d=>d.type!=="resource"&&d.type!=="scope")),x(P)},[K,D,A,w]);const[ne,ie]=Ie({titleKey:"deletePolicy",children:r(b,{children:[i("deletePolicyConfirm"),u?.dependentPolicies&&u.dependentPolicies.length>0&&e(xe,{variant:"warning",isInline:!0,isPlain:!0,component:"p",title:i("deletePolicyWarning"),className:"pf-v5-u-pt-lg",children:e("p",{className:"pf-v5-u-pt-xs",children:u.dependentPolicies.map(n=>e("strong",{className:"pf-v5-u-pr-md",children:n.name},n.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await l.clients.delPolicy({id:s,policyId:u?.id}),a(i("policyDeletedSuccess"),Ce.success),Z()}catch(n){c("policyDeletedError",n)}}});if(!y)return e(De,{});const T=y.length===0,_=Object.keys(D).length!==0;return r(Ne,{variant:"light",className:"pf-v5-u-p-0",children:[e(ie,{}),(!T||_)&&r(b,{children:[V&&e(U,{policyProviders:m,onSelect:n=>C(h?q({realm:o,permissionClientId:s,policyType:n.type}):B({id:s,realm:o,policyType:n.type})),toggleDialog:N}),e(Te,{count:y.length,first:A,max:w,onNextClick:L,onPreviousClick:L,onPerPageSelect:(n,P)=>{L(n),ee(P)},toolbarItem:r(b,{children:[e(Y,{children:e(qe,{types:m,search:D,onSearch:se,type:"policy"})}),e(Y,{children:e(F,{"data-testid":"createPolicy",onClick:()=>{N()},isDisabled:t,children:i(h?"createPermissionPolicy":"createPolicy")})})]}),children:!T&&r(ke,{"aria-label":i("resources"),variant:"compact",children:[e(Ee,{children:r(I,{children:[e(g,{"aria-hidden":"true"}),e(g,{children:i("name")}),e(g,{children:i("type")}),e(g,{children:i("dependentPermission")}),e(g,{children:i("description")}),e(g,{"aria-hidden":"true"})]})}),y.map((n,P)=>r(Se,{isExpanded:n.isExpanded,children:[r(I,{children:[e(p,{expand:{rowIndex:P,isExpanded:n.isExpanded,onToggle:(d,j)=>{const ae=y.map((z,te)=>te===j?{...z,isExpanded:!z.isExpanded}:z);x(ae)}}}),e(p,{"data-testid":`name-column-${n.name}`,children:h?e(R,{to:we({realm:o,permissionClientId:s,policyId:n.id,policyType:n.type}),children:n.name}):e(R,{to:Ae({realm:o,id:s,policyType:n.type,policyId:n.id}),children:n.name})}),e(p,{children:Le(n.type)}),e(p,{children:e(Be,{row:n})}),e(p,{children:n.description}),!t&&e(p,{actions:{items:[{title:i("delete"),onClick:()=>{E(n),ne()}}]}})]}),r(I,{isExpanded:n.isExpanded,children:[e(p,{}),e(p,{colSpan:3+(t?0:1),children:r(_e,{children:[n.isExpanded&&!h&&e(Oe,{isHorizontal:!0,className:"keycloak_resource_details",children:e(Q,{name:"dependentPermission",array:n.dependentPolicies,convert:d=>d.name,link:d=>je({realm:o,id:s,permissionId:d.id,permissionType:d.type})})}),n.isExpanded&&h&&r(b,{children:[e(g,{children:i("dependentPermission")}),n.dependentPolicies.map((d,j)=>e(p,{children:e("span",{style:{marginLeft:"8px"},children:d.name})},j))]})]})})]},`child-${n.id}`)]},n.id))]})})]}),T&&_&&e(J,{isSearchVariant:!0,isDisabled:t,message:i("noSearchResults"),instructions:i("noSearchResultsInstructions")}),T&&!_&&r(b,{children:[V&&e(U,{policyProviders:m?.filter(n=>n.type!=="aggregate"),onSelect:n=>C(h?q({realm:o,permissionClientId:s,policyType:n.type}):B({id:s,realm:o,policyType:n.type})),toggleDialog:N}),e(J,{message:i("emptyPolicies"),instructions:i(h?"emptyPermissionPoliciesInstructions":"emptyPoliciesInstructions"),isDisabled:t,primaryActionText:i(h?"createPermissionPolicy":"createPolicy"),onPrimaryAction:()=>N()})]})]})};export{ss as A,Q as D,Ve as M,$e as P,qe as S,Ge as T,Ke as a,es as b,M as c,O as d};
//# sourceMappingURL=Policies-Cdt9R5Am.js.map
