{"version":3,"file":"ResourceDetails-CMcQCZPp.js","sources":["../../../../../../../src/clients/authorization/ResourceDetails.tsx"],"sourcesContent":["import type ClientRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/clientRepresentation\";\nimport type ResourceRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/resourceRepresentation\";\nimport type ResourceServerRepresentation from \"@keycloak/keycloak-admin-client/lib/defs/resourceServerRepresentation\";\nimport {\n  HelpItem,\n  TextControl,\n  useAlerts,\n  useFetch,\n} from \"@keycloak/keycloak-ui-shared\";\nimport {\n  ActionGroup,\n  Alert,\n  AlertVariant,\n  Button,\n  ButtonVariant,\n  DropdownItem,\n  FormGroup,\n  PageSection,\n} from \"@patternfly/react-core\";\nimport { useState } from \"react\";\nimport { FormProvider, useForm } from \"react-hook-form\";\nimport { useTranslation } from \"react-i18next\";\nimport { Link, useNavigate } from \"react-router-dom\";\nimport { useAdminClient } from \"../../admin-client\";\nimport { DefaultSwitchControl } from \"../../components/SwitchControl\";\nimport { useConfirmDialog } from \"../../components/confirm-dialog/ConfirmDialog\";\nimport { FormAccess } from \"../../components/form/FormAccess\";\nimport { KeyValueInput } from \"../../components/key-value-form/KeyValueInput\";\nimport type { KeyValueType } from \"../../components/key-value-form/key-value-convert\";\nimport { KeycloakSpinner } from \"@keycloak/keycloak-ui-shared\";\nimport { MultiLineInput } from \"../../components/multi-line-input/MultiLineInput\";\nimport { ViewHeader } from \"../../components/view-header/ViewHeader\";\nimport { useAccess } from \"../../context/access/Access\";\nimport { convertFormValuesToObject, convertToFormValues } from \"../../util\";\nimport { useParams } from \"../../utils/useParams\";\nimport { toAuthorizationTab } from \"../routes/AuthenticationTab\";\nimport { ResourceDetailsParams, toResourceDetails } from \"../routes/Resource\";\nimport { ScopePicker } from \"./ScopePicker\";\nimport \"./resource-details.css\";\n\ntype SubmittedResource = Omit<\n  ResourceRepresentation,\n  \"attributes\" | \"scopes\"\n> & {\n  attributes: KeyValueType[];\n};\n\nexport default function ResourceDetails() {\n  const { adminClient } = useAdminClient();\n\n  const { t } = useTranslation();\n  const [client, setClient] = useState<ClientRepresentation>();\n  const [resource, setResource] = useState<ResourceRepresentation>();\n\n  const [permissions, setPermission] =\n    useState<ResourceServerRepresentation[]>();\n\n  const { addAlert, addError } = useAlerts();\n  const form = useForm<SubmittedResource>({\n    mode: \"onChange\",\n  });\n  const { setValue, handleSubmit } = form;\n\n  const { id, resourceId, realm } = useParams<ResourceDetailsParams>();\n  const navigate = useNavigate();\n\n  const setupForm = (resource: ResourceRepresentation = {}) => {\n    convertToFormValues(resource, setValue);\n  };\n\n  const { hasAccess } = useAccess();\n\n  const isDisabled = !hasAccess(\"manage-authorization\");\n\n  useFetch(\n    () =>\n      Promise.all([\n        adminClient.clients.findOne({ id }),\n        resourceId\n          ? adminClient.clients.getResource({ id, resourceId })\n          : Promise.resolve(undefined),\n        resourceId\n          ? adminClient.clients.listPermissionsByResource({ id, resourceId })\n          : Promise.resolve(undefined),\n      ]),\n    ([client, resource, permissions]) => {\n      if (!client) {\n        throw new Error(t(\"notFound\"));\n      }\n      setClient(client);\n      setPermission(permissions);\n      setResource(resource);\n      setupForm(resource);\n    },\n    [],\n  );\n\n  const submit = async (submitted: SubmittedResource) => {\n    const resource = convertFormValuesToObject<\n      SubmittedResource,\n      ResourceRepresentation\n    >(submitted);\n\n    try {\n      if (resourceId) {\n        await adminClient.clients.updateResource({ id, resourceId }, resource);\n      } else {\n        const result = await adminClient.clients.createResource(\n          { id },\n          resource,\n        );\n        setResource(resource);\n        navigate(toResourceDetails({ realm, id, resourceId: result._id! }));\n      }\n      addAlert(\n        t((resourceId ? \"update\" : \"create\") + \"ResourceSuccess\"),\n        AlertVariant.success,\n      );\n    } catch (error) {\n      addError(\"resourceSaveError\", error);\n    }\n  };\n\n  const [toggleDeleteDialog, DeleteConfirm] = useConfirmDialog({\n    titleKey: \"deleteResource\",\n    children: (\n      <>\n        {t(\"deleteResourceConfirm\")}\n        {permissions?.length !== 0 && (\n          <Alert\n            variant=\"warning\"\n            isInline\n            isPlain\n            title={t(\"deleteResourceWarning\")}\n            className=\"pf-v5-u-pt-lg\"\n          >\n            <p className=\"pf-v5-u-pt-xs\">\n              {permissions?.map((permission) => (\n                <strong key={permission.id} className=\"pf-v5-u-pr-md\">\n                  {permission.name}\n                </strong>\n              ))}\n            </p>\n          </Alert>\n        )}\n      </>\n    ),\n    continueButtonLabel: \"confirm\",\n    onConfirm: async () => {\n      try {\n        await adminClient.clients.delResource({\n          id,\n          resourceId: resourceId!,\n        });\n        addAlert(t(\"resourceDeletedSuccess\"), AlertVariant.success);\n        navigate(toAuthorizationTab({ realm, clientId: id, tab: \"resources\" }));\n      } catch (error) {\n        addError(\"resourceDeletedError\", error);\n      }\n    },\n  });\n\n  if (!client) {\n    return <KeycloakSpinner />;\n  }\n\n  return (\n    <>\n      <DeleteConfirm />\n      <ViewHeader\n        titleKey={resourceId ? resource?.name! : \"createResource\"}\n        dropdownItems={\n          resourceId\n            ? [\n                <DropdownItem\n                  key=\"delete\"\n                  data-testid=\"delete-resource\"\n                  isDisabled={isDisabled}\n                  onClick={() => toggleDeleteDialog()}\n                >\n                  {t(\"delete\")}\n                </DropdownItem>,\n              ]\n            : undefined\n        }\n      />\n      <PageSection variant=\"light\">\n        <FormProvider {...form}>\n          <FormAccess\n            isHorizontal\n            role=\"manage-authorization\"\n            className=\"keycloak__resource-details__form\"\n            onSubmit={handleSubmit(submit)}\n          >\n            <TextControl\n              name={resourceId ? \"owner.name\" : \"\"}\n              label={t(\"owner\")}\n              labelIcon={t(\"ownerHelp\")}\n              defaultValue={client.clientId}\n              readOnly\n            />\n            <TextControl\n              name={\"name\"}\n              label={t(\"name\")}\n              labelIcon={t(\"resourceNameHelp\")}\n              rules={{ required: t(\"required\") }}\n            />\n            <TextControl\n              name=\"displayName\"\n              label={t(\"displayName\")}\n              labelIcon={t(\"displayNameHelp\")}\n              rules={{ required: t(\"required\") }}\n            />\n            <TextControl\n              name=\"type\"\n              label={t(\"type\")}\n              labelIcon={t(\"resourceDetailsTypeHelp\")}\n            />\n            <FormGroup\n              label={t(\"uris\")}\n              fieldId=\"uris\"\n              labelIcon={\n                <HelpItem helpText={t(\"urisHelp\")} fieldLabelId=\"uris\" />\n              }\n            >\n              <MultiLineInput\n                name=\"uris\"\n                type=\"url\"\n                aria-label={t(\"uris\")}\n                addButtonLabel=\"addUri\"\n              />\n            </FormGroup>\n            <ScopePicker clientId={id} />\n            <TextControl\n              name=\"icon_uri\"\n              label={t(\"iconUri\")}\n              labelIcon={t(\"iconUriHelp\")}\n              type=\"url\"\n            />\n            <DefaultSwitchControl\n              name=\"ownerManagedAccess\"\n              label={t(\"ownerManagedAccess\")}\n              labelIcon={t(\"ownerManagedAccessHelp\")}\n            />\n            <FormGroup\n              hasNoPaddingTop\n              label={t(\"resourceAttribute\")}\n              labelIcon={\n                <HelpItem\n                  helpText={t(\"resourceAttributeHelp\")}\n                  fieldLabelId=\"resourceAttribute\"\n                />\n              }\n              fieldId=\"resourceAttribute\"\n            >\n              <KeyValueInput name=\"attributes\" isDisabled={isDisabled} />\n            </FormGroup>\n            <ActionGroup>\n              <div className=\"pf-v5-u-mt-md\">\n                <Button\n                  variant={ButtonVariant.primary}\n                  type=\"submit\"\n                  data-testid=\"save\"\n                >\n                  {t(\"save\")}\n                </Button>\n\n                <Button\n                  variant=\"link\"\n                  data-testid=\"cancel\"\n                  component={(props) => (\n                    <Link\n                      {...props}\n                      to={toAuthorizationTab({\n                        realm,\n                        clientId: id,\n                        tab: \"resources\",\n                      })}\n                    ></Link>\n                  )}\n                >\n                  {t(\"cancel\")}\n                </Button>\n              </div>\n            </ActionGroup>\n          </FormAccess>\n        </FormProvider>\n      </PageSection>\n    </>\n  );\n}\n"],"names":["ResourceDetails","adminClient","useAdminClient","t","useTranslation","client","setClient","useState","resource","setResource","permissions","setPermission","addAlert","addError","useAlerts","form","useForm","setValue","handleSubmit","id","resourceId","realm","useParams","navigate","useNavigate","setupForm","convertToFormValues","hasAccess","useAccess","isDisabled","useFetch","submit","submitted","convertFormValuesToObject","result","toResourceDetails","AlertVariant","error","toggleDeleteDialog","DeleteConfirm","useConfirmDialog","jsxs","Fragment","jsx","Alert","permission","toAuthorizationTab","ViewHeader","DropdownItem","PageSection","FormProvider","FormAccess","TextControl","FormGroup","HelpItem","MultiLineInput","ScopePicker","DefaultSwitchControl","KeyValueInput","ActionGroup","Button","ButtonVariant","props","Link","KeycloakSpinner"],"mappings":"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"}