import{jsx as e,jsxs as y,Fragment as pe}from"react/jsx-runtime";import{u as $,b as j,d as q,a as z,ak as be,P as G,w as he,aU as C,c3 as fe,f as Re,h as R,C as ye,a$ as ge,l as ve,V as we,aO as Ce,J as x,j as L,aX as O,c4 as Te,c5 as ke,B as Ae,q as D,y as Ie,D as Fe,n as Ne,ba as U,c6 as W,b0 as De,c7 as Ee,bA as Pe,c8 as Ve,bV as Be}from"./main-Dml5vH_M.js";import{useState as T}from"react";import{u as Ke}from"./ConfirmDialog-BN0phSta.js";import{A as Se}from"./AttributeForm-yvG_5yiW.js";import{P as Me}from"./PermissionTab-DRVls294.js";import{R as xe}from"./RoleForm-D3e2OPAA.js";import{A as Le,R as Oe}from"./AddRoleMappingModal-FlNvMd3n.js";import{u as p,R as Ue}from"./RoutableTabs-D0MTj5jQ.js";import{V as We}from"./ViewHeader-CnGpO8mW.js";import{u as Q}from"./useParams-Cmi1OAEj.js";import{Q as $e}from"./question-circle-icon-CcYP0FMt.js";import{A as je}from"./AdminEvents-BQlKf8zR.js";import{a as b,b as h}from"./Tabs-swfKYDgo.js";import"react-dom";import"./FormAccess-Dgk035ov.js";import"./KeyValueInput-CataZRq4.js";import"./KeySelect-Ba6sDuzD.js";import"./useLocaleSort-DeXbTEE9.js";import"./Trans-BHLWmjXF.js";import"./translationFormatter-DtFomvax.js";import"./filter-icon-BO7Evf9d.js";import"./PageHandler-BQ1_55gR.js";import"./DynamicComponents-Cxsqsl9R.js";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./MultiLineInput-BnUu5qtj.js";import"./CodeEditor-C7HQ48Ys.js";import"./constants-BclHbWtx.js";import"./DropdownPanel-CdQAMxBj.js";import"./useFormatDate-Puc65BKQ.js";import"./DatePicker-CU4S68sS.js";import"./pickBy-BQkB_pck.js";import"./DescriptionListTerm-DCQWux3S.js";const qe=()=>{const{adminClient:i}=$(),d=j(),{realm:a}=q(),{t:s}=z(),{id:g,clientId:k}=Q(),A=async(o,l)=>{const n=await i.roles.findOneById({id:g});if(!n)throw new Error(s("notFound"));return n.clientRole?i.clients.findUsersWithRole({roleName:n.name,id:k,briefRepresentation:!0,first:o,max:l}):i.roles.findUsersWithRole({name:n.name,briefRepresentation:!0,first:o,max:l})},{enabled:v}=be();return e(G,{"data-testid":"users-page",variant:"light",children:e(he,{isPaginated:!0,loader:A,ariaLabelKey:"roleList",searchPlaceholderKey:"","data-testid":"users-in-role-table",toolbarItem:v&&e(ye,{"aria-label":"Basic popover",position:"bottom",bodyContent:y("div",{children:[s("whoWillAppearPopoverTextRoles"),e(R,{className:"kc-groups-link",variant:"link",onClick:()=>d(`/${a}/groups`),children:s("groups")}),s("or"),y(R,{className:"kc-users-link",variant:"link",onClick:()=>d(`/${a}/users`),children:[s("users"),"."]})]}),footerContent:s("whoWillAppearPopoverFooterText"),children:e(R,{variant:"link",className:"kc-who-will-appear-button",icon:e($e,{}),children:s("whoWillAppearLinkTextRoles")},"who-will-appear-button")}),emptyState:e(Re,{hasIcon:!0,message:s("noDirectUsers"),instructions:y("div",{children:[s("noUsersEmptyStateDescription"),e(R,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>d(`/${a}/groups`),children:s("groups")}),s("or"),e(R,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>d(`/${a}/users`),children:s("users")}),s("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"userName",cellFormatters:[C()]},{name:"email",displayKey:"email",cellFormatters:[C()]},{name:"lastName",displayKey:"lastName",cellFormatters:[C()]},{name:"firstName",displayKey:"firstName",cellFormatters:[fe(),C()]}]})})};function Ft(){const{adminClient:i}=$(),d=ge(),{t:a}=z(),s=ve({mode:"onChange"}),{control:g,reset:k,setValue:A}=s,v=j(),{id:o,clientId:l}=Q(),{realm:n,realmRepresentation:w}=q(),[E,H]=T(0),[J,P]=T(),X=()=>H(E+1),{addAlert:I,addError:F}=we(),{hasAccess:V}=Ce(),Y=V("query-clients","manage-authorization"),[Z,_]=T(!1),[ee,te]=T(!1),ae=t=>{const{attributes:r,...N}=t;return{attributes:Ee(r),...N}},m=x({control:g,defaultValue:void 0,name:"name"}),se=x({control:g,defaultValue:!1,name:"composite"});L(async()=>i.roles.findOneById({id:o}),t=>{if(!t)throw new Error(a("notFound"));const r=ae(t);k(r),P(r.attributes)},[E]),L(async()=>i.clients.findOne({id:l}),t=>{l&&_(t?.access?.manage)},[]);const B=async t=>{try{const{attributes:r,...N}=t,f=N;f.name=f.name?.trim(),f.attributes=Pe(r),l?await i.clients.updateRole({id:l,roleName:t.name},f):await i.roles.updateById({id:o},f),P(r),I(a("roleSaveSuccess"),D.success)}catch(r){F("roleSaveError",r)}},K=O(Te.path),u=O(ke.path),re=()=>{if(K)return W({realm:n});if(u)return U({realm:n,clientId:u.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},c=t=>{if(K)return Ve({realm:n,id:o,tab:t});if(u)return Be({realm:n,id:o,clientId:u.params.clientId,tab:t});throw new Error("Route could not be determined.")},oe=p(c("details")),ie=p(c("associated-roles")),ne=p(c("attributes")),le=p(c("users-in-role")),ce=p(c("permissions")),me=p(c("events")),[de,ue]=Ke({titleKey:"roleDeleteConfirm",messageKey:a("roleDeleteConfirmDialog",{selectedRoleName:m||a("createRole")}),continueButtonLabel:"delete",continueButtonVariant:Ae.danger,onConfirm:async()=>{try{l?await i.clients.delRole({id:l,roleName:m}):await i.roles.delById({id:o}),I(a("roleDeletedSuccess"),D.success),v(re())}catch(t){F("roleDeleteError",t)}}}),S=async t=>{try{await i.roles.createComposite({roleId:o,realm:w.realm},t),X(),v(c("associated-roles")),I(a("addAssociatedRolesSuccess"),D.success)}catch(r){F("addAssociatedRolesError",r)}},M=t=>w?.defaultRole&&w.defaultRole.name===t;return w?y(pe,{children:[e(ue,{}),ee&&e(Le,{id:o,type:"roles",name:m,onAssign:t=>S(t.map(r=>r.role)),onClose:()=>te(!1)}),e(We,{titleKey:m,badges:[{id:"composite-role-badge",text:se?a("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:[e(Fe,{component:"button",onClick:()=>{de()},children:a("deleteRole")},"delete-role")],divider:!1}),e(G,{variant:"light",className:"pf-v5-u-p-0",children:e(Ne,{...s,children:y(Ue,{isBox:!0,mountOnEnter:!0,defaultLocation:c("details"),children:[e(b,{title:e(h,{children:a("details")}),...oe,children:e(xe,{form:s,onSubmit:B,role:u?"manage-clients":"manage-realm",cancelLink:u?U({realm:n,clientId:l,tab:"roles"}):W({realm:n}),editMode:!0})}),e(b,{"data-testid":"associatedRolesTab",title:e(h,{children:a("associatedRolesText")}),...ie,children:e(Oe,{name:m,id:o,type:"roles",isManager:!0,save:t=>S(t.map(r=>r.role))})}),!M(m)&&e(b,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(h,{children:a("attributes")}),...ne,children:e(Se,{form:s,save:B,fineGrainedAccess:Z,reset:()=>A("attributes",J,{shouldDirty:!1})})}),!M(m)&&e(b,{"data-testid":"usersInRoleTab",title:e(h,{children:a("usersInRole")}),...le,children:e(qe,{"data-cy":"users-in-role-tab"})}),d(De.AdminFineGrainedAuthz)&&Y&&e(b,{title:e(h,{children:a("permissions")}),...ce,children:e(Me,{id:o,type:"roles"})}),V("view-events")&&e(b,{"data-testid":"admin-events-tab",title:e(h,{children:a("adminEvents")}),...me,children:e(je,{resourcePath:`roles-by-id/${o}`})})]})})})]}):e(Ie,{})}export{Ft as default};
//# sourceMappingURL=RealmRoleTabs-BHNELYNE.js.map
