import{jsx as t,jsxs as c,Fragment as v}from"react/jsx-runtime";import{u as L,aO as S,d as se,j as R,h as M,L as oe,eX as le,bA as V,eh as de,ef as ce,c7 as ue,a as D,$ as me,bo as pe,V as be,cX as fe,b as he,n as Ae,K as f,bu as j,bv as y,a1 as T,O as I,f1 as ye,Y as g,ez as ge,X as ke,S as ve,N as Ie,U as Le,W as Oe,a5 as qe,q as U,dO as we}from"./main-Dml5vH_M.js";import{useState as h,useEffect as Ce}from"react";import{D as Fe}from"./SwitchControl-DVIXTwQM.js";import{F as Ge,b as xe}from"./FormAccess-Dgk035ov.js";import{G as Ve}from"./GroupPickerDialog-eQJqBPQt.js";import{u as je}from"./useFormatDate-Puc65BKQ.js";import{C as Te}from"./CopyToClipboardButton-BjKMP6CQ.js";const Ue=({user:r})=>{const{adminClient:s}=L(),e=S(),{realm:o}=se(),[n,l]=h();return R(()=>e.hasAccess("view-realm")?s.components.findOne({id:r.federationLink}):s.userStorageProvider.name({id:r.federationLink}),l,[]),n?e.hasAccess("view-realm")?t(M,{variant:"link",component:b=>t(oe,{...b,to:le({id:n.id,providerId:n.providerId,realm:o})}),children:n.name}):t("span",{children:n.name}):null};function Se(r){const s={};Object.entries(r.attributes||{}).forEach(([o,n])=>s[ce(o)]=n);const e=ue(r.unmanagedAttributes);return{...r,attributes:s,unmanagedAttributes:e}}function ze(r){const s=r.username?.trim(),e=Array.isArray(r.attributes)?V(r.attributes):Object.fromEntries(Object.entries(r.attributes||{}).map(([n,l])=>[de(n),l])),o=Array.isArray(r.unmanagedAttributes)?V(r.unmanagedAttributes):r.unmanagedAttributes;for(const n in o)if(e&&Object.hasOwn(e,n))throw Error(`Attribute ${n} is a managed attribute and is already available from the user details.`);return{...r,username:s,attributes:{...o,...e},unmanagedAttributes:void 0}}function Xe(r={},s={}){return Object.fromEntries(Object.entries(r).filter(([e])=>!Object.hasOwn(s,e)))}const Re=({name:r,label:s,help:e})=>{const{adminClient:o}=L(),{t:n}=D(),[l,b]=h([]);return R(()=>o.authenticationManagement.getRequiredActions(),u=>{const m=u.filter(A=>A.enabled);b(m)},[]),t(me,{name:r,label:n(s),labelIcon:n(e),controller:{defaultValue:[]},isScrollable:!0,maxMenuHeight:"375px",variant:pe.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:n("requiredActionPlaceholder"),menuAppendTo:"parent",options:l.map(({alias:u,name:m})=>({key:u,value:m||u}))})},Ke=({form:r,realm:s,user:e,bruteForce:{isBruteForceProtected:o,isLocked:n}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:l,save:b,refresh:u,onGroupsUpdate:m})=>{const{adminClient:A}=L(),{t:a}=D(),E=je(),{addAlert:O,addError:q}=be(),{hasAccess:w}=S(),H=w("manage-users"),N=w("view-realm"),{whoAmI:P}=fe(),B=P.getLocale(),{handleSubmit:$,setValue:C,control:z,reset:X,formState:K}=r,{errors:W}=K,[p,F]=h([]),[G,k]=h(!1),[x,Y]=h(n),_=he();Ce(()=>{C("requiredActions",e?.requiredActions||[])},[e,C]);const Z=async()=>{try{await A.users.update({id:e.id},{enabled:!0}),O(a("unlockSuccess"),U.success),u&&u()}catch(i){q("unlockError",i)}},J=i=>{F(p.filter(d=>d.name!==i)),m?.(p)},Q=async i=>{F([...p,...i]),m?.([...p,...i])},ee=async i=>{i.forEach(async ie=>{try{await A.users.addToGroup({id:e.id,groupId:ie.id}),O(a("addedGroupMembership"),U.success)}catch(ne){q("addedGroupMembershipError",ne)}})},te=()=>{k(!G)},ae=()=>{e?.id?X(Se(e)):_(we({realm:s.realm}))},re=()=>e?.userProfileMetadata?.attributes&&!e?.userProfileMetadata?.attributes?.map(i=>i.readOnly).reduce((i,d)=>i&&d,!0);return c(Ge,{isHorizontal:!0,onSubmit:$(b),role:"query-users",fineGrainedAccess:e?.access?.manage,className:"pf-v5-u-mt-lg",children:[c(Ae,{...r,children:[G&&t(Ve,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:H,onConfirm:i=>{e?.id?ee(i||[]):Q(i||[]),k(!1)},onClose:()=>k(!1),filterGroups:p}),e?.id&&c(v,{children:[t(f,{label:a("id"),fieldId:"kc-id",isRequired:!0,children:c(j,{children:[t(y,{isFill:!0,children:t(T,{id:e.id,"aria-label":a("userID"),value:e.id,readOnly:!0})}),t(y,{children:t(Te,{id:`user-${e.id}`,text:e.id,label:a("userID"),variant:"control"})})]})}),t(f,{label:a("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:t(T,{value:E(new Date(e.createdTimestamp)),id:"kc-created-at",readOnly:!0})})]}),t(Re,{name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),e?.federationLink&&N&&t(f,{label:a("federationLink"),labelIcon:t(I,{helpText:a("federationLinkHelp"),fieldLabelId:"federationLink"}),children:t(Ue,{user:e})}),l?c(v,{children:[t(Fe,{name:"emailVerified",label:a("emailVerified"),labelIcon:a("emailVerifiedHelp")}),t(ye,{form:r,userProfileMetadata:l,hideReadOnly:!e,supportedLocales:s.supportedLocales||[],currentLocale:B,t:(i,d)=>a(i,d)})]}):c(v,{children:[!s.registrationEmailAsUsername&&t(g,{name:"username",label:a("username"),readOnly:!!e?.id&&!s.editUsernameAllowed&&s.editUsernameAllowed!==void 0,rules:{required:a("required")}}),t(g,{name:"email",label:a("email"),type:"email",rules:{pattern:{value:ge,message:a("emailInvalid")}}}),t(ke,{name:"emailVerified",label:a("emailVerified"),labelIcon:a("emailVerifiedHelp"),labelOn:a("yes"),labelOff:a("no")}),t(g,{name:"firstName",label:a("firstName")}),t(g,{name:"lastName",label:a("lastName")})]}),o&&t(f,{label:a("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:t(I,{helpText:a("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:t(ve,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:(i,d)=>{Z(),Y(d)},isChecked:x,isDisabled:!x,label:a("on"),labelOff:a("off")})}),!e?.id&&c(f,{label:a("groups"),fieldId:"kc-groups",labelIcon:t(I,{helpText:a("groupsHelp"),fieldLabelId:"groups"}),children:[t(Ie,{name:"groups",defaultValue:[],control:z,render:()=>c(j,{children:[t(y,{children:t(Le,{categoryName:" ",children:p.map(i=>t(Oe,{onClick:()=>J(i.name),children:i.path},i.id))})}),t(y,{children:t(M,{id:"kc-join-groups-button",onClick:te,variant:"secondary","data-testid":"join-groups-button",children:a("joinGroups")})})]})}),W.requiredActions&&t(qe,{message:a("required")})]})]}),t(xe,{name:"user-creation",saveText:e?.id?a("save"):a("create"),reset:ae,resetText:e?.id?a("revert"):a("cancel"),isDisabled:re(),isSubmit:!0})]})};export{Ue as F,Re as R,Ke as U,Se as a,Xe as f,ze as t};
//# sourceMappingURL=UserForm-D8nvs5TZ.js.map
