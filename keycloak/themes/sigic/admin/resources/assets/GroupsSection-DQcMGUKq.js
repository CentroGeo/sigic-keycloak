import{jsxs as j,jsx as t,Fragment as J}from"react/jsx-runtime";import{as as ie,ar as U,ck as fe,a8 as $e,b_ as xe,cl as ct,b5 as je,b4 as Me,cm as Te,cn as Ae,at as lt,co as dt,cp as ut,cq as Re,cr as mt,cs as pt,a as P,ct as ne,d as re,cu as oe,cv as ht,cw as Ve,L as ue,u as H,V as ee,l as qe,j as ce,c7 as Oe,P as Pe,cx as ze,p as gt,q as me,a$ as He,M as We,m as Qe,n as ft,F as bt,aS as vt,Y as wt,aq as yt,h as Z,B as be,b0 as Ye,aO as le,z,T as te,aI as ve,aJ as we,D as X,aj as ye,aW as Ce,w as Ne,f as Ge,cy as Ct,ak as Nt,aT as De,ca as Ee,C as Gt,cz as Je,y as Xe,aU as he,bR as Et,ap as kt,bQ as It,b as ke,bk as _e,ax as St,bu as xt,bv as Le,aH as Ze,cA as se,cB as Mt,cC as Tt,cD as At,cE as Rt,cF as Vt,al as Ot,cG as Dt}from"./main-Dml5vH_M.js";import*as $ from"react";import D,{useState as S,useEffect as et,useRef as Ke}from"react";import{P as _t}from"./PermissionTab-DRVls294.js";import{V as Lt}from"./ViewHeader-CnGpO8mW.js";import{A as ge}from"./AdminEvents-BQlKf8zR.js";import{A as Kt}from"./AttributeForm-yvG_5yiW.js";import{R as Bt}from"./AddRoleMappingModal-FlNvMd3n.js";import{C as Ft}from"./ConfirmDialog-BN0phSta.js";import{G as Ut,a as $t}from"./GroupPickerDialog-eQJqBPQt.js";import{M as jt}from"./MembersModal-qkfTMBCn.js";import{s as qt}from"./sortBy-D3c44bb2.js";import{Q as Pt}from"./question-circle-icon-CcYP0FMt.js";import{b as zt}from"./_baseFlatten-BhRqdSvr.js";import{T as Be,a as Q,b as Y}from"./Tabs-swfKYDgo.js";import"react-dom";import"./useLocaleSort-DeXbTEE9.js";import"./Trans-BHLWmjXF.js";import"./DropdownPanel-CdQAMxBj.js";import"./CodeEditor-C7HQ48Ys.js";import"./useFormatDate-Puc65BKQ.js";import"./DatePicker-CU4S68sS.js";import"./pickBy-BQkB_pck.js";import"./DescriptionListTerm-DCQWux3S.js";import"./FormAccess-Dgk035ov.js";import"./KeyValueInput-CataZRq4.js";import"./KeySelect-Ba6sDuzD.js";import"./translationFormatter-DtFomvax.js";import"./filter-icon-BO7Evf9d.js";import"./DataListItemRow-B3J1tfyO.js";import"./differenceBy-BpiYyOKy.js";const tt=a=>{var{className:e="",children:n,hasNoPadding:o=!1}=a,c=ie(a,["className","children","hasNoPadding"]);return $.createElement("div",Object.assign({className:U(fe.drawerBody,o&&fe.modifiers.noPadding,e)},c),n)};tt.displayName="DrawerPanelBody";const at=a=>{var{className:e="",children:n,hasNoPadding:o=!1}=a,c=ie(a,["className","children","hasNoPadding"]);return $.createElement(tt,{hasNoPadding:o},$.createElement("div",Object.assign({className:U(fe.drawerHead,e)},c),n))};at.displayName="DrawerHead";const I={modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",selectable:"pf-m-selectable"},treeView:"pf-v5-c-tree-view",treeViewAction:"pf-v5-c-tree-view__action",treeViewContent:"pf-v5-c-tree-view__content",treeViewListItem:"pf-v5-c-tree-view__list-item",treeViewNode:"pf-v5-c-tree-view__node",treeViewNodeCheck:"pf-v5-c-tree-view__node-check",treeViewNodeContainer:"pf-v5-c-tree-view__node-container",treeViewNodeContent:"pf-v5-c-tree-view__node-content",treeViewNodeCount:"pf-v5-c-tree-view__node-count",treeViewNodeIcon:"pf-v5-c-tree-view__node-icon",treeViewNodeText:"pf-v5-c-tree-view__node-text",treeViewNodeTitle:"pf-v5-c-tree-view__node-title",treeViewNodeToggle:"pf-v5-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-v5-c-tree-view__node-toggle-icon"},nt=a=>{var{isNested:e=!1,isMultiSelectable:n=!1,toolbar:o,children:c,"aria-label":s,"aria-labelledby":r}=a,i=ie(a,["isNested","isMultiSelectable","toolbar","children","aria-label","aria-labelledby"]);return $.createElement($.Fragment,null,o&&$.createElement($.Fragment,null,o,$.createElement($e,null)),$.createElement("ul",Object.assign({className:U(`${I.treeView}__list`),role:e?"group":"tree","aria-multiselectable":e?void 0:n,"aria-label":s,"aria-labelledby":r},i),c))};nt.displayName="TreeViewList";const Ht=({name:a,title:e,id:n,isExpanded:o,defaultExpanded:c=!1,children:s=null,onSelect:r,onExpand:i,onCollapse:d,onCheck:l,hasCheckbox:p=!1,checkProps:T={checked:!1},hasBadge:h=!1,customBadgeContent:E,badgeProps:m={isRead:!0},isSelectable:v=!1,isCompact:_,activeItems:B=[],itemData:x,parentItem:u,icon:w,expandedIcon:L,action:N,compareItems:G,useMemo:K})=>{const[A,b]=S(c);et(()=>{o!=null?b(o):c!=null&&b(A||c)},[o,c]);let g="button";p?g="label":v&&(g="div");const f=p||v?"button":"span",y=C=>D.createElement(f,Object.assign({className:U(I.treeViewNodeToggle),onClick:M=>{(v||p)&&(A?d&&d(M,x,u):i&&i(M,x,u),b(!A)),v&&M.stopPropagation()}},(p||v)&&{"aria-labelledby":`label-${C}`},f==="button"&&{type:"button"},{tabIndex:-1}),D.createElement("span",{className:U(I.treeViewNodeToggleIcon)},D.createElement(je,{"aria-hidden":"true"}))),V=T.checked===null?!1:T.checked,R=C=>D.createElement("span",{className:U(I.treeViewNodeCheck)},D.createElement("input",Object.assign({type:"checkbox",onChange:M=>l&&l(M,x,u),onClick:M=>M.stopPropagation(),ref:M=>M&&(M.indeterminate=T.checked===null)},T,{checked:V,id:C,tabIndex:-1}))),F=D.createElement("span",{className:U(I.treeViewNodeIcon)},!A&&w,A&&(L||w)),q=()=>{const C=D.createElement(D.Fragment,null,_&&e&&D.createElement("span",{className:U(I.treeViewNodeTitle)},e),v?D.createElement("button",{tabIndex:-1,className:U(I.treeViewNodeText),type:"button"},a):D.createElement("span",{className:U(I.treeViewNodeText)},a));return _?D.createElement("span",{className:U(I.treeViewNodeContent)},C):C},k=D.createElement(D.Fragment,null,h&&s&&D.createElement("span",{className:U(I.treeViewNodeCount)},D.createElement(xe,Object.assign({},m),E||s.props.data.length)),h&&!s&&E!==void 0&&D.createElement("span",{className:U(I.treeViewNodeCount)},D.createElement(xe,Object.assign({},m),E))),O=(!s||v)&&B&&B.length>0&&B.some(C=>G&&C&&G(C,x));return D.createElement("li",Object.assign({id:n,className:U(I.treeViewListItem,A&&I.modifiers.expanded),"aria-expanded":A,role:"treeitem",tabIndex:-1},p&&{"aria-checked":V},!p&&{"aria-selected":O}),D.createElement("div",{className:U(I.treeViewContent)},D.createElement(ct,{prefix:v?"selectable-id":"checkbox-id"},C=>D.createElement(g,Object.assign({className:U(I.treeViewNode,s&&(v||p)&&I.modifiers.selectable,O&&I.modifiers.current),onClick:M=>{p||(r&&r(M,x,u),!v&&s&&M.isDefaultPrevented()!==!0&&(A?d&&d(M,x,u):i&&i(M,x,u),b(!A)))}},p&&{htmlFor:C},(p||v&&s)&&{id:`label-${C}`},g==="button"&&{type:"button"}),D.createElement("span",{className:U(I.treeViewNodeContainer)},s&&y(C),p&&R(C),w&&F,q(),k))),N&&D.createElement("div",{className:U(I.treeViewAction)},N)),A&&s)},st=D.memo(Ht,(a,e)=>{if(!e.useMemo)return!1;const n=a.activeItems&&a.activeItems.length>0&&a.activeItems.some(c=>a.compareItems&&c&&a.compareItems(c,a.itemData)),o=e.activeItems&&e.activeItems.length>0&&e.activeItems.some(c=>e.compareItems&&c&&e.compareItems(c,e.itemData));return!(n||o||a.name!==e.name||a.title!==e.title||a.id!==e.id||a.isExpanded!==e.isExpanded||a.defaultExpanded!==e.defaultExpanded||a.onSelect!==e.onSelect||a.onCheck!==e.onCheck||a.onExpand!==e.onExpand||a.onCollapse!==e.onCollapse||a.hasCheckbox!==e.hasCheckbox||a.checkProps!==e.checkProps||a.hasBadge!==e.hasBadge||a.customBadgeContent!==e.customBadgeContent||a.badgeProps!==e.badgeProps||a.isCompact!==e.isCompact||a.icon!==e.icon||a.expandedIcon!==e.expandedIcon||a.action!==e.action||a.parentItem!==e.parentItem||a.itemData!==e.itemData)});st.displayName="TreeViewListItem";class Wt extends $.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=$.createRef(),this.handleKeys=e=>{var n,o,c,s,r,i,d;if(!this.treeRef.current.contains(e.target)||!e.target.classList.contains(I.treeViewNode))return;const l=document.activeElement,p=e.key,T=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(I.treeViewNode)).filter(h=>!h.classList.contains("pf-m-disabled"));if(p===Me.Space&&(l.click(),e.preventDefault()),Te(e,T,h=>l===h,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(p)){const h=(c=(o=l?.firstElementChild)===null||o===void 0?void 0:o.firstElementChild)===null||c===void 0?void 0:c.classList.contains(I.treeViewNodeToggle),E=(s=l?.closest("li"))===null||s===void 0?void 0:s.classList.contains("pf-m-expanded");if(p==="ArrowLeft")if(h&&E)l.click();else{const m=(r=l?.closest("ul"))===null||r===void 0?void 0:r.parentElement;if(m?.tagName!=="DIV"){const v=m?.querySelector("button");l.tabIndex=-1,v&&(v.tabIndex=0,v.focus())}}else if(h&&!E){l.tabIndex=-1,l.click();const m=(d=(i=l?.closest("li"))===null||i===void 0?void 0:i.querySelector("ul > li"))===null||d===void 0?void 0:d.querySelector("button");m&&(m.tabIndex=0,m.focus())}e.preventDefault()}},this.handleKeysCheckbox=e=>{var n,o,c,s,r;if(!this.treeRef.current.contains(e.target))return;const i=document.activeElement,d=e.key;d===Me.Space&&(i.click(),e.preventDefault());const l=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(I.treeViewNode));Te(e,l,p=>p.contains(i),p=>p.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(d)&&(d==="ArrowLeft"?i?.tagName==="INPUT"?!((o=i?.parentElement)===null||o===void 0)&&o.previousSibling&&i.parentElement.previousSibling.focus():i?.previousSibling&&(((c=i.previousElementSibling)===null||c===void 0?void 0:c.tagName)==="SPAN"?i.previousSibling.firstChild.focus():i.previousSibling.focus()):i?.tagName==="INPUT"?!((s=i.parentElement)===null||s===void 0)&&s.nextSibling&&i.parentElement.nextSibling.focus():i?.nextSibling&&(((r=i.nextElementSibling)===null||r===void 0?void 0:r.tagName)==="SPAN"?i.nextSibling.firstChild.focus():i.nextSibling.focus()),e.preventDefault())},this.variantStyleModifiers={default:"",compact:I.modifiers.compact,compactNoBackground:[I.modifiers.compact,I.modifiers.noBackground]}}componentDidMount(){var e;if(Ae&&window.addEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasCheckboxes||this.props.hasSelectableNodes){const n=this.treeRef.current.getElementsByClassName(I.treeViewNodeToggle)[0];if(n&&(n.tabIndex=0),this.props.hasCheckboxes){const o=this.treeRef.current.getElementsByTagName("INPUT")[0];o&&(o.tabIndex=0)}if(this.props.hasSelectableNodes){const o=this.treeRef.current.getElementsByClassName(I.treeViewNodeText)[0];o&&(o.tabIndex=0)}}else((e=this.treeRef.current)===null||e===void 0?void 0:e.getElementsByClassName(I.treeViewNode)[0]).tabIndex=0}componentWillUnmount(){Ae&&window.removeEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const e=this.props,{children:n,hasCheckboxes:o,hasGuides:c,variant:s,className:r,hasSelectableNodes:i}=e,d=ie(e,["children","hasCheckboxes","hasGuides","variant","className","hasSelectableNodes"]);return $.createElement("div",Object.assign({className:U(I.treeView,c&&I.modifiers.guides,this.variantStyleModifiers[s],r),ref:this.treeRef},d),n)}}const Ie=a=>{var{data:e,isNested:n=!1,hasCheckboxes:o=!1,hasBadges:c=!1,hasGuides:s=!1,hasSelectableNodes:r=!1,variant:i="default",defaultAllExpanded:d=!1,allExpanded:l,icon:p,isMultiSelectable:T=!1,expandedIcon:h,parentItem:E,onSelect:m,onCheck:v,onExpand:_,onCollapse:B,toolbar:x,activeItems:u,compareItems:w=(g,f)=>g.id===f.id,className:L,useMemo:N,"aria-label":G,"aria-labelledby":K}=a,A=ie(a,["data","isNested","hasCheckboxes","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","isMultiSelectable","expandedIcon","parentItem","onSelect","onCheck","onExpand","onCollapse","toolbar","activeItems","compareItems","className","useMemo","aria-label","aria-labelledby"]);const b=$.createElement(nt,{isNested:n,toolbar:x,isMultiSelectable:T,"aria-label":G,"aria-labelledby":K},e.map(g=>{var f,y;return $.createElement(st,Object.assign({key:((f=g.id)===null||f===void 0?void 0:f.toString())||((y=g.name)===null||y===void 0?void 0:y.toString()),name:g.name,title:g.title,id:g.id,isExpanded:l,isSelectable:r,defaultExpanded:g.defaultExpanded!==void 0?g.defaultExpanded:d,onSelect:m,onCheck:v,onExpand:_,onCollapse:B,hasCheckbox:g.hasCheckbox!==void 0?g.hasCheckbox:o,checkProps:g.checkProps,hasBadge:g.hasBadge!==void 0?g.hasBadge:c,customBadgeContent:g.customBadgeContent,badgeProps:g.badgeProps,activeItems:u,parentItem:E,itemData:g,icon:g.icon!==void 0?g.icon:p,expandedIcon:g.expandedIcon!==void 0?g.expandedIcon:h,action:g.action,compareItems:w,isCompact:i==="compact"||i==="compactNoBackground",useMemo:N},g.children&&{children:$.createElement(Ie,{data:g.children,isNested:!0,parentItem:g,hasCheckboxes:o,hasBadges:c,hasGuides:s,hasSelectableNodes:r,variant:i,allExpanded:l,defaultAllExpanded:d,onSelect:m,onCheck:v,onExpand:_,onCollapse:B,activeItems:u,icon:p,expandedIcon:h})}))}));return $.createElement($.Fragment,null,E?b:$.createElement(Wt,Object.assign({hasSelectableNodes:r,hasCheckboxes:o,hasGuides:s,variant:i,className:L},A),b))};Ie.displayName="TreeView";const Qt={name:"TreeIcon",height:512,width:384,svgPath:"M378.31 378.49L298.42 288h30.63c9.01 0 16.98-5 20.78-13.06 3.8-8.04 2.55-17.26-3.28-24.05L268.42 160h28.89c9.1 0 17.3-5.35 20.86-13.61 3.52-8.13 1.86-17.59-4.24-24.08L203.66 4.83c-6.03-6.45-17.28-6.45-23.32 0L70.06 122.31c-6.1 6.49-7.75 15.95-4.24 24.08C69.38 154.65 77.59 160 86.69 160h28.89l-78.14 90.91c-5.81 6.78-7.06 15.99-3.27 24.04C37.97 283 45.93 288 54.95 288h30.63L5.69 378.49c-6 6.79-7.36 16.09-3.56 24.26 3.75 8.05 12 13.25 21.01 13.25H160v24.45l-30.29 48.4c-5.32 10.64 2.42 23.16 14.31 23.16h95.96c11.89 0 19.63-12.52 14.31-23.16L224 440.45V416h136.86c9.01 0 17.26-5.2 21.01-13.25 3.8-8.17 2.44-17.47-3.56-24.26z",yOffset:0,xOffset:0},Yt=lt(Qt);var Fe=dt(function(a){var e=ut(a);return Re(e)&&(e=void 0),mt(zt(a,1,Re,!0),pt(e))});const Jt=()=>{const{t:a}=P(),{clear:e,remove:n,subGroups:o}=ne(),{realm:c}=re(),s=oe();return et(()=>{const{pathname:r}=s;(!r.includes("/groups")||r.endsWith("/groups"))&&e()},[s]),o.length!==0?j(ht,{children:[t(Ve,{children:t(ue,{to:`/${c}/groups`,children:a("groups")})},"home"),o.map((r,i)=>{const d=i===o.length-1;return j(Ve,{isActive:d,children:[!d&&t(ue,{to:s.pathname.substring(0,s.pathname.indexOf(r.id)+r.id.length),onClick:()=>n(r),children:r.name}),d&&(r.id==="search"?r.name:a("groupDetails"))]},r.id)})]}):null},it=a=>{const e=a.substring(1).split("/");return e.length>1?e.splice(2):void 0},pe=a=>{const e=it(a);return e?e[e.length-1]:void 0},Xt=()=>{const{adminClient:a}=H(),{t:e}=P(),{addAlert:n,addError:o}=ee(),c=qe({mode:"onChange"}),s=oe(),r=pe(s.pathname),[i,d]=S();ce(()=>a.groups.findOne({id:r}),p=>{c.reset({attributes:Oe(p?.attributes)}),d(p)},[r]);const l=async p=>{try{const T=gt(p).attributes;await a.groups.update({id:r},{...i,attributes:T}),d({...i,attributes:T}),n(e("groupUpdated"),me.success)}catch(T){o("groupUpdateError",T)}};return t(Pe,{variant:ze.light,children:t(Kt,{form:c,save:l,fineGrainedAccess:i?.access?.manage,reset:()=>c.reset({attributes:Oe(i?.attributes)})})})},Zt=({id:a,name:e})=>{const{adminClient:n}=H(),{t:o}=P(),{addAlert:c,addError:s}=ee();return t(Bt,{name:e,id:a,type:"groups",save:async i=>{try{const d=i.filter(l=>l.client===void 0).map(l=>l.role).flat();await n.groups.addRealmRoleMappings({id:a,roles:d}),await Promise.all(i.filter(l=>l.client!==void 0).map(l=>n.groups.addClientRoleMappings({id:a,clientUniqueId:l.client.id,roles:[l.role]}))),c(o("roleMappingUpdatedSuccess"),me.success)}catch(d){s("roleMappingUpdatedError",d)}}})},ae=({id:a,rename:e,duplicateId:n,handleModalToggle:o,refresh:c})=>{const{adminClient:s}=H(),{t:r}=P(),{addAlert:i,addError:d}=ee(),l=He(),[p,T]=S(null),h=qe({defaultValues:{name:""}}),{handleSubmit:E,formState:m}=h;ce(async()=>{if(n)return s.groups.findOne({id:n})},u=>{u&&(T(u),h.reset({name:r("copyOf",{name:u.name})}))},[n]);const v=async u=>{try{const w=[],L=await s.clients.find();for(const N of L){const K=(await s.groups.listClientRoleMappings({id:u,clientUniqueId:N.id})).filter(A=>A.id&&A.name).map(A=>({id:A.id,name:A.name}));K.length>0&&w.push({clientId:N.id,roles:K})}return w}catch(w){throw d("couldNotFetchClientRoleMappings",w),w}},_=async(u,w,L=!1)=>{try{const N={...u,name:L?u.name:r("copyOf",{name:u.name}),...w?{}:{attributes:p?.attributes}};delete N.id;const G=w?await s.groups.createChildGroup({id:w},N):await s.groups.create(N),K=await s.groups.listMembers({id:u.id});for(const R of K)await s.users.addToGroup({id:R.id,groupId:G.id});if(l(Ye.AdminFineGrainedAuthz)){const R=await s.groups.listPermissions({id:u.id});R&&await s.groups.updatePermission({id:G.id},R)}const b=(await s.groups.listRealmRoleMappings({id:u.id})).map(R=>({id:R.id,name:R.name})),f=(await v(u.id))?.flatMap(R=>R.roles.map(F=>({id:F.id,name:F.name,clientUniqueId:R.clientId}))),y=[...b,...f];await B(y,G.id);const V=await s.groups.listSubGroups({parentId:u.id});for(const R of V){const F=R.attributes;await _({...R,attributes:F},G.id,!0)}return G}catch(N){throw d("couldNotDuplicateGroup",N),N}},B=async(u,w)=>{try{const L=u.filter(G=>!G.clientUniqueId&&G.name),N=u.filter(G=>G.clientUniqueId&&G.name);await s.groups.addRealmRoleMappings({id:w,roles:L.map(({id:G,name:K})=>({id:G,name:K}))}),await Promise.all(N.map(G=>G.clientUniqueId&&G.name?s.groups.addClientRoleMappings({id:w,clientUniqueId:G.clientUniqueId,roles:[{id:G.id,name:G.name}]}):Promise.resolve()))}catch(L){d("roleMappingUpdatedError",L)}},x=async u=>{u.name=u.name?.trim();try{n&&p?await _(p):a?e?await s.groups.update({id:a},{...e,name:u.name}):await s.groups.updateChildGroup({id:a},u):await s.groups.create(u),c(e?{...e,name:u.name}:void 0),o(),i(r(e?"groupUpdated":n?"groupDuplicated":"groupCreated"),me.success)}catch(w){d("couldNotCreateGroup",w)}};return t(We,{variant:Qe.small,title:r(e?"renameAGroup":n?"duplicateAGroup":"createAGroup"),isOpen:!0,onClose:o,actions:[t(yt,{formState:m,"data-testid":`${e?"rename":n?"duplicate":"create"}Group`,form:"group-form",allowInvalid:!0,allowNonDirty:!0,children:r(e?"rename":n?"duplicate":"create")},"confirm"),t(Z,{id:"modal-cancel","data-testid":"cancel",variant:be.link,onClick:o,children:r("cancel")},"cancel")],children:t(ft,{...h,children:j(bt,{id:"group-form",isHorizontal:!0,onSubmit:E(x),children:[n&&t(vt,{variant:"warning",component:"h2",isInline:!0,title:r("duplicateGroupWarning")}),t(wt,{name:"name",label:r("name"),rules:{required:r("required")},autoFocus:!0})]})})})},Se=({selectedRows:a,show:e,toggleDialog:n,refresh:o})=>{const{adminClient:c}=H(),{t:s}=P(),{addAlert:r,addError:i}=ee(),d=async()=>{try{for(const l of a)await c.groups.del({id:l.id});o(),r(s("groupDeleted",{count:a.length}))}catch(l){i("groupDeleteError",l)}};return t(Ft,{titleKey:s("deleteConfirmTitle",{count:a.length}),messageKey:s("deleteConfirmGroup",{count:a.length,groupName:a[0]?.name}),continueButtonLabel:"delete",continueButtonVariant:be.danger,onConfirm:d,open:e,toggleDialog:n})},ea=({toggleCreate:a,toggleDelete:e,kebabDisabled:n})=>{const{t:o}=P(),{currentGroup:c}=ne(),{hasAccess:s}=le(),r=s("manage-users")||c()?.access?.manage,[i,d]=z();return r?j(J,{children:[t(te,{children:t(Z,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:a,children:o("createGroup")})}),t(te,{children:t(ve,{onOpenChange:d,toggle:l=>t(ye,{"data-testid":"kebab",ref:l,isExpanded:i,onClick:d,isDisabled:n,variant:"plain","aria-label":"Actions",children:t(Ce,{})}),isOpen:i,children:t(we,{children:t(X,{component:"button",onClick:()=>{e(),d()},children:o("delete")},"action")})})})]}):t("div",{})},ta=(a,e)=>e.id?a.groups.updateRoot(e):a.groups.create(e),aa=async(a,e,n)=>a.groups.updateChildGroup({id:n.id},e),rt=({source:a,onClose:e,refresh:n})=>{const{adminClient:o}=H(),{t:c}=P(),{addAlert:s,addError:r}=ee();return t(Ut,{type:"selectOne",filterGroups:[a],text:{title:"moveToGroup",ok:"moveHere"},onClose:e,onConfirm:async d=>{try{await(d?aa(o,a,d[0]):ta(o,a)),n(),s(c("moveGroupSuccess"))}catch(l){r("moveGroupError",l)}},isMove:!0})},Ue=({refresh:a})=>{const{adminClient:e}=H(),{t:n}=P(),[o,c]=S([]),[s,r]=S(),[i,d]=z(),[l,p]=S(),[T,h]=z(),[E,m]=S(),{currentGroup:v}=ne(),[_,B]=S(0),x=()=>B(_+1),[u,w]=S(),L=oe(),N=pe(L.pathname),{hasAccess:G}=le(),K=G("manage-users")||v()?.access?.manage,A=async(b,g)=>{let f;if(N){const y={search:u||"",first:b,max:g,parentId:N};f=await e.groups.listSubGroups(y)}else{const y={search:u||"",first:b||void 0,max:g||void 0};f=await e.groups.find(y)}return f};return j(J,{children:[t(Se,{show:T,toggleDialog:h,selectedRows:o,refresh:()=>{x(),a(),c([])}}),s&&t(ae,{id:s.id,rename:s,refresh:()=>{x(),a()},handleModalToggle:()=>r(void 0)}),i&&t(ae,{id:o[0]?.id||N,handleModalToggle:d,refresh:()=>{c([]),x(),a()}}),l&&t(ae,{id:l,duplicateId:l,refresh:()=>{x(),a()},handleModalToggle:()=>p(void 0)}),E&&t(rt,{source:E,refresh:()=>{m(void 0),x(),a()},onClose:()=>m(void 0)}),t(Ne,{onSelect:b=>c([...b]),canSelectAll:!0,loader:A,ariaLabelKey:"groups",isPaginated:!0,isSearching:!!u,toolbarItem:j(J,{children:[t(te,{children:t(Ct,{"data-testid":"group-search",placeholder:n("filterGroups"),value:u,onChange:(b,g)=>{w(g),g===""&&x()},onSearch:x,onClear:()=>{w(""),x()}})}),t(ea,{toggleCreate:d,toggleDelete:h,kebabDisabled:o.length===0})]}),actions:K?[{title:n("rename"),onRowClick:async b=>(r(b),!1)},{title:n("moveTo"),onRowClick:async b=>(m(b),!1)},{title:n("createChildGroup"),onRowClick:async b=>(c([b]),d(),!1)},...N?[]:[{title:n("duplicate"),onRowClick:async b=>(p(b.id),!1)}],{isSeparator:!0},{title:n("delete"),onRowClick:async b=>(c([b]),h(),!0)}]:[],columns:[{name:"name",displayKey:"groupName",cellRenderer:b=>b.access?.view?t(ue,{to:`${L.pathname}/${b.id}`,children:b.name},b.id):t("span",{children:b.name})}],emptyState:t(Ge,{hasIcon:!0,message:n(`noGroupsInThis${N?"SubGroup":"Realm"}`),instructions:n(`noGroupsInThis${N?"SubGroup":"Realm"}Instructions`),primaryActionText:n("createGroup"),onPrimaryAction:d})},`${N}${_}`)]})},na=({user:a,onClose:e})=>{const{t:n}=P(),{adminClient:o}=H(),[c,s]=S(0),r=()=>s(c+1),[i,d]=S(!0),{enabled:l}=Nt(),p=h=>qt(h,E=>E.path?.toUpperCase()),T=async(h,E,m)=>{const v={first:h,max:E},_=m||"";_&&(v.search=_);const B=await o.users.listGroups({...v,id:a.id}),x=[];return i||B.forEach(u=>{const w=(u.path?.substring(1).match(/((~\/)|[^/])+/g)||[]).slice(0,-1);x.push(...w.map(L=>({name:L,path:u.path?.substring(0,u.path.indexOf(L)+L.length)})))}),p(Je([...B,...x],"path"))};return t(We,{variant:Qe.large,title:n("showMembershipsTitle",{username:a.username}),"data-testid":"showMembershipsDialog",isOpen:!0,onClose:e,actions:[t(Z,{id:"modal-cancel","data-testid":"cancel",variant:be.primary,onClick:e,children:n("cancel")},"cancel")],children:t(Ne,{loader:T,className:"keycloak_user-section_groups-table",isPaginated:!0,ariaLabelKey:"roleList",searchPlaceholderKey:"searchGroup",toolbarItem:j(J,{children:[t(Ee,{label:n("directMembership"),id:"kc-direct-membership-checkbox",onChange:()=>{d(!i),r()},isChecked:i,className:"pf-v5-u-mt-sm"},"direct-membership-check"),l&&t(Gt,{"aria-label":"Basic popover",position:"bottom",bodyContent:t("div",{children:n("whoWillAppearPopoverTextUsers")}),children:t(Z,{variant:"link",className:"kc-who-will-appear-button",icon:t(Pt,{}),children:n("whoWillAppearLinkTextUsers")},"who-will-appear-button")})]}),columns:[{name:"groupMembership",displayKey:"groupMembership",cellRenderer:h=>h.name||"-",transforms:[De(40)]},{name:"path",displayKey:"path",cellRenderer:h=>t($t,{group:h}),transforms:[De(45)]}],emptyState:t(Ge,{hasIcon:!0,message:n("noGroupMemberships"),instructions:n("noGroupMembershipsText")})},c)})},sa=a=>{const{realm:e}=re(),{t:n}=P();return j(ue,{to:Et({realm:e,id:a.id,tab:"settings"}),children:[a.username," ",!a.enabled&&t(kt,{color:"red",icon:t(It,{}),children:n("disabled")})]},a.id)},ia=()=>{const{adminClient:a}=H(),{t:e}=P(),{addAlert:n,addError:o}=ee(),c=oe(),s=pe(c.pathname),[r,i]=S(!1),{currentGroup:d}=ne(),[l,p]=S(),[T,h]=S(!1),[E,m]=S(!1),[v,_]=S([]),[B,x]=S(),[u,w]=z(),{hasAccess:L}=le();ce(()=>a.groups.findOne({id:d().id}),p,[]);const N=L("manage-users")||l?.access.manageMembership,[G,K]=S(0),A=()=>K(new Date().getTime()),b=async(f,y=0)=>{let V=[];if(!y||!f)return V;const R={parentId:f,first:0,max:y},F=await a.groups.listSubGroups(R);return V=V.concat(F),await Promise.all(F.map(q=>b(q.id,q.subGroupCount))).then(q=>{q.forEach(k=>V=V.concat(k))}),V},g=async(f,y)=>{if(!s)return[];let V=await a.groups.listMembers({id:s,briefRepresentation:!0,first:f,max:y});if(r&&l?.subGroupCount&&l.id){const R=await b(l.id,l.subGroupCount);await Promise.all(R.map(F=>a.groups.listMembers({id:F.id,briefRepresentation:!0}))).then(F=>{F.forEach(q=>V=V.concat(q))}),V=Je(V,F=>F.username)}return V};return l?j(J,{children:[T&&t(jt,{membersQuery:(f,y)=>a.groups.listMembers({id:s,first:f,max:y}),onAdd:async f=>{try{await Promise.all(f.map(y=>a.users.addToGroup({id:y.id,groupId:s}))),n(e("usersAdded",{count:f.length}))}catch(y){o("usersAddedError",y)}},onClose:()=>{h(!1),A()}}),u&&t(na,{onClose:()=>{w()},user:B}),t(Ne,{"data-testid":"members-table",loader:g,ariaLabelKey:"members",isPaginated:!0,canSelectAll:!0,onSelect:f=>_([...f]),toolbarItem:N&&j(J,{children:[t(te,{children:t(Z,{"data-testid":"addMember",variant:"primary",onClick:()=>h(!0),children:e("addMember")})}),t(te,{children:t(Ee,{"data-testid":"includeSubGroupsCheck",label:e("includeSubGroups"),id:"kc-include-sub-groups",isChecked:r,onChange:()=>i(!r)})}),t(te,{children:t(ve,{onOpenChange:f=>m(f),toggle:f=>t(ye,{"data-testid":"kebab",ref:f,variant:"plain",onClick:()=>m(!E),isExpanded:E,isDisabled:v.length===0,"aria-label":"Actions",children:t(Ce,{})}),shouldFocusToggleOnSelect:!0,isOpen:E,children:t(we,{children:t(X,{component:"button",onClick:async()=>{try{await Promise.all(v.map(f=>a.users.delFromGroup({id:f.id,groupId:s}))),m(!1),n(e("usersLeft",{count:v.length}))}catch(f){o("usersLeftError",f)}A()},children:e("leave")},"action")})})})]}),actions:[...N?[{title:e("leave"),onRowClick:async f=>{try{await a.users.delFromGroup({id:f.id,groupId:s}),n(e("usersLeft",{count:1}))}catch(y){o("usersLeftError",y)}return!0}}]:[],{title:e("showMemberships"),onRowClick:f=>{x(f),w()}}],columns:[{name:"username",displayKey:"name",cellRenderer:sa},{name:"email",displayKey:"email",cellFormatters:[he()]},{name:"firstName",displayKey:"firstName",cellFormatters:[he()]},{name:"lastName",displayKey:"lastName",cellFormatters:[he()]}],emptyState:t(Ge,{message:e("noUsersFound"),instructions:N?e("emptyInstructions"):void 0,primaryActionText:N?e("addMember"):void 0,onPrimaryAction:()=>h(!0),secondaryActions:[{text:e("includeSubGroups"),onClick:()=>i(!0)}]})},`${s}${G}${r}`)]}):t(Xe,{})};function ot(a){let e=a.length;for(const n of a)n.subGroups&&(e+=ot(n.subGroups));return e}const ra=({group:a,refresh:e})=>{const{t:n}=P(),[o,c]=z(),[s,r]=z(),[i,d]=z(),[l,p]=z(),[T,h]=z(),E=ke(),{realm:m}=re();return j(J,{children:[s&&t(ae,{id:a.id,rename:a,refresh:()=>{E(se({realm:m})),e()},handleModalToggle:r}),i&&t(ae,{id:a.id,handleModalToggle:d,refresh:e}),l&&t(rt,{source:a,refresh:e,onClose:p}),t(Se,{show:T,toggleDialog:h,selectedRows:[a],refresh:()=>{E(se({realm:m})),e()}}),t(ve,{popperProps:{position:"right"},onOpenChange:c,toggle:v=>t(ye,{ref:v,onClick:c,isExpanded:o,variant:"plain","aria-label":"Actions",children:t(Ce,{})}),isOpen:o,children:j(we,{children:[t(X,{onClick:r,children:n("rename")},"rename"),t(X,{onClick:p,children:n("moveTo")},"move"),t(X,{onClick:d,children:n("createChildGroup")},"create"),t($e,{},"separator"),t(X,{onClick:h,children:n("delete")},"delete")]})})]})},de=50,oa=()=>{const{t:a}=P();return j(J,{children:[t(Mt,{size:"sm"})," ",a("spinnerLoading")]})},ca=[{name:t(oa,{})}],la=({refresh:a,canViewDetails:e})=>{const{adminClient:n}=H(),{t:o}=P(),{realm:c}=re(),s=ke(),{addAlert:r}=ee(),{hasAccess:i}=le(),[d,l]=S(),{subGroups:p,clear:T}=ne(),[h,E]=S(""),[m,v]=S(20),[_,B]=S(0),x=Ke(0),u=Ke(20),[w,L]=S(0),[N,G]=S(!1),[K,A]=S(),[b,g]=S(0),[f,y]=S(0),V=()=>{y(f+1),a()},R=(k,O)=>{const C=k.subGroupCount;return{id:k.id,name:t(Ze,{content:k.name,children:t("span",{children:k.name})}),access:k.access||{},children:C?h.length===0?ca:k.subGroups?.map(M=>R(M,O)):void 0,action:(i("manage-users")||k.access?.manage)&&t(ra,{group:k,refresh:O}),defaultExpanded:p.map(M=>M.id).includes(k.id)}};ce(async()=>{const k=await _e(n,"groups",Object.assign({first:`${_}`,max:`${m+1}`,exact:`${N}`,global:`${h!==""}`},h===""?null:{search:h}));let O=[];return K&&(O=await _e(n,`groups/${K.id}/children`,{first:`${b}`,max:`${de}`})),{groups:k,subGroups:O}},({groups:k,subGroups:O})=>{if(K){const C=F(d||[],K.id,[]);if(C.length&&O.length){const M=C.pop();M.children=[...(Fe(M.children||[]).splice(0,de),O.map(W=>R(W,V),"id")),...O.length===de?[{id:"next",name:t(Z,{variant:"plain",onClick:()=>g(b+de),children:t(je,{})})}]:[]]}}h||x.current!==_||u.current!==m?l(k.map(C=>R(C,V))):l(Fe(d,k.map(C=>R(C,V)),"id")),L(ot(k)),x.current=_,u.current=m},[f,_,b,m,h,N,K]);const F=(k,O,C)=>{for(let M=0;M<k.length;M++){const W=k[M];if(W.id===O)return C.push(W),C;W.children&&(C.push(W),F(W.children,O,C),C[C.length-1].id!==O&&C.pop())}return C},q=(k,O)=>{if(k.id==="next")return;A(k);const C=F(O,k.id,[]);p.every(({id:M})=>C.find(W=>W.id===M))||T(),e||C.at(-1)?.access?.view||p.at(-1)?.access?.view?s(se({realm:c,id:C.map(M=>M.id).join("/")})):(r(o("noViewRights"),me.warning),s(se({realm:c})))};return d?t(St,{count:w,first:_,max:m,onNextClick:B,onPreviousClick:B,onPerPageSelect:(k,O)=>{B(k),v(O)},inputGroupName:"searchForGroups",inputGroupPlaceholder:o("searchForGroups"),inputGroupOnEnter:E,toolbarItem:j(xt,{className:"pf-v5-u-pt-sm",children:[t(Le,{children:t(Ee,{id:"exact","data-testid":"exact-search",name:"exact",isChecked:N,onChange:(k,O)=>G(O),className:"pf-v5-u-mr-xs"})}),t(Le,{children:t("label",{htmlFor:"exact",className:"pf-v5-u-pl-sm",children:o("exactSearch")})})]}),children:d.length>0&&t(Ie,{data:d.slice(0,m),allExpanded:h.length>0,activeItems:K?[K]:void 0,hasGuides:!0,hasSelectableNodes:!0,className:"keycloak_groups_treeview",onExpand:(k,O)=>{q(O,d)},onSelect:(k,O)=>{q(O,d)}})}):t(Xe,{})};function Ua(){const{adminClient:a}=H(),{t:e}=P(),[n,o]=S(0),{subGroups:c,setSubGroups:s,currentGroup:r}=ne(),{realm:i}=re(),[d,l]=S(),[p,T]=z(),h=ke(),E=oe(),m=pe(E.pathname),[v,_]=z(!0),[B,x]=S(0),u=()=>x(B+1),{hasAccess:w}=le(),N=He()(Ye.AdminFineGrainedAuthz)&&w("manage-authorization","manage-users","manage-clients"),G=w("manage-users")||r()?.access?.manage,K=w("manage-users"),A=w("query-groups","view-users")||w("manage-users","query-groups"),b=w("view-users")||r()?.access?.viewMembers||r()?.access?.manageMembers,[g,f]=S("adminEvents");return ce(async()=>{const y=it(E.pathname);if(y&&y.length>c.length){const R=[];for(const F of y){let q;if(F!=="search"?q=await a.groups.findOne({id:F}):q={name:e("searchGroups"),id:"search"},q)R.push(q);else throw new Error(e("notFound"))}return R}return[]},y=>{y.length&&s(y)},[m]),j(J,{children:[t(Se,{show:p,toggleDialog:T,selectedRows:[r()],refresh:()=>{h(se({realm:i})),u()}}),d&&t(ae,{id:m,rename:d,refresh:y=>{u(),s([...c.slice(0,c.length-1),y])},handleModalToggle:()=>l(void 0)}),t(Pe,{variant:ze.light,className:"pf-v5-u-p-0",children:t(Tt,{isInline:!0,isExpanded:v,position:"left",children:t(At,{panelContent:t(Dt,{isResizable:!0,children:t(at,{children:t(la,{refresh:u,canViewDetails:A})})}),children:j(Rt,{children:[t(Ze,{content:e(v?"hide":"show"),children:t(Z,{"aria-label":e(v?"hide":"show"),variant:"plain",icon:v?t(Vt,{}):t(Yt,{}),onClick:_})}),t(Jt,{}),t(Lt,{titleKey:m?r()?.name:"groups",subKey:m?"":"groupsDescription",helpUrl:m?"":Ot.groupsUrl,divider:!m,dropdownItems:m&&G?[t(X,{"data-testid":"renameGroupAction",onClick:()=>l(r()),children:e("renameGroup")},"renameGroup"),t(X,{"data-testid":"deleteGroup",onClick:T,children:e("deleteGroup")},"deleteGroup")]:void 0}),c.length>0&&j(Be,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:n,onSelect:(y,V)=>o(V),isBox:!0,mountOnEnter:!0,unmountOnExit:!0,children:[t(Q,{"data-testid":"groups",eventKey:0,title:t(Y,{children:e("childGroups")}),children:t(Ue,{refresh:u})}),b&&t(Q,{"data-testid":"members",eventKey:1,title:t(Y,{children:e("members")}),children:t(ia,{})}),t(Q,{"data-testid":"attributesTab",eventKey:2,title:t(Y,{children:e("attributes")}),children:t(Xt,{})}),K&&t(Q,{eventKey:3,"data-testid":"role-mapping-tab",title:t(Y,{children:e("roleMapping")}),children:t(Zt,{id:m,name:r()?.name})}),N&&t(Q,{eventKey:4,"data-testid":"permissionsTab",title:t(Y,{children:e("permissions")}),children:t(_t,{id:m,type:"groups"})}),w("view-events")&&t(Q,{eventKey:5,"data-testid":"admin-events-tab",title:t(Y,{children:e("adminEvents")}),children:j(Be,{activeKey:g,onSelect:(y,V)=>f(V),children:[t(Q,{eventKey:"adminEvents",title:t(Y,{children:e("adminEvents")}),children:t(ge,{resourcePath:`groups/${m}`})}),t(Q,{eventKey:"membershipEvents",title:t(Y,{children:e("membershipEvents")}),children:t(ge,{resourcePath:`users/*/groups/${m}`})}),t(Q,{eventKey:"childGroupEvents",title:t(Y,{children:e("childGroupEvents")}),children:t(ge,{resourcePath:`groups/${m}/children`})})]})})]}),c.length===0&&t(Ue,{refresh:u})]})})},B)})]})}export{Ua as default};
//# sourceMappingURL=GroupsSection-DQcMGUKq.js.map
