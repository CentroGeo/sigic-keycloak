import{jsxs as C,jsx as e,Fragment as w}from"react/jsx-runtime";import{at as Ye,b4 as K,dP as Ce,as as pt,cL as ut,dk as mt,dl as ht,dm as ft,dj as gt,a1 as Ct,ar as ye,bu as yt,bv as Tt,dn as It,dC as St,dD as vt,u as ie,a as D,Z as W,z as de,j as ne,K as U,N as F,ag as bt,ah as xt,aj as ce,dQ as Ot,dR as Pt,U as Je,W as Qe,dS as kt,h as L,di as Dt,a5 as Pe,O as G,ai as se,R as pe,d as Rt,b as Xe,B as oe,dL as $t,bn as Ze,bo as Te,br as et,bE as Mt,L as tt,M as nt,m as it,w as At,f as Et,aI as Ie,aJ as Se,D as ke,b6 as Ve,aM as he,bm as fe,au as te,aG as j,aN as ge,aL as B,ca as Re,a4 as $e,Y as ue,aK as wt,X as Vt,ay as _t,az as _e,_ as st,a0 as ae,a3 as Nt,l as Ht,V as Lt,q as Ne,dT as He,bT as Le,y as Ft,P as Ut,n as Gt,A as qt,dM as zt,E as Kt,G as Fe,H as jt}from"./main-Dml5vH_M.js";import*as O from"react";import{useState as x,useRef as Bt,useCallback as Wt,useEffect as Yt,useMemo as Me}from"react";import{u as ot}from"./ConfirmDialog-BN0phSta.js";import{F as Jt}from"./FormAccess-Dgk035ov.js";import{V as Qt}from"./ViewHeader-CnGpO8mW.js";import{u as me}from"./useParams-Cmi1OAEj.js";import{u as Ae}from"./useIsAdminPermissionsClient-IDuSpu5V.js";import{u as at,m as lt}from"./useLocaleSort-DeXbTEE9.js";import{C as Xt}from"./ClientSelect-DJq4F1jh.js";import{h as Zt}from"./ClientScopeTypes-DwzbyHD6.js";import{g as en}from"./utils-C-TUnOch.js";import{F as Ue}from"./filter-icon-BO7Evf9d.js";import{G as tn}from"./GroupPickerDialog-eQJqBPQt.js";import{a as nn}from"./CodeEditor-C7HQ48Ys.js";import{D as sn}from"./SwitchControl-DVIXTwQM.js";import{A as on,S as an}from"./AddRoleMappingModal-FlNvMd3n.js";import{d as ve,D as ln}from"./DatePicker-CU4S68sS.js";import{d as rn}from"./debounce-DrUiQQ8A.js";const X=" AM",Z=" PM",cn=(n,i,s,c,d,r)=>{const a=[],u=new Date(new Date().setHours(0,0,0,0)),m=u.getDay();for(;u.getDay()===m;){let h=u.getHours(),t=X;i&&(h===0?h=12:h>=12&&(t=Z),h>12&&(h%=12)),h=i?h.toString():h.toString().padStart(2,"0");const o=u.getMinutes().toString().padStart(2,"0"),l=`${h}${s}${o}${i?t:""}`;ct(c,d,l,s,r)&&a.push(l),u.setMinutes(u.getMinutes()+n)}return a},Q=(n,i,s,c,d)=>{const r=new Date(n);if(!isNaN(r.getDate())&&(n instanceof Date||n.includes("T"))){const a=c?`${r.getHours()>12?r.getHours()-12:r.getHours()}`:`${r.getHours()}`.padStart(2,"0"),u=`${r.getMinutes()}`.padStart(2,"0"),m=d?`${r.getSeconds()}`.padStart(2,"0"):"",h=m?`${s}${m}`:"";let t="";return c&&r.getHours()>11?t=Z:c&&(t=X),`${a}${s}${u}${h}${t}`}else if(typeof n=="string"&&(n=n.trim(),n!==""&&rt(n,i,s,c))){const[,a,u,m,h=""]=i.exec(n),t=d?`${s}${m??"00"}`:"";let o="";if(c){const l=h.toUpperCase();l===X.toUpperCase().trim()?o=X:l===Z.toUpperCase().trim()?o=Z:o=new Date().getHours()>11?Z:X}return`${a}${s}${u}${t}${o}`}return n.toString()},rt=(n,i,s,c)=>{const d=new Date(n);if(!isNaN(d.getDate())&&n.includes("T"))return!0;const r=parseInt(n.split(s)[0]),a=r>=(c?1:0)&&r<=(c?12:23);return n===""||i.test(n)&&a},Ge=(n,i)=>{const s=n.match(i);return s&&s.length?/pm/i.test(s[4])?parseInt(s[1])===12?parseInt(s[1]):parseInt(s[1])+12:/am/i.test(s[4])&&parseInt(s[1])===12?0:parseInt(s[1]):null},qe=(n,i)=>{const s=n.match(i);return s&&s.length?parseInt(s[2]):null},ze=(n,i)=>{var s;const c=(s=n.match(i))===null||s===void 0?void 0:s[3];return c?parseInt(c):null},ct=(n,i,s,c,d)=>{if(s.trim()==="")return!0;const r=be(n,c,d),a=be(s,c,d),u=be(i,c,d);return r<=a&&a<=u},be=(n,i,s)=>{const d=new RegExp(`^\\s*(\\d\\d?)${i}([0-5]\\d)${i}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(n);if(!d||!d.length)return;let r=d[1].padStart(2,"0");const a=d[2];let u=d[3]?`${i}${d[3]}`:"";!u&&s&&(u=`${i}00`);const m=d[4]||"";return m.toUpperCase()==="PM"&&r!=="12"?r=`${parseInt(r)+12}`:m.toUpperCase()==="AM"&&r==="12"&&(r="00"),`${r}${i}${a}${u}`},dn={name:"OutlinedClockIcon",height:512,width:512,svgPath:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z",yOffset:0,xOffset:0},pn=Ye(dn),un={name:"--pf-v5-c-date-picker__input--c-form-control--Width"};class Ee extends O.Component{constructor(i){super(i),this.baseComponentRef=O.createRef(),this.toggleRef=O.createRef(),this.inputRef=O.createRef(),this.menuRef=O.createRef(),this.onDocClick=t=>{var o,l,p,f;const I=(l=(o=this.toggleRef)===null||o===void 0?void 0:o.current)===null||l===void 0?void 0:l.contains(t.target),T=(f=(p=this.menuRef)===null||p===void 0?void 0:p.current)===null||f===void 0?void 0:f.contains(t.target);this.state.isTimeOptionsOpen&&!(I||T)&&this.onToggle(!1)},this.handleGlobalKeys=t=>{var o,l,p,f;const{isTimeOptionsOpen:I,focusedIndex:T,scrollIndex:P}=this.state;!((l=(o=this.inputRef)===null||o===void 0?void 0:o.current)===null||l===void 0)&&l.contains(t.target)?!I&&t.key!==K.Tab&&t.key!==K.Escape?this.onToggle(!0):I&&(t.key===K.Escape||t.key===K.Tab?this.onToggle(!1):t.key===K.Enter?T!==null?(this.focusSelection(T),t.stopPropagation()):this.onToggle(!1):(t.key===K.ArrowDown||t.key===K.ArrowUp)&&(this.focusSelection(P),this.updateFocusedIndex(0),t.preventDefault())):!((f=(p=this.menuRef)===null||p===void 0?void 0:p.current)===null||f===void 0)&&f.contains(t.target)&&(t.key===K.ArrowDown?(this.updateFocusedIndex(1),t.preventDefault()):t.key===K.ArrowUp?(this.updateFocusedIndex(-1),t.preventDefault()):(t.key===K.Escape||t.key===K.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=t=>{this.setState(o=>{const l=this.getOptions().length-1;let p=o.focusedIndex!==null?o.focusedIndex+t:o.scrollIndex+t;return p<0?p=l:p>l&&(p=0),this.scrollToIndex(p),{focusedIndex:p}})},this.getIndexToScroll=t=>this.props.menuAppendTo==="inline"?t>0?t-1:0:t,this.scrollToIndex=t=>{this.getOptions()[t].closest(`.${Ce.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(t)].offsetTop},this.focusSelection=t=>{var o;const l=t!==-1?t:0;!((o=this.menuRef)===null||o===void 0)&&o.current&&this.getOptions()[l].querySelector(`.${Ce.menuItem}`).focus()},this.scrollToSelection=t=>{const{delimiter:o,is24Hour:l}=this.props;let p=t.split(this.props.delimiter),f=null;if(p.length<2?(t=`${t}${o}00`,p=t.split(o)):p.length>2&&(t=Q(t,this.state.timeRegex,o,!l,!1),p=t.split(o)),!l&&p.length>1&&p[1].length<2){const T=p[1].length===0?"00":p[1]+"0";t=`${p[0]}${o}${T}${new Date().getHours()>11?Z:X}`}else!l&&p.length>1&&p[1].length===2&&!t.toUpperCase().includes(X.toUpperCase().trim())&&!t.toUpperCase().includes(Z.toUpperCase().trim())&&(t=`${t}${new Date().getHours()>11?Z:X}`);let I=this.getOptions().findIndex(T=>T.textContent===t);if(I!==-1)this.scrollToIndex(I),f=I;else if(p.length===2){let T="";l||(p[1].toUpperCase().includes("P")?T=Z:p[1].toUpperCase().includes("A")&&(T=X)),t=`${p[0]}${o}00${T}`,I=this.getOptions().findIndex(P=>P.textContent===t),I!==-1&&this.scrollToIndex(I)}this.setState({focusedIndex:f,scrollIndex:I})},this.getRegExp=(t=!0)=>{const{is24Hour:o,delimiter:l}=this.props;let p=`\\s*(\\d\\d?)${l}([0-5]\\d)`;return t&&(p+=`${l}?([0-5]\\d)?`),new RegExp(`^${p}${o?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var t;return!((t=this.menuRef)===null||t===void 0)&&t.current?Array.from(this.menuRef.current.querySelectorAll(`.${Ce.menuListItem}`)):[]},this.isValidFormat=t=>{if(this.props.validateTime)return this.props.validateTime(t);const{delimiter:o,is24Hour:l,includeSeconds:p}=this.props;return rt(t,this.getRegExp(p),o,!l)},this.isValidTime=t=>{const{delimiter:o,includeSeconds:l}=this.props,{minTimeState:p,maxTimeState:f}=this.state;return ct(p,f,t,o,l)},this.isValid=t=>this.isValidFormat(t)&&this.isValidTime(t),this.onToggle=t=>{this.setState(o=>{const{timeRegex:l,isInvalid:p,timeState:f}=o,{delimiter:I,is24Hour:T,includeSeconds:P,onChange:_}=this.props,R=Q(f,l,I,!T,P);return _&&!t&&R!==f&&_(null,R,Ge(R,l),qe(R,l),ze(R,l),this.isValid(R)),{isTimeOptionsOpen:t,timeState:R,isInvalid:t?p:!this.isValid(R)}}),this.props.setIsOpen(t),t||this.inputRef.current.focus()},this.onSelect=t=>{const{timeRegex:o,timeState:l}=this.state,{delimiter:p,is24Hour:f,includeSeconds:I,setIsOpen:T}=this.props,P=Q(t.target.textContent,o,p,!f,I);P!==l&&this.onInputChange(t,P),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),T(!1)},this.onInputClick=t=>{this.state.isTimeOptionsOpen||this.onToggle(!0),t.stopPropagation()},this.onInputChange=(t,o)=>{const{onChange:l}=this.props,{timeRegex:p}=this.state;l&&l(t,o,Ge(o,p),qe(o,p),ze(o,p),this.isValid(o)),this.scrollToSelection(o),this.setState({timeState:o})};const{is24Hour:s,delimiter:c,time:d,includeSeconds:r,isOpen:a}=this.props;let{minTime:u,maxTime:m}=this.props;if(u===""){const t=r?`${c}00`:"";u=s?`00${c}00${t}`:`12${c}00${t} AM`}if(m===""){const t=r?`${c}59`:"";m=s?`23${c}59${t}`:`11${c}59${t} PM`}const h=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:a,timeState:Q(d,h,c,!s,r),focusedIndex:null,scrollIndex:0,timeRegex:h,minTimeState:Q(u,h,c,!s,r),maxTimeState:Q(m,h,c,!s,r)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(i,s){const{timeState:c,isTimeOptionsOpen:d,isInvalid:r,timeRegex:a}=this.state,{time:u,is24Hour:m,delimiter:h,includeSeconds:t,isOpen:o,minTime:l,maxTime:p}=this.props;if(i.isOpen!==o&&this.onToggle(o),d&&!s.isTimeOptionsOpen&&c&&!r&&this.scrollToSelection(c),h!==i.delimiter&&this.setState({timeRegex:this.getRegExp()}),u!==""&&u!==i.time){const f=Q(u,a,h,!m,t);this.setState({timeState:f,isInvalid:!this.isValid(f)})}l!==""&&l!==i.minTime&&this.setState({minTimeState:Q(l,a,h,!m,t)}),p!==""&&p!==i.maxTime&&this.setState({maxTimeState:Q(p,a,h,!m,t)})}render(){const i=this.props,{"aria-label":s,isDisabled:c,className:d,placeholder:r,id:a,menuAppendTo:u,is24Hour:m,invalidFormatErrorMessage:h,invalidMinMaxErrorMessage:t,stepMinutes:o,width:l,delimiter:p,inputProps:f,onChange:I,setIsOpen:T,isOpen:P,time:_,validateTime:R,minTime:V,maxTime:q,includeSeconds:S,zIndex:$}=i,y=pt(i,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","zIndex"]),{timeState:b,isTimeOptionsOpen:Y,isInvalid:v,minTimeState:M,maxTimeState:J}=this.state,E={[un.name]:l},N=cn(o,!m,p,M,J,S),z=this.isValidFormat(b),g=a||ut("time-picker"),H=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,k=O.createElement(mt,{ref:this.menuRef,isScrollable:!0},O.createElement(ht,{maxMenuHeight:"200px"},O.createElement(ft,{"aria-label":s},N.map((le,dt)=>O.createElement(gt,{onClick:this.onSelect,key:le,id:`${g}-option-${dt}`},le))))),ee=O.createElement(Ct,Object.assign({"aria-haspopup":"menu",id:`${g}-input`,"aria-label":s,validated:v?"error":"default",placeholder:r,value:b||"",type:"text",customIcon:O.createElement(pn,null),onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:c,isExpanded:Y,ref:this.inputRef},f));let A;switch(u){case"inline":A=()=>this.toggleRef.current;break;case"parent":A=H;break;default:A=u}return O.createElement("div",{ref:this.baseComponentRef,className:ye(ve.datePicker,d)},O.createElement("div",Object.assign({className:ye(ve.datePickerInput),style:E},y),O.createElement(yt,null,O.createElement(Tt,null,O.createElement("div",{id:g},O.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},O.createElement(It,{appendTo:A,trigger:ee,triggerRef:this.toggleRef,popper:k,popperRef:this.menuRef,isVisible:Y,zIndex:$}))))),v&&O.createElement("div",{className:ye(ve.datePickerHelperText)},O.createElement(St,null,O.createElement(vt,{variant:"error"},z?t:h)))))}}Ee.displayName="TimePicker";Ee.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},zIndex:9999};const mn={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},hn=Ye(mn),fn=({name:n,label:i,helpText:s,defaultValue:c,isRequired:d,variant:r="typeaheadMulti"})=>{const{adminClient:a}=ie(),{t:u}=D(),{control:m,getValues:h,formState:{errors:t}}=W(),o=h(n),[l,p,f]=de(),[I,T]=x([]),[P,_]=x([]),[R,V]=x(""),[q,S]=x(""),$=Bt(),y=Wt(rn(S,500),[]);ne(async()=>o?(await Promise.all(o.map(M=>a.users.findOne({id:M})))).filter(M=>M!==void 0):[],v=>{T(v),r!=="typeaheadMulti"&&V(v[0]?.username||"")},[o]),ne(async()=>a.users.find({username:q,max:20}),_,[q]),Yt(()=>{(!o||o.length===0)&&(T([]),V(""))},[o]);const b=Me(()=>[...I,...P],[I,P]),Y=v=>v.map(M=>e(se,{value:M.id,selected:o?.includes(M.id),children:M.username},M.id));return C(U,{label:u(i),isRequired:d,labelIcon:e(G,{helpText:s,fieldLabelId:u(i)}),fieldId:n,children:[e(F,{name:n,defaultValue:c,control:m,rules:d&&r==="typeaheadMulti"?{validate:v=>v.length>0}:{required:d},render:({field:v})=>e(bt,{id:n,onOpenChange:p,toggle:M=>e(ce,{"data-testid":n,ref:M,variant:"typeahead",onClick:p,isExpanded:l,isFullWidth:!0,status:t[n]?"danger":void 0,children:C(Ot,{isPlain:!0,children:[e(Pt,{value:R,onClick:p,onChange:(J,E)=>{f(!0),V(E),y(E)},autoComplete:"off",innerRef:$,placeholderText:u("selectAUser"),...v.value&&{"aria-activedescendant":v.value},role:"combobox",isExpanded:l,"aria-controls":"select-create-typeahead-listbox",children:r==="typeaheadMulti"&&Array.isArray(v.value)&&e(Je,{"aria-label":"Current selections",children:v.value.map((J,E)=>e(Qe,{onClick:N=>{N.stopPropagation(),v.onChange(v.value.filter(z=>z!==J))},children:b.find(N=>N?.id===J)?.username},E))})}),e(kt,{children:!!q&&e(L,{variant:"plain",onClick:()=>{V(""),S(""),v.onChange([]),$?.current?.focus()},"aria-label":"Clear input value",children:e(Dt,{"aria-hidden":!0})})})]})}),isOpen:l,selected:v.value,onSelect:(M,J)=>{const E=J?.toString();if(r!=="typeaheadMulti"){const N=v.value.includes(E);N?v.onChange([]):v.onChange([E]),V(N?"":b.find(z=>z?.id===E)?.username||""),f(!1)}else{const N=v.value.find(z=>z===E)?v.value.filter(z=>z!==E):[...v.value,E];v.onChange(N)}},"aria-label":u(n),children:e(xt,{children:Y(P)})})}),t[n]&&e(Pe,{message:u("required")})]})},xe=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],gn=({helpLabel:n,isDisabled:i=!1,isLimited:s=!1})=>{const{t:c}=D(),{control:d}=W();return e(U,{label:c("decisionStrategy"),labelIcon:e(G,{helpText:c(n||"decisionStrategyHelp"),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(F,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:xe[0],control:d,render:({field:r})=>e(w,{children:(s?xe.slice(0,2):xe).map(a=>e(pe,{id:a,"data-testid":a,isChecked:r.value===a,isDisabled:i,name:"decisionStrategy",onChange:()=>r.onChange(a),label:c(`decisionStrategies.${a}`),className:"pf-v5-u-mb-md"},a))})})})},Cn={resources:{searchFunction:"listResources",fetchFunction:"getAssociatedResources"},policies:{searchFunction:"listPolicies",fetchFunction:"getAssociatedPolicies"}},yn=({name:n,clientId:i,permissionId:s,variant:c=Te.typeaheadMulti,preSelected:d,isRequired:r=!1})=>{const{adminClient:a}=ie(),{realm:u}=Rt(),{t:m}=D(),h=Xe(),{control:t,formState:{errors:o,isDirty:l}}=W(),[p,f]=x([]),[I,T]=x(""),[P,_]=x(!1),[R,V]=de(),[q,S]=x(),[$,y]=x(),b=Ae(i),Y=Cn[n],v=g=>({id:"_id"in g?g._id:"id"in g?g.id:void 0,name:g.name,type:g.type});ne(async()=>{const g=Object.assign({id:i,first:0,max:10,permission:"false"},I===""?null:{name:I});return await Promise.all([a.clients.listPolicyProviders({id:i}),a.clients[Y.searchFunction](g),s?a.clients[Y.fetchFunction]({id:i,permissionId:s}):Promise.resolve([]),d&&n==="resources"?a.clients.getResource({id:i,resourceId:d}):Promise.resolve([])])},([g,...H])=>{S(g.filter(k=>k.type!=="resource"&&k.type!=="scope")),f(H.flat().filter(k=>typeof k!="string").map(v).filter(({id:k},ee,A)=>ee===A.findIndex(({id:le})=>k===le)))},[I]);const[M,J]=ot({titleKey:m("unsavedChangesTitle"),messageKey:m("unsavedChangesConfirm"),continueButtonLabel:m("continue"),continueButtonVariant:oe.danger,onConfirm:()=>$?.()}),E=g=>n==="policies"?et({realm:u,id:i,policyId:g.id,policyType:g.type}):Mt({realm:u,id:i,resourceId:g.id}),N=()=>p.map(g=>e(se,{value:g.id,children:g.name},g.id)),z=g=>e(Je,{children:g.value?.map(H=>{const k=p.find(A=>A.id===H);if(!k)return;const ee=E(k);return e(Qe,{onClick:()=>{g.onChange(g.value?.filter(A=>A!==k.id))},children:e(tt,{to:ee,onClick:A=>{l&&(A.preventDefault(),y(()=>()=>h(ee)),M())},children:k.name})},k.id)})});return C(w,{children:[e(J,{}),R&&e(An,{policyProviders:q,onSelect:g=>{h($t({id:i,realm:u,policyType:g.type}))},toggleDialog:V}),e(F,{name:n,defaultValue:d?[d]:[],control:t,rules:{validate:g=>!r||g.length>0},render:({field:g})=>e(Ze,{toggleId:n,variant:c,onToggle:H=>_(H),onFilter:H=>(T(H),N()),onClear:()=>{g.onChange([]),T("")},selections:c===Te.typeaheadMulti?g.value:p.find(H=>H.id===g.value?.[0])?.name,onSelect:H=>{const k=H.toString();if(c===Te.typeaheadMulti){const ee=g.value?.find(A=>A===k)?g.value.filter(A=>A!==k):[...g.value,k];g.onChange(ee)}else g.onChange([k]);T("")},isOpen:P,"aria-label":m(n),validated:o[n]?"error":"default",typeAheadAriaLabel:m(n),chipGroupComponent:z(g),footer:n==="policies"&&!b?e(L,{variant:"link",isInline:!0,onClick:()=>{l?(_(!1),y(()=>V),M()):V()},children:m("createPolicy")}):void 0,children:N()})})]})},Tn=()=>{const{t:n}=D(),{id:i}=me(),{permissionClientId:s}=me();return C(w,{children:[e(U,{label:n("applyPolicy"),fieldId:"policies",labelIcon:e(G,{helpText:n("applyPolicyHelp"),fieldLabelId:"policies"}),children:e(yn,{name:"policies",clientId:s||i})}),e(gn,{helpLabel:"policyDecisionStagey"})]})},In=()=>{const{t:n}=D();return e(Xt,{name:"clients",label:n("clients"),helpText:n("policyClientHelp"),required:!0,defaultValue:[],variant:"typeaheadMulti",clientKey:"id"})},Sn=({clientScopes:n,clientName:i,open:s,toggleDialog:c,onAdd:d,isClientScopesConditionType:r})=>{const{t:a}=D(),[u,m]=x(!1),[h,t]=x([]),[o,l]=x("Name"),[p,f]=x("All"),[I,T]=de(),[P,_]=de(!1),R=Me(()=>p==="OpenID Connect"?n.filter(y=>y.protocol==="openid-connect"):p==="SAML"?n.filter(y=>y.protocol==="saml"):n,[n,o,p]),V=y=>{const b=h.map(Y=>({scope:Y,type:y}));d(b),m(!1),c()},q=y=>{y==="Name"?l("Protocol"):y==="Protocol"&&(l("Name"),f("All")),T()},S=y=>{y==="SAML"?f("SAML"):y==="OpenID Connect"?f("OpenID Connect"):y==="All"&&f("All"),_()},$=[e(se,{value:"SAML",children:a("protocolTypes.saml")},1),e(se,{value:"OpenID Connect",children:a("protocolTypes.openid-connect")},2),e(se,{value:"All",children:a("protocolTypes.all")},3)];return e(nt,{variant:it.medium,title:r?a("addClientScope"):a("addClientScopesTo",{clientName:i}),isOpen:s,onClose:c,actions:r?[e(L,{id:"modal-add","data-testid":"confirm",variant:oe.primary,onClick:()=>{const y=h.map(b=>({scope:b}));d(y),c()},isDisabled:h.length===0,children:a("add")},"add"),e(L,{id:"modal-cancel","data-testid":"cancel",variant:oe.link,onClick:()=>{t([]),c()},children:a("cancel")},"cancel")]:[e(Ie,{popperProps:{direction:"up"},onOpenChange:y=>m(y),className:"keycloak__client-scopes-add__add-dropdown",isOpen:u,toggle:y=>e(ce,{ref:y,isDisabled:h.length===0,onClick:()=>m(!u),variant:"primary",id:"add-dropdown","data-testid":"add-dropdown",statusIcon:e(hn,{}),children:a("add")}),children:e(Se,{children:Zt(a,V)})},"add-dropdown"),e(L,{id:"modal-cancel",variant:oe.link,onClick:()=>{t([]),c()},children:a("cancel")},"cancel")],children:e(At,{loader:R,ariaLabelKey:"chooseAMapperType",searchPlaceholderKey:o==="Name"?"searchForClientScope":void 0,isSearching:o!=="Name",searchTypeComponent:e(Ie,{onSelect:()=>{q(o)},onOpenChange:T,toggle:y=>e(ce,{ref:y,"data-testid":"filter-type-dropdown",id:"toggle-id-9",onClick:T,icon:e(Ue,{}),statusIcon:e(Ve,{}),children:o}),isOpen:I,children:e(Se,{children:e(ke,{"data-testid":"filter-type-dropdown-item",children:a(o==="Name"?"protocol":"name")},"filter-type")})}),toolbarItem:o==="Protocol"&&C(w,{children:[e(Ie,{onSelect:()=>{q(o)},onOpenChange:T,"data-testid":"filter-type-dropdown",toggle:y=>e(ce,{ref:y,id:"toggle-id-9",onClick:T,statusIcon:e(Ve,{}),icon:e(Ue,{}),children:o}),isOpen:I,children:e(Se,{children:e(ke,{"data-testid":"filter-type-dropdown-item",children:a("name")},"filter-type")})}),e(Ze,{className:"kc-protocolType-select","aria-label":a("selectOne"),onToggle:_,onSelect:y=>S(y.toString()),selections:p,isOpen:P,children:$})]}),canSelectAll:!0,onSelect:y=>t(y),columns:[{name:"name"},{name:"protocol",displayKey:"protocol",cellRenderer:y=>en(a,y.protocol??"openid-connect")},{name:"description"}],emptyState:e(Et,{message:a("emptyAddClientScopes"),instructions:a("emptyAddClientScopesInstructions")})})})},vn=()=>{const{adminClient:n}=ie(),{t:i}=D(),{control:s,getValues:c,setValue:d}=W(),[r,a]=x(!1),[u,m]=x([]),[h,t]=x([]),o=at();return ne(()=>n.clientScopes.find(),(l=[])=>{const p=c("clientScopes")||[];t(p.map(f=>l.find(I=>I.id===f.id))),m(o(l,lt("name")))},[]),C(U,{label:i("clientScopes"),labelIcon:e(G,{helpText:i("clientsClientScopesHelp"),fieldLabelId:"clientScopes"}),fieldId:"clientScopes",children:[e(F,{name:"clientScopes",control:s,defaultValue:[],render:({field:l})=>C(w,{children:[r&&e(Sn,{clientScopes:u.filter(p=>!l.value.map(f=>f.id).includes(p.id)),isClientScopesConditionType:!0,open:r,toggleDialog:()=>a(!r),onAdd:p=>{t([...h,...p.map(f=>f.scope)]),l.onChange([...l.value,...p.map(f=>f.scope).map(f=>({id:f.id,required:!1}))])}}),e(L,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{a(!0)},children:i("addClientScopes")})]})}),h.length>0&&C(he,{variant:"compact",children:[e(fe,{children:C(te,{children:[e(j,{children:i("clientScopeTitle")}),e(j,{children:i("required")}),e(j,{"aria-hidden":"true"})]})}),e(ge,{children:h.map((l,p)=>C(te,{children:[e(B,{children:l.name}),e(B,{children:e(F,{name:`clientScopes.${p}.required`,defaultValue:!1,control:s,render:({field:f})=>e(Re,{id:"required","data-testid":"standard",name:"required",isChecked:f.value,onChange:f.onChange})})}),e(B,{children:e(L,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e($e,{}),onClick:()=>{d("clientScopes",[...c("clientScopes").filter(f=>f.id!==l.id)]),t([...h.filter(f=>f.id!==l.id)])}})})]},l.id))})]})]})},bn=()=>{const{adminClient:n}=ie(),{t:i}=D(),{control:s,getValues:c,setValue:d}=W(),r=c("groups"),[a,u]=x(!1),[m,h]=x([]);return ne(()=>r&&r.length>0?Promise.all(r.map(t=>n.groups.findOne({id:t.id}))):Promise.resolve([]),t=>{const o=t.filter(l=>l);h(o)},[]),C(w,{children:[e(ue,{name:"groupsClaim",label:i("groupsClaim"),labelIcon:i("groupsClaimHelp")}),C(U,{label:i("groups"),labelIcon:e(G,{helpText:i("policyGroupsHelp"),fieldLabelId:"groups"}),fieldId:"groups",children:[e(F,{name:"groups",control:s,defaultValue:[],render:({field:t})=>C(w,{children:[a&&e(tn,{type:"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:o=>{t.onChange([...t.value||[],...(o||[]).map(({id:l})=>({id:l}))]),h([...m,...o||[]]),u(!1)},onClose:()=>{u(!1)},filterGroups:m}),e(L,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{u(!0)},children:i("addGroups")})]})}),m.length>0&&C(he,{variant:"compact",children:[e(fe,{children:C(te,{children:[e(j,{children:i("groups")}),e(j,{children:i("extendToChildren")}),e(j,{"aria-hidden":"true"})]})}),e(ge,{children:m.map((t,o)=>C(te,{children:[e(B,{children:t.path}),e(B,{children:e(F,{name:`groups.${o}.extendChildren`,defaultValue:!1,control:s,render:({field:l})=>e(Re,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:l.value,onChange:l.onChange,isDisabled:t.subGroupCount===0})})}),e(B,{children:e(L,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e($e,{}),onClick:()=>{d("groups",[...(r||[]).filter(({id:l})=>l!==t.id)]),h([...m.filter(({id:l})=>l!==t.id)])}})})]},t.id))})]})]})]})},xn=()=>{const{t:n}=D(),{control:i}=W();return e(U,{label:n("code"),labelIcon:e(G,{helpText:n("policyCodeHelp"),fieldLabelId:"code"}),fieldId:"code",isRequired:!0,children:e(F,{name:"code",defaultValue:"",control:i,render:({field:s})=>e(nn,{id:"code","data-testid":"code",readOnly:!0,value:s.value,language:"js",height:600})})})},Ke=["POSITIVE","NEGATIVE"],On=({isDisabled:n})=>{const{t:i}=D(),{control:s}=W();return e(U,{label:i("logic"),labelIcon:e(G,{helpText:i("logicHelp"),fieldLabelId:"logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(F,{name:"logic","data-testid":"logic",defaultValue:Ke[0],control:s,render:({field:c})=>e(w,{children:Ke.map(d=>e(pe,{id:d,"data-testid":d,isChecked:c.value===d,name:"logic",onChange:()=>c.onChange(d),label:i(`logicType.${d.toLowerCase()}`),className:"pf-v5-u-mb-md",isDisabled:n},d))})})})},Pn=({isDisabled:n,clientId:i})=>{const{t:s}=D(),c=Ae(i);return C(w,{children:[e(ue,{name:"name",label:s("name"),labelIcon:c?s("permissionNameHelpText"):"",rules:{required:s("required")},isDisabled:n}),e(wt,{name:"description",label:s("description"),rules:{maxLength:{message:s("maxLength",{length:255}),value:255}},isDisabled:n})]})},kn=()=>{const{t:n}=D();return C(w,{children:[e(ue,{name:"targetClaim",label:n("targetClaim"),labelIcon:n("targetClaimHelp"),rules:{required:n("required")}}),e(ue,{name:"pattern",label:n("regexPattern"),labelIcon:n("regexPatternHelp"),rules:{required:n("required")}}),e(Vt,{name:"targetContextAttributes",label:n("targetContextAttributes"),labelIcon:n("targetContextAttributesHelp"),labelOn:n("yes"),labelOff:n("no")})]})},Dn=()=>{const{adminClient:n}=ie(),{t:i}=D(),{control:s,getValues:c,setValue:d}=W(),r=c("roles"),[a,u]=x(!1),[m,h]=x([]);return ne(async()=>{if(r&&r.length>0){const t=await Promise.all(r.map(o=>n.roles.findOneById({id:o.id})));return Promise.all(t.map(async o=>({role:o,client:o.clientRole?await n.clients.findOne({id:o?.containerId}):void 0})))}return Promise.resolve([])},h,[]),C(w,{children:[C(U,{label:i("roles"),labelIcon:e(G,{helpText:i("policyRolesHelp"),fieldLabelId:"roles"}),fieldId:"roles",children:[e(F,{name:"roles",control:s,defaultValue:[],render:({field:t})=>C(w,{children:[a&&e(on,{id:"role",type:"roles",title:i("assignRole"),onAssign:o=>{t.onChange([...t.value||[],...o.map(l=>({id:l.role.id}))]),h([...m,...o]),u(!1)},onClose:()=>{u(!1)}}),e(L,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{u(!0)},children:i("addRoles")})]})}),m.length>0&&C(he,{variant:"compact",children:[e(fe,{children:C(te,{children:[e(j,{children:i("roles")}),e(j,{children:i("required")}),e(j,{"aria-hidden":"true"})]})}),e(ge,{children:m.map((t,o)=>C(te,{children:[e(B,{children:e(an,{role:t.role,client:t.client})}),e(B,{children:e(F,{name:`roles.${o}.required`,defaultValue:!1,control:s,render:({field:l})=>e(Re,{id:"required","data-testid":"standard",name:"required",isChecked:l.value,onChange:l.onChange})})}),e(B,{children:e(L,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e($e,{}),onClick:()=>{d("roles",[...(r||[]).filter(l=>l.id!==t.role.id)]),h([...m.filter(l=>l.role.id!==t.role.id)])}})})]},t.role.id))})]})]}),e(sn,{name:"fetchRoles",label:i("fetchRoles"),labelIcon:i("fetchRolesHelp")})]})},Oe=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,je=n=>n.toString().padStart(2,"0"),Be=({name:n})=>{const{control:i}=W(),s=(d,r)=>{if(!r)return d;const a=Oe.exec(d);return`${[r.getFullYear(),je(r.getMonth()+1),je(r.getDate())].join("-")} ${a?a[2]:"00"}:${a?a[3]:"00"}:00`},c=(d,r,a)=>{const u=Oe.exec(d);return a!=null?`${u?u[1]:""} ${r}:${a<10?`0${a}`:a}:00`:d};return e(F,{name:n,defaultValue:"",control:i,rules:{required:!0},render:({field:d})=>{const r=d.value.match(Oe)||["","","0","00"];return C(st,{hasGutter:!0,id:n,children:[e(ae,{children:e(ln,{value:r[1],onChange:(a,u,m)=>{d.onChange(s(d.value,m))}})}),e(ae,{children:e(Ee,{time:`${r[2]}:${r[3]}`,onChange:(a,u,m,h)=>d.onChange(c(d.value,m,h)),is24Hour:!0})})]})}})},We=({name:n,min:i,max:s})=>{const{control:c}=W(),d=r=>Math.min(r,s);return e(F,{name:n,defaultValue:"",control:c,render:({field:r})=>e(Nt,{id:n,value:r.value,min:i,max:s,onPlus:()=>r.onChange(Number(r.value)+1),onMinus:()=>r.onChange(Number(r.value)-1),onChange:a=>{const u=Number(a.currentTarget.value);r.onChange(d(isNaN(u)?0:u))}})})},re=({name:n,...i})=>{const{t:s}=D();return e(U,{label:s(n),fieldId:n,labelIcon:e(G,{helpText:s(`${n}Help`),fieldLabelId:n}),children:C(st,{hasGutter:!0,children:[e(ae,{children:e(We,{name:n,...i})}),e(ae,{children:s("to")}),e(ae,{children:e(We,{name:`${n}End`,...i})})]})})},Rn=()=>{const{t:n}=D(),{getValues:i,formState:{errors:s}}=W(),[c,d]=x(i("month"));return C(w,{children:[e(U,{label:n("repeat"),fieldId:"repeat",labelIcon:e(G,{helpText:n("repeatHelp"),fieldLabelId:"repeat"}),children:C(_t,{children:[e(_e,{children:e(pe,{id:"notRepeat","data-testid":"notRepeat",isChecked:!c,name:"repeat",onChange:()=>d(!1),label:n("notRepeat"),className:"pf-v5-u-mb-md"})}),e(_e,{children:e(pe,{id:"repeat","data-testid":"repeat",isChecked:c,name:"repeat",onChange:()=>d(!0),label:n("repeat"),className:"pf-v5-u-mb-md"})})]})}),c&&C(w,{children:[e(re,{name:"month",min:1,max:12}),e(re,{name:"dayMonth",min:1,max:31}),e(re,{name:"hour",min:0,max:23}),e(re,{name:"minute",min:0,max:59})]}),C(U,{label:n("startTime"),fieldId:"notBefore",labelIcon:e(G,{helpText:n("startTimeHelp"),fieldLabelId:"startTime"}),isRequired:!0,children:[e(Be,{name:"notBefore"}),s.notBefore&&e(Pe,{message:n("required")})]}),C(U,{label:n("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(G,{helpText:n("expireTimeHelp"),fieldLabelId:"expireTime"}),isRequired:!0,children:[e(Be,{name:"notOnOrAfter"}),s.notOnOrAfter&&e(Pe,{message:n("required")})]})]})},$n=()=>{const{t:n}=D();return e(fn,{name:"users",label:"users",helpText:n("policyUsers"),defaultValue:[],variant:"typeaheadMulti"})},De={aggregate:Tn,client:In,user:$n,"client-scope":vn,group:bn,regex:kn,role:Dn,time:Rn,js:xn},we=n=>n in De;function Mn(){const{adminClient:n}=ie(),{t:i}=D(),{id:s,realm:c,policyId:d,policyType:r}=me(),{permissionClientId:a}=me(),u=Xe(),m=Ht(),{reset:h,handleSubmit:t}=m,{addAlert:o,addError:l}=Lt(),[p,f]=x(),I=r==="js",T=Ae(a);ne(async()=>{if(d){const S=await Promise.all([n.clients.findOnePolicy({id:a??s,type:r,policyId:d}),n.clients.getAssociatedPolicies({id:a??s,permissionId:d})]);if(!S[0])throw new Error(i("notFound"));return{policy:S[0],policies:S[1].map($=>$.id)}}return{}},({policy:S,policies:$})=>{h({...S,policies:$}),f(S)},[a,s,r,d]);const P=async S=>{S.groups=S.groups?.filter(b=>b.id),S.clientScopes=S.clientScopes?.filter(b=>b.id),S.roles=S.roles?.filter(b=>b.id).map(b=>({...b,required:b.required||!1}));const $=T?a:s,y=T?zt:et;try{if(d)await n.clients.updatePolicy({id:$,type:r,policyId:d},S);else{const b=await n.clients.createPolicy({id:$,type:r},S);u(y({realm:c,id:$,permissionClientId:$,policyId:b.id,policyType:b.type}))}o(i((d?"update":"create")+"PolicySuccess"),Ne.success)}catch(b){l("policySaveError",b)}},[_,R]=ot({titleKey:"deletePolicy",messageKey:"deletePolicyConfirm",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.clients.delPolicy({id:T?a:s,policyId:d}),o(i("policyDeletedSuccess"),Ne.success),u(T?He({realm:c,permissionClientId:a,tab:"policies"}):Le({realm:c,clientId:s,tab:"policies"}))}catch(S){l("policyDeletedError",S)}}});if(d&&!p)return e(Ft,{});function V(){return we(r)?De[r]:De.js}const q=V();return C(w,{children:[e(R,{}),e(Qt,{titleKey:d?p?.name:i("createPolicyOfType",{policyType:r}),dropdownItems:d?[e(ke,{"data-testid":"delete-policy",onClick:()=>_(),children:i("delete")},"delete")]:void 0}),e(Ut,{variant:"light",children:C(Jt,{isHorizontal:!0,onSubmit:t(S=>P(S)),role:"anyone",children:[C(Gt,{...m,children:[e(Pn,{isDisabled:I}),e(q,{}),e(On,{isDisabled:I})]}),e(qt,{children:C("div",{className:"pf-v5-u-mt-md",children:[e(L,{isDisabled:I,variant:oe.primary,className:"pf-v5-u-mr-md",type:"submit","data-testid":"save",children:i("save")}),e(L,{variant:"link","data-testid":"cancel",component:S=>e(tt,{...S,to:T?He({realm:c,permissionClientId:a,tab:"policies"}):Le({realm:c,clientId:s,tab:"policies"})}),children:i("cancel")})]})})]})})]})}const Xn=Object.freeze(Object.defineProperty({__proto__:null,default:Mn,isValidComponentType:we},Symbol.toStringTag,{value:"Module"})),An=({policyProviders:n,onSelect:i,toggleDialog:s})=>{const{t:c}=D(),d=at(),r=Me(()=>n?d(n,lt("name")):[],[n]);return e(nt,{"aria-label":c("createPolicy"),variant:it.medium,header:C(Kt,{children:[e(Fe,{component:jt.h1,children:c("chooseAPolicyType")}),e(Fe,{children:c("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:s,children:C(he,{"aria-label":c("policies"),variant:"compact",children:[e(fe,{children:C(te,{children:[e(j,{children:c("name")}),e(j,{children:c("description")})]})}),e(ge,{children:r.map(a=>C(te,{"data-testid":a.type,onRowClick:()=>i(a),isClickable:!0,children:[e(B,{children:a.name}),e(B,{style:{textWrap:"wrap"},children:we(a.type)&&c(`policyProvider.${a.type}`)})]},a.type))})]})})};export{Sn as A,vn as C,gn as D,bn as G,xn as J,On as L,An as N,Xn as P,yn as R,Rn as T,fn as U,Dn as a,kn as b,$n as c,In as d,Tn as e,Pn as f};
//# sourceMappingURL=NewPolicyDialog-Diogklhm.js.map
