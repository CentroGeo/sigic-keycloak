import{jsx as e,jsxs as h,Fragment as L}from"react/jsx-runtime";import{a as N,K as f,bO as ee,bP as j,u as ae,Z as E,J as D,j as B,y as se,n as z,Y as oe,O as x,$ as de,a8 as K,R as P,N as O,bn as U,bo as Y,S as ce,ai as $,ca as Z,e as te,z as le,l as ne,M as ue,m as me,F as ie,h as H,B as pe,ac as he,aM as be,bm as ve,au as _,aG as W,aN as ge,aL as G,G as ye,H as fe,b as Ce,V as ke,o as Te,ed as qe,P as Se,ee as re,q as Ne,bi as Ve,L as Ae}from"./main-Dml5vH_M.js";import{useState as S,useMemo as Ie,useEffect as we}from"react";import{F,b as xe}from"./FormAccess-Dgk035ov.js";import{V as Re}from"./ViewHeader-CnGpO8mW.js";import{u as J}from"./useParams-Cmi1OAEj.js";import{U as Pe}from"./UserProfileContext-CAK45ckM.js";import{T as Oe,s as Le}from"./TranslatableField-MXbEXipf.js";import{K as He}from"./KeyValueInput-CataZRq4.js";/* empty css                               */import{D as De}from"./SwitchControl-DVIXTwQM.js";import{u as Ee}from"./ConfirmDialog-BN0phSta.js";import{D as Me}from"./DynamicComponents-Cxsqsl9R.js";import{u as We,m as Ge}from"./useLocaleSort-DeXbTEE9.js";import{i as je}from"./isEqual-xoTijI-C.js";import"react-dom";import"./useLocale-mdrT38Tm.js";import"./Trans-BHLWmjXF.js";import"./KeySelect-Ba6sDuzD.js";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./MultiLineInput-BnUu5qtj.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./translationFormatter-DtFomvax.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";const Be=()=>{const{t}=N();return e(F,{role:"manage-realm",isHorizontal:!0,children:e(f,{hasNoPaddingTop:!0,label:t("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(ee,{className:"kc-annotations",children:e(j,{children:e(He,{name:"annotations",label:t("annotations"),defaultKeyValue:[{key:"inputType",label:t("inputType"),values:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"]},{key:"inputHelperTextBefore",label:t("inputHelperTextBefore")},{key:"inputHelperTextAfter",label:t("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",label:t("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",label:t("inputTypePlaceholder")},{key:"inputTypeSize",label:t("inputTypeSize")},{key:"inputTypeCols",label:t("inputTypeCols")},{key:"inputTypeRows",label:t("inputTypeRows")},{key:"inputTypeStep",label:t("inputTypeStep")},{key:"kcNumberFormat",label:t("kcNumberFormat")},{key:"kcNumberUnFormat",label:t("kcNumberUnFormat")}]})})})})})},Q=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],Ke=()=>{const{adminClient:t}=ae(),{t:a}=N(),r=E(),[l,s]=S(),[m,b]=S(),[g,y]=S(!1),[o,v]=S(!1),[I,p]=S(""),C=We(),{attributeName:i}=J(),w=!!i,k=D({control:r.control,name:"hasSelector"}),T=D({control:r.control,name:"hasRequiredScopes"}),R=D({control:r.control,name:"isRequired",defaultValue:!1});if(B(()=>t.clientScopes.find(),s,[]),B(()=>t.users.getProfile(),b,[]),!l)return e(se,{});function c(n){r.setValue("hasSelector",n)}function u(n){r.setValue("hasRequiredScopes",n)}const V=()=>C(l,Ge("name")).filter(n=>I===""||n.name?.includes(I)).map(n=>e($,{value:n.name,children:n.name},n.name));return e(z,{...r,children:h(F,{role:"manage-realm",isHorizontal:!0,children:[e(oe,{name:"name",label:a("attributeName"),labelIcon:a("upAttributeNameHelp"),isDisabled:w,rules:{required:a("validateAttributeName")}}),e(f,{label:a("attributeDisplayName"),labelIcon:e(x,{helpText:a("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-displayName",children:e(Oe,{attributeName:"name",prefix:"profile.attributes",fieldName:"displayName"})}),e(De,{name:"multivalued",label:a("multivalued"),labelIcon:a("multivaluedHelp")}),e(de,{name:"group",label:a("attributeGroup"),labelIcon:a("attributeGroupHelp"),controller:{defaultValue:""},options:[{key:"",value:a("none")},...m?.groups?.map(n=>({key:n.name,value:n.name}))||[]]}),!Je.includes(i)&&h(L,{children:[e(K,{}),h(f,{label:a("enabledWhen"),labelIcon:e(x,{helpText:a("enabledWhenTooltip"),fieldLabelId:"enabled-when"}),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(P,{id:"always","data-testid":"always",isChecked:!k,name:"enabledWhen",label:a("always"),onChange:()=>c(!1),className:"pf-v5-u-mb-md"}),e(P,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:k,name:"enabledWhen",label:a("scopesAsRequested"),onChange:()=>c(!0),className:"pf-v5-u-mb-md"})]}),k&&e(f,{fieldId:"kc-scope-enabled-when",children:e(O,{name:"selector.scopes",control:r.control,defaultValue:[],render:({field:n})=>e(U,{"data-testid":"enabled-when-scope-field",variant:Y.typeaheadMulti,onFilter:d=>(p(d),V()),typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:d=>y(d),selections:n.value,onSelect:d=>{const q=d.toString();let A=[""];n.value?A=n.value.includes(q)?n.value.filter(M=>M!==q):[...n.value,q]:A=[q],n.onChange(A)},onClear:()=>{n.onChange([])},isOpen:g,"aria-labelledby":"scope",children:V()})})})]}),i!=="username"&&h(L,{children:[e(K,{}),e(f,{label:a("required"),labelIcon:e(x,{helpText:a("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e(O,{name:"isRequired","data-testid":"required",defaultValue:!1,control:r.control,render:({field:n})=>e(ce,{id:"kc-required",onChange:n.onChange,isChecked:n.value,label:a("on"),labelOff:a("off"),"aria-label":a("required")})})}),R&&h(L,{children:[e(f,{label:a("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e(O,{name:"required.roles","data-testid":"requiredFor",defaultValue:Q[0].value,control:r.control,render:({field:n})=>e("div",{className:"kc-requiredFor",children:Q.map(d=>e(P,{id:d.label,"data-testid":d.label,isChecked:je(n.value,d.value),name:"roles",onChange:()=>{n.onChange(d.value)},label:a(d.label),className:"kc-requiredFor-option"},d.label))})})}),h(f,{label:a("requiredWhen"),labelIcon:e(x,{helpText:a("requiredWhenTooltip"),fieldLabelId:"required-when"}),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(P,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!T,name:"requiredWhen",label:a("always"),onChange:()=>u(!1),className:"pf-v5-u-mb-md"}),e(P,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:T,name:"requiredWhen",label:a("scopesAsRequested"),onChange:()=>u(!0),className:"pf-v5-u-mb-md"})]}),T&&e(f,{fieldId:"kc-scope-required-when",children:e(O,{name:"required.scopes",control:r.control,defaultValue:[],render:({field:n})=>e(U,{"data-testid":"required-when-scope-field",variant:Y.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:d=>v(d),selections:n.value,onSelect:d=>{const q=d.toString();let A=[""];n.value?A=n.value.includes(q)?n.value.filter(M=>M!==q):[...n.value,q]:A=[q],n.onChange(A)},onClear:()=>{n.onChange([])},isOpen:o,"aria-labelledby":"scope",children:l.map(d=>e($,{value:d.name,children:d.name},d.name))})})})]})]})]})})},X=({name:t})=>{const{t:a}=N(),{control:r}=E();return e(ee,{children:e(O,{name:`permissions.${t}`,control:r,defaultValue:[],render:({field:l})=>h(L,{children:[e(j,{lg:4,sm:6,children:e(Z,{id:`user-${t}`,label:a("user"),value:"user","data-testid":`user-${t}`,isChecked:l.value.includes("user"),onChange:()=>{const s="user",m=l.value.includes(s)?l.value.filter(b=>b!==s):[...l.value,s];l.onChange(m)}})}),e(j,{lg:8,sm:6,children:e(Z,{id:`admin-${t}`,label:a("admin"),value:"admin","data-testid":`admin-${t}`,isChecked:l.value.includes("admin"),onChange:()=>{const s="admin",m=l.value.includes(s)?l.value.filter(b=>b!==s):[...l.value,s];l.onChange(m)}})})]})})})},Ue=()=>{const{t}=N();return h(F,{role:"manage-realm",isHorizontal:!0,children:[e(f,{hasNoPaddingTop:!0,label:t("whoCanEdit"),labelIcon:e(x,{helpText:t("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(X,{name:"edit"})}),e(f,{hasNoPaddingTop:!0,label:t("whoCanView"),labelIcon:e(x,{helpText:t("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(X,{name:"view"})})]})},$e=({selectedValidators:t,onChange:a})=>{const{t:r}=N(),l=te().componentTypes?.["org.keycloak.validate.Validator"]||[],s=Ie(()=>l.filter(({id:o})=>!t.includes(o)),[t]),[m,b]=le(),[g,y]=S();return e(f,{label:r("validatorType"),fieldId:"validator",children:e(U,{toggleId:"validator",onToggle:b,onSelect:o=>{const v=o;a(v),y(v),b()},selections:g?.id,variant:"single","aria-label":r("selectOne"),isOpen:m,placeholderText:r("choose"),menuAppendTo:"parent",maxHeight:300,children:s.map(o=>e($,{selected:g?.id===o.id,value:o,description:o.helpText,children:o.id},o.id))})})},ze=({selectedValidators:t,toggleDialog:a,onConfirm:r})=>{const{t:l}=N(),[s,m]=S(),b=te().componentTypes?.["org.keycloak.validate.Validator"].length===t.length,g=ne(),{handleSubmit:y}=g,o=v=>{r({...v,id:s?.id}),a()};return e(ue,{variant:me.small,title:l("addValidator"),isOpen:!0,onClose:a,actions:[e(H,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:l("save")},"save"),e(H,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:a,children:l("cancel")},"cancel")],children:b?l("emptyValidators"):h(ie,{id:"add-validator",onSubmit:y(o),children:[e($e,{selectedValidators:t.map(v=>v.key),onChange:m}),s&&e(z,{...g,children:e(Me,{properties:s.properties})})]})})},Fe=()=>{const{t}=N(),[a,r]=le(),[l,s]=S(),{setValue:m,control:b,register:g,getValues:y}=E(),o=D({name:"validations",control:b,defaultValue:[]});we(()=>{g("validations")},[g]);const[v,I]=Ee({titleKey:t("deleteValidatorConfirmTitle"),messageKey:t("deleteValidatorConfirmMsg",{validatorName:l}),continueButtonLabel:"delete",continueButtonVariant:pe.danger,onConfirm:async()=>{const p=o.filter(C=>C.key!==l);m("validations",[...p])}});return h(L,{children:[a&&e(ze,{selectedValidators:o,onConfirm:p=>{const C=y("annotations");p.id==="options"&&!C.find(i=>i.key==="inputType")&&m("annotations",[...C,{key:"inputType",value:"select"}]),m("validations",[...o,{key:p.id,value:p.config}])},toggleDialog:r}),e(I,{}),h("div",{className:"kc-attributes-validations",children:[e(H,{id:"addValidator",onClick:()=>r(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(he,{}),children:t("addValidator")}),e(K,{}),o.length!==0?h(be,{children:[e(ve,{children:h(_,{children:[e(W,{children:t("validatorColNames.colName")}),e(W,{children:t("validatorColNames.colConfig")}),e(W,{"aria-hidden":"true"})]})}),e(ge,{children:o.map(p=>h(_,{children:[e(G,{dataLabel:t("validatorColNames.colName"),children:p.key}),e(G,{dataLabel:t("validatorColNames.colConfig"),children:JSON.stringify(p.value)}),e(G,{className:"kc--attributes-validations--action-cell",children:e(H,{variant:"link","data-testid":"deleteValidator",onClick:()=>{v(),s(p.key)},children:t("delete")},"validator")})]},p.key))})]}):e(ye,{className:"kc-emptyValidators",component:fe.p,children:t("emptyValidators")})]})]})},Je=["username","email"],Ye=({save:t})=>{const{t:a}=N(),r=E(),{realm:l,attributeName:s}=J(),m=!!s;return h(Pe,{children:[e(Ve,{label:a("jumpToSection"),sections:[{title:a("generalSettings"),panel:e(Ke,{})},{title:a("permission"),panel:e(Ue,{})},{title:a("validations"),panel:e(Fe,{})},{title:a("annotations"),panel:e(Be,{})}]}),e(ie,{onSubmit:r.handleSubmit(t),children:h(xe,{name:"attribute-settings",children:[e(H,{variant:"primary",type:"submit","data-testid":"attribute-create",children:a(m?"save":"create")}),e(Ae,{to:re({realm:l,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:a("cancel")})]})})]})};function Sa(){const{adminClient:t}=ae(),{realm:a,attributeName:r}=J(),l=ne(),{t:s}=N(),m=Ce(),{addAlert:b,addError:g}=ke(),[y,o]=S(null),v=!!r;B(()=>t.users.getProfile(),p=>{o(p);const{annotations:C,validations:i,permissions:w,selector:k,required:T,multivalued:R,...c}=p.attributes.find(u=>u.name===r)||{permissions:{edit:["admin"]}};Te({...c,hasSelector:typeof k<"u",hasRequiredScopes:typeof T?.scopes<"u"},l.setValue),Object.entries(qe({permissions:w,selector:k,required:T},{safe:!0})).map(([u,V])=>l.setValue(u,V)),l.setValue("annotations",Object.entries(C||{}).map(([u,V])=>({key:u,value:V}))),l.setValue("validations",Object.entries(i||{}).map(([u,V])=>({key:u,value:V}))),l.setValue("isRequired",T!==void 0),l.setValue("multivalued",R===!0)},[]);const I=async({hasSelector:p,hasRequiredScopes:C,...i})=>{p||delete i.selector,C||delete i.required?.scopes;const w=i.validations.reduce((c,u)=>(c[u.key]=u.value||{},c),{}),k=i.annotations.reduce((c,u)=>Object.assign(c,{[u.key]:u.value}),{}),T=()=>(y?.attributes||[]).map(c=>c.name!==r?c:(delete c.required,Object.assign({...c,name:r,displayName:i.displayName,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:k,validations:w},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:{group:null}))),R=()=>(y?.attributes||[]).concat([Object.assign({name:i.name,displayName:i.displayName,required:i.isRequired?i.required:void 0,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:k,validations:w},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:void 0)]);try{const c=v?T():R();if(await t.users.updateProfile({...y,attributes:c,realm:a}),i.translation)try{await Le({adminClient:t,realmName:a,translationsData:{translation:i.translation}})}catch(u){g(s("errorSavingTranslations"),u)}m(re({realm:a,tab:"attributes"})),b(s("createAttributeSuccess"),Ne.success)}catch(c){g("createAttributeError",c)}};return h(z,{...l,children:[e(Re,{titleKey:v?r:s("createAttribute"),subKey:v?"":s("createAttributeSubTitle")}),e(Se,{variant:"light",children:e(Ye,{save:()=>l.handleSubmit(I)()})})]})}export{Je as USERNAME_EMAIL,Sa as default};
//# sourceMappingURL=NewAttributeSettings-B0PnVreq.js.map
