import{jsxs as y,jsx as e,Fragment as E}from"react/jsx-runtime";import{u as T,a as R,V as k,d as L,l as O,M as x,m as I,E as V,F as q,K as U,a1 as K,h as v,B as M,q as d,al as P,D as N,P as j,bk as z,z as G,bn as H,ai as A}from"./main-Dml5vH_M.js";import{useState as S}from"react";import{u as $}from"./ConfirmDialog-BN0phSta.js";import{V as J}from"./ViewHeader-CnGpO8mW.js";import{S as Q}from"./SessionsTable-DfgS4rWw.js";import{F as W}from"./filter-icon-BO7Evf9d.js";import"react-dom";import"./useFormatDate-Puc65BKQ.js";const X=({handleModalToggle:n,save:l})=>{const{adminClient:a}=T(),{t}=R(),{addAlert:s,addError:c}=k(),{realm:r,realmRepresentation:u,refresh:h}=L(),{register:m,handleSubmit:b}=O(),C=(o,p)=>{const i=o.successRequests?.length||0,g=o.failedRequests?.length||0;i===0&&g===0?s(t("noAdminUrlSet"),d.warning):g>0?(s(t(""+p+"Success",{successNodes:o.successRequests}),d.success),s(t(""+p+"Fail",{failedNodes:o.failedRequests}),d.danger)):s(t(""+p+"Success",{successNodes:o.successRequests}),d.success)},w=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:Date.now()/1e3}),s(t("notBeforeSuccess"),d.success)}catch(o){c("setToNowError",o)}},f=async()=>{try{await a.realms.update({realm:r},{realm:r,notBefore:0}),s(t("notBeforeClearedSuccess"),d.success),h()}catch(o){c("notBeforeError",o)}},B=async()=>{const o=await a.realms.pushRevocation({realm:r});C(o,"notBeforePush"),h()};return y(x,{variant:I.small,title:t("revocation"),isOpen:!0,onClose:n,actions:[e(v,{"data-testid":"set-to-now-button",variant:"tertiary",onClick:()=>{w(),n()},form:"revocation-modal-form",children:t("setToNow")},"set-to-now"),e(v,{"data-testid":"clear-not-before-button",variant:"tertiary",onClick:()=>{f(),n()},form:"revocation-modal-form",children:t("clear")},"clear"),e(v,{"data-testid":"modal-test-connection-button",variant:"secondary",onClick:()=>{B(),n()},form:"revocation-modal-form",children:t("push")},"push"),e(v,{id:"modal-cancel","data-testid":"cancel",variant:M.link,onClick:()=>{n()},children:t("cancel")},"cancel")],children:[e(V,{className:"kc-revocation-description-text",children:t("revocationDescription")}),e(q,{id:"revocation-modal-form",isHorizontal:!0,onSubmit:b(l),children:e(U,{className:"kc-revocation-modal-form-group",label:t("notBefore"),name:"notBefore",fieldId:"not-before",children:e(K,{"data-testid":"not-before-input",autoFocus:!0,readOnly:!0,value:u?.notBefore===0?t("none"):new Date(u?.notBefore*1e3).toString(),type:"text",id:"not-before",...m("notBefore")})})})]})},Y=({filterType:n,onChange:l})=>{const{t:a}=R(),[t,s]=G();return y(H,{"data-testid":"filter-session-type-select",isOpen:t,onToggle:s,toggleIcon:e(W,{}),onSelect:c=>{l(c),s()},selections:n,children:[e(A,{"data-testid":"all-sessions-option",value:"ALL",children:a("sessionsType.allSessions")}),e(A,{"data-testid":"regular-sso-option",value:"REGULAR",children:a("sessionsType.regularSSO")}),e(A,{"data-testid":"offline-option",value:"OFFLINE",children:a("sessionsType.offline")})]})};function ie(){const{adminClient:n}=T(),{t:l}=R(),[a,t]=S(0),s=()=>t(a+1),{addError:c}=k(),{realm:r}=L(),[u,h]=S(!1),[m,b]=S("ALL"),[C,w]=S(!1),f=()=>{h(!u)},B=async(i,g,D)=>{const F=await z(n,"ui-ext/sessions",{first:`${i}`,max:`${g}`,type:m,search:D||""});return w(F.length===0),F},[o,p]=$({titleKey:"logoutAllSessions",messageKey:"logoutAllDescription",continueButtonLabel:"confirm",onConfirm:async()=>{try{await n.realms.logoutAll({realm:r}),s()}catch(i){c("logoutAllSessionsError",i)}}});return y(E,{children:[e(p,{}),e(J,{dropdownItems:[e(N,{"data-testid":"revocation",component:"button",onClick:()=>f(),children:l("revocation")},"toggle-modal"),e(N,{"data-testid":"logout-all",component:"button",isDisabled:C,onClick:o,children:l("signOutAllActiveSessions")},"delete-role")],titleKey:"titleSessions",subKey:"sessionExplain",helpUrl:P.sessionsUrl}),y(j,{variant:"light",className:"pf-v5-u-p-0",children:[u&&e(X,{handleModalToggle:f,save:()=>{f()}}),e(Q,{loader:B,isSearching:m!=="ALL",isPaginated:!0,filter:e(Y,{filterType:m,onChange:i=>{b(i),s()}})},a)]})]})}export{ie as default};
//# sourceMappingURL=SessionsSection-9GudKduL.js.map
