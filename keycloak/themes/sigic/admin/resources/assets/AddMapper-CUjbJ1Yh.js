import{jsxs as m,Fragment as S,jsx as r}from"react/jsx-runtime";import{a as O,Y as V,$ as B,K,N as j,bn as k,bo as x,ai as E,O as L,u as N,l as U,V as H,b as $,d as G,B as Y,q as P,cI as C,j as z,o as R,y as J,P as Q,D as W,n as X,A as Z,h as T,L as _,p as ee,cK as re}from"./main-Dml5vH_M.js";import{useState as I}from"react";import{u as ae}from"./ConfirmDialog-BN0phSta.js";import{D as te}from"./DynamicComponents-Cxsqsl9R.js";import{F as ie}from"./FormAccess-Dgk035ov.js";import{V as se}from"./ViewHeader-CnGpO8mW.js";import{u as oe,m as ne}from"./useLocaleSort-DeXbTEE9.js";import{u as pe}from"./useParams-Cmi1OAEj.js";import"react-dom";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./KeySelect-Ba6sDuzD.js";import"./MultiLineInput-BnUu5qtj.js";import"./AddRoleMappingModal-FlNvMd3n.js";import"./translationFormatter-DtFomvax.js";import"./filter-icon-BO7Evf9d.js";import"./CodeEditor-C7HQ48Ys.js";const de=({mapperTypes:n,mapperType:a,form:d,id:f,updateMapperType:u})=>{const{t:s}=O(),{control:M}=d,[g,l]=I(!1),t=["inherit","import","legacy","force"];return m(S,{children:[r(V,{name:"name",label:s("name"),labelIcon:s("addIdpMapperNameHelp"),readOnly:!!f,rules:{required:s("required")}}),r(B,{name:"config.syncMode",label:s("syncModeOverride"),labelIcon:s("syncModeOverrideHelp"),options:t.map(i=>({key:i.toUpperCase(),value:s(`syncModes.${i}`)})),controller:{defaultValue:t[0].toUpperCase()}}),r(K,{label:s("mapperType"),labelIcon:r(L,{helpText:a.helpText,fieldLabelId:"mapperType"}),fieldId:"identityProviderMapper",children:r(j,{name:"identityProviderMapper",defaultValue:n[0].id,control:M,render:({field:i})=>r(k,{toggleId:"identityProviderMapper","data-testid":"idp-mapper-select",isDisabled:!!f,onToggle:()=>l(!g),onSelect:e=>{const y=e;u(y),i.onChange(y.id),l(!1)},selections:a.name,variant:x.single,"aria-label":s("mapperType"),isOpen:g,children:n.map(e=>r(E,{selected:e===i.value,"data-testid":e.id,value:e,children:e.name},e.name))})})})]})};function De(){const{adminClient:n}=N(),{t:a}=O(),d=U({shouldUnregister:!0}),{handleSubmit:f}=d,{addAlert:u,addError:s}=H(),M=$(),g=oe(),{realm:l}=G(),{id:t,providerId:i,alias:e}=pe(),[y,F]=I(),[v,h]=I(),A=async o=>{const b=ee(o),c={...b,config:{...b.config},identityProviderAlias:e};if(t)try{await n.identityProviders.updateMapper({id:t,alias:e},{...c,id:t}),u(a("mapperSaveSuccess"),P.success)}catch(p){s("mapperSaveError",p)}else try{const p=await n.identityProviders.createMapper({identityProviderMapper:c,alias:e});u(a("mapperCreateSuccess"),P.success),M(re({realm:l,alias:e,providerId:i,id:p.id}))}catch(p){s("mapperCreateError",p)}},[D,w]=ae({titleKey:"deleteProviderMapper",messageKey:a("deleteMapperConfirm",{mapper:v?.name}),continueButtonLabel:"delete",continueButtonVariant:Y.danger,onConfirm:async()=>{try{await n.identityProviders.delMapper({alias:e,id:t}),u(a("deleteMapperSuccess"),P.success),M(C({providerId:i,alias:e,tab:"mappers",realm:l}))}catch(o){s("deleteErrorIdentityProvider",o)}}});z(()=>Promise.all([t?n.identityProviders.findOneMapper({alias:e,id:t}):null,n.identityProviders.findMapperTypes({alias:e})]),([o,b])=>{const c=g(Object.values(b),ne("name"));o?(h(c.find(({id:p})=>p===o.identityProviderMapper)),q(o)):h(c[0]),F(c)},[t]);const q=o=>{R(o,d.setValue)};return!y||!v?r(J,{}):m(Q,{variant:"light",children:[r(w,{}),r(se,{className:"kc-add-mapper-title",titleKey:t?a("editIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}):a("addIdPMapper",{providerId:i[0].toUpperCase()+i.substring(1)}),dropdownItems:t?[r(W,{onClick:D,children:a("delete")},"delete")]:void 0,divider:!0}),m(ie,{role:"manage-identity-providers",isHorizontal:!0,onSubmit:f(A),className:"pf-v5-u-mt-lg",children:[m(X,{...d,children:[t&&r(V,{name:"id",label:a("id"),readOnly:!0,rules:{required:a("required")}}),v.properties&&m(S,{children:[r(de,{form:d,id:t,mapperTypes:y,updateMapperType:h,mapperType:v}),r(te,{properties:v.properties})]})]}),m(Z,{children:[r(T,{"data-testid":"new-mapper-save-button",variant:"primary",type:"submit",children:a("save")}),r(T,{"data-testid":"new-mapper-cancel-button",variant:"link",component:o=>r(_,{...o,to:C({realm:l,providerId:i,alias:e,tab:"mappers"})}),children:a("cancel")})]})]})]})}export{De as default};
//# sourceMappingURL=AddMapper-CUjbJ1Yh.js.map
