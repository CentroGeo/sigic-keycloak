import{jsx as e,jsxs as b,Fragment as D}from"react/jsx-runtime";import{u as A,a as w,b as T,cX as I,V,l as j,M as B,n as J,Y as W,aq as H,h as E,o as X,p as Y,eS as K,d as $,q as z,P as _,w as G,aT as O,L as N,ce as x,C as Q,b_ as Z,T as k,bk as ee,eT as ae,eU as te,aI as P,aJ as L,D as q,aj as M,aW as re}from"./main-Dml5vH_M.js";import{useState as d}from"react";import{u as le}from"./ConfirmDialog-BN0phSta.js";import{V as ne}from"./ViewHeader-CnGpO8mW.js";import{t as oe}from"./translationFormatter-DtFomvax.js";import{F as se}from"./FormAccess-Dgk035ov.js";import{J as ie}from"./JsonFileUpload-BQS_emFV.js";import{D as ce}from"./SwitchControl-DVIXTwQM.js";import"react-dom";import"./FileUploadForm-C-SwY-TA.js";import"./CodeEditor-C7HQ48Ys.js";import"./FileUpload-B3CkDAbJ.js";function me({onClose:t}){const{adminClient:i}=A(),{t:r}=w(),n=T(),{refresh:l,whoAmI:o}=I(),{addAlert:C,addError:c}=V(),[u,v]=d(),h=j({mode:"onChange"}),{handleSubmit:f,setValue:y,formState:p}=h,S=m=>{const a={id:"",realm:"",enabled:!0};X(m||a,y),v(m||a)},g=async m=>{try{await i.realms.create({...u,...Y(m)}),C(r("saveRealmSuccess")),l(),t(),n(K({realm:m.realm}))}catch(a){c("saveRealmError",a)}};return e(B,{variant:"medium",title:r("createRealm"),description:r("realmExplain"),onClose:t,isOpen:!0,actions:[e(H,{form:"realm-form","data-testid":"create",formState:p,allowInvalid:!0,allowNonDirty:!0,children:r("create")},"confirm"),e(E,{variant:"link",onClick:t,"data-testid":"cancel",children:r("cancel")},"cancel")],children:e(J,{...h,children:b(se,{id:"realm-form",isHorizontal:!0,onSubmit:f(g),role:"view-realm",isReadOnly:!o.canCreateRealm(),children:[e(ie,{id:"kc-realm-filename",allowEditingUploadedText:!0,onChange:S}),e(W,{name:"realm",label:r("realmNameField"),rules:{required:r("required")}}),e(ce,{name:"enabled",label:r("enabled"),defaultValue:!0})]})})})}const de=()=>{const{t}=w(),[i,r]=d(!1),n=te();return n.length<3?null:e(P,{shouldFocusToggleOnSelect:!0,onOpenChange:l=>r(l),toggle:l=>e(M,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:l,onClick:()=>r(!i),children:t("recentRealms")}),isOpen:i,children:e(L,{children:n.map(({name:l})=>e(q,{component:o=>e(N,{...o,to:x({realm:l})}),children:l},"server info"))})})},ue=({onClick:t,isDisabled:i})=>{const{t:r}=w(),[n,l]=d(!1);return e(P,{shouldFocusToggleOnSelect:!0,onOpenChange:o=>l(o),toggle:o=>e(M,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:o,onClick:()=>l(!n),variant:"plain",isDisabled:i,children:e(re,{})}),isOpen:n,children:e(L,{children:e(q,{"data-testid":"delete",onClick:()=>{l(!1),t()},children:r("delete")})})})};function Fe(){const{t}=w(),i=T(),{whoAmI:r}=I(),{realm:n}=$(),{adminClient:l}=A(),{addAlert:o,addError:C}=V(),[c,u]=d([]),[v,h]=d(!1),[f,y]=d(0),p=()=>y(f+1),S=async(a,s,U)=>{try{return(await ee(l,"ui-ext/realms/names",{first:`${a}`,max:`${s}`,search:U||""})).map(F=>({...F,id:F.name}))}catch(R){if(R instanceof ae&&R.response.status<500)return[];throw R}},[g,m]=le({titleKey:t("deleteConfirmRealm",{count:c.length,name:c[0]?.name}),messageKey:"deleteConfirmRealmSetting",continueButtonLabel:"delete",onConfirm:async()=>{try{c.filter(({name:s})=>s==="master").length>0&&o(t("cantDeleteMasterRealm"),z.warning);const a=c.filter(({name:s})=>s!=="master");if(a.length===0)return;await Promise.all(a.map(({name:s})=>l.realms.del({realm:s}))),o(t("deletedSuccessRealmSetting")),c.filter(({name:s})=>s===n).length>0&&i(K({realm:"master"})),p(),u([])}catch(a){C("deleteError",a)}}});return b(D,{children:[e(m,{}),v&&e(me,{onClose:()=>{h(!1),p()}}),e(ne,{titleKey:"manageRealms",divider:!1}),e(_,{variant:"light",className:"pf-v5-u-p-0",children:e(G,{loader:S,isPaginated:!0,onSelect:u,canSelectAll:!0,ariaLabelKey:"selectRealm",searchPlaceholderKey:"search",actions:[{title:t("delete"),onRowClick:a=>{u([a]),g()}}],toolbarItem:b(D,{children:[e(k,{children:r.canCreateRealm()&&e(E,{onClick:()=>h(!0),"data-testid":"add-realm",children:t("createRealm")})}),e(k,{children:e(de,{})}),e(k,{children:e(ue,{onClick:g,isDisabled:c.length===0})})]}),columns:[{name:"name",transforms:[O(20)],cellRenderer:({name:a})=>a!==n?e(N,{to:x({realm:a}),children:a}):e(Q,{bodyContent:t("currentRealmExplain"),triggerAction:"hover",children:b(D,{children:[a," ",e(Z,{isRead:!0,children:t("currentRealm")})]})})},{name:"displayName",transforms:[O(80)],cellFormatters:[oe(t)]}]},f)})]})}export{Fe as default};
//# sourceMappingURL=RealmSection-CZO8bowW.js.map
