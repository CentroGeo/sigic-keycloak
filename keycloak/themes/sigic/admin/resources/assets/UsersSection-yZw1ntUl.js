import{jsx as e,jsxs as l,Fragment as k}from"react/jsx-runtime";import{V as Ce}from"./ViewHeader-CnGpO8mW.js";import{a as D,aI as me,aJ as he,aj as be,D as H,V as pe,l as Ue,f9 as Te,E as M,G as L,H as $,aS as Ne,bu as fe,bv as z,a1 as ne,h as F,eN as xe,N as Ie,ca as Se,A as De,B as J,bn as we,bo as Ee,ai as Fe,cd as ie,q,aO as ge,T as E,aW as Ke,cy as Pe,e1 as Ve,u as Re,d as X,b as Oe,j as _e,fa as Be,eT as Le,y as qe,w as je,aU as Q,a6 as Ge,a7 as We,a9 as $e,f as He,L as Me,bR as ze,aH as ye,b8 as Qe,fb as Je,ap as le,bQ as Xe,az as Ye,U as Ze,W as et,a$ as tt,b0 as rt,al as at,P as st,dO as oe}from"./main-Dml5vH_M.js";import{P as nt}from"./PermissionTab-DRVls294.js";import{useState as p}from"react";import{u as ce}from"./ConfirmDialog-BN0phSta.js";import{a as it}from"./AddRoleMappingModal-FlNvMd3n.js";import{F as lt}from"./filter-icon-BO7Evf9d.js";import{D as ot}from"./DropdownPanel-CdQAMxBj.js";import{W as Ae}from"./warning-triangle-icon-DjlHdM0O.js";import{u as ct,R as ut}from"./RoutableTabs-D0MTj5jQ.js";/* empty css                     */import{a as ue,b as de}from"./Tabs-swfKYDgo.js";import"react-dom";import"./useLocaleSort-DeXbTEE9.js";import"./Trans-BHLWmjXF.js";import"./translationFormatter-DtFomvax.js";import"./PageHandler-BQ1_55gR.js";import"./DynamicComponents-Cxsqsl9R.js";import"./ClientSelect-DJq4F1jh.js";import"./FileUpload-B3CkDAbJ.js";import"./GroupPickerDialog-eQJqBPQt.js";import"./DataListItemRow-B3J1tfyO.js";import"./KeySelect-Ba6sDuzD.js";import"./MultiLineInput-BnUu5qtj.js";import"./CodeEditor-C7HQ48Ys.js";import"./useParams-Cmi1OAEj.js";import"./constants-BclHbWtx.js";const dt=({searchType:r,onSelect:a})=>{const{t:c}=D(),[m,b]=p(!1),n=i=>e(H,{onClick:()=>{a(i),b(!1)},children:c(`searchType.${i}`)},i),A=[n("default"),n("attribute")];return e(me,{className:"keycloak__users__searchtype",onOpenChange:i=>b(i),toggle:i=>e(be,{"data-testid":"user-search-toggle",ref:i,id:"toggle-id",onClick:()=>b(!m),icon:e(lt,{}),children:c(`searchType.${r}`)}),isOpen:m,children:e(he,{children:A})})};function mt({activeFilters:r,setActiveFilters:a,profile:c,createAttributeSearchChips:m,searchUserWithAttributes:b}){const{t:n}=D(),{addAlert:A}=pe(),[i,N]=p(!1),w={name:"",displayName:"",value:""},{getValues:o,register:f,reset:x,formState:{errors:h},setValue:K,setError:I,clearErrors:V,control:u}=Ue({mode:"onChange",defaultValues:w}),d=()=>r.userAttribute.some(t=>t.name===o().name),C=()=>{let t=!1;return o().name.length?r.userAttribute.some(v=>v.name===o().name)?I("name",{type:"conflict",message:n("searchUserByAttributeKeyAlreadyInUseError")}):t=!0:I("name",{type:"empty",message:n("searchUserByAttributeMissingKeyError")}),t},U=()=>{let t=!1;return o().value.length?t=!0:I("value",{type:"empty",message:n("searchUserByAttributeMissingValueError")}),t},R=()=>C()&&U(),T=()=>{R()?(a({exact:o().exact,userAttribute:[...r.userAttribute,{...o()}]}),x({exact:o().exact})):(h.name?.message&&A(h.name.message,q.danger),h.value?.message&&A(h.value.message,q.danger))},P=()=>{const t=[...r.userAttribute].filter(v=>v.name!==v.name);a({exact:o().exact,userAttribute:t})},O=()=>c?e(we,{"data-testid":"search-attribute-name-select",variant:Ee.typeahead,onToggle:t=>N(t),selections:o().displayName,onSelect:t=>{K("displayName",t.toString()),d()?I("name",{type:"conflict"}):V("name")},isOpen:i,placeholderText:n("selectAttribute"),validated:h.name&&"error",maxHeight:300,...f("displayName",{required:!0,validate:C}),children:c.attributes?.map(t=>e(Fe,{value:ie(n,t.displayName,t.name),onClick:v=>{v.stopPropagation(),N(!1),K("name",t.name)},children:ie(n,t.displayName,t.name)},t.name))}):e(ne,{id:"name",placeholder:n("keyPlaceholder"),validated:h.name&&"error",onKeyDown:t=>t.key==="Enter"&&T(),...f("name",{required:!0,validate:C})});return l(Te,{className:"user-attribute-search-form","data-testid":"user-attribute-search-form",children:[e(M,{className:"user-attribute-search-form-headline",children:e(L,{component:$.h2,children:n("selectAttributes")})}),e(Ne,{isInline:!0,className:"user-attribute-search-form-alert",variant:"info",title:n("searchUserByAttributeDescription"),component:"h3"}),l(M,{className:"user-attribute-search-form-key-value",children:[e("div",{className:"user-attribute-search-form-left",children:e(L,{component:$.h3,children:n("key")})}),e("div",{className:"user-attribute-search-form-right",children:e(L,{component:$.h3,children:n("value")})})]}),e("div",{className:"user-attribute-search-form-left",children:O()}),e("div",{className:"user-attribute-search-form-right",children:l(fe,{children:[e(z,{children:e(ne,{id:"value",placeholder:n("valuePlaceholder"),validated:h.value&&"error",onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),T())},...f("value",{required:!0,validate:U})})}),e(z,{children:e(F,{"data-testid":"user-attribute-search-add-filter-button",variant:"control",icon:e(xe,{}),onClick:T,"aria-label":n("addToFilter")})})]})}),m(),e("div",{className:"pf-v5-u-pt-lg",children:e(Ie,{name:"exact",defaultValue:!1,control:u,render:({field:t})=>e(Se,{id:"exact","data-testid":"exact",label:n("exactSearch"),isChecked:t.value,onChange:t.onChange})})}),l(De,{className:"user-attribute-search-form-action-group",children:[e(F,{"data-testid":"search-user-attribute-btn",variant:"primary",type:"submit",isDisabled:!r.userAttribute.length,onClick:b,children:n("search")}),e(F,{variant:J.link,onClick:()=>{x(),P()},children:n("reset")})]})]})}function ht({searchDropdownOpen:r,setSearchDropdownOpen:a,realm:c,hasSelectedRows:m,toggleDeleteDialog:b,toggleUnlockUsersDialog:n,goToCreate:A,searchType:i,setSearchType:N,searchUser:w,setSearchUser:o,activeFilters:f,setActiveFilters:x,refresh:h,profile:K,clearAllFilters:I,createAttributeSearchChips:V,searchUserWithAttributes:u}){const{t:d}=D(),[C,U]=p(!1),{hasAccess:R}=ge(),T=R("query-users"),P=()=>e(E,{children:l(fe,{children:[e(z,{children:e(dt,{searchType:i,onSelect:g=>{I(),N(g)}})}),i==="default"&&O(),i==="attribute"&&t()]})}),O=()=>e(E,{children:e(Pe,{"data-testid":"table-search-input",placeholder:d("searchForUser"),"aria-label":d("search"),value:w,onSearch:(g,_,G)=>{o(G.haswords),h()},onKeyDown:g=>{if(g.key==="Enter"){const _=g.target;o(_.value),h()}},onClear:()=>{o(""),h()}})}),t=()=>l(k,{children:[e(ot,{"data-testid":"select-attributes-dropdown",buttonText:d("selectAttributes"),setSearchDropdownOpen:a,searchDropdownOpen:r,width:"15vw",children:e(mt,{activeFilters:f,setActiveFilters:x,profile:K,createAttributeSearchChips:V,searchUserWithAttributes:()=>{u(),a(!1)}})}),e(F,{icon:e(Ve,{}),variant:"control",onClick:()=>{u(),a(!1)},"aria-label":d("searchAttributes")})]}),v=c.bruteForceProtected?e(E,{children:e(me,{onOpenChange:g=>U(g),toggle:g=>e(be,{ref:g,isExpanded:C,variant:"plain",onClick:()=>U(!C),children:e(Ke,{})}),isOpen:C,shouldFocusToggleOnSelect:!0,children:l(he,{children:[e(H,{component:"button",isDisabled:m,onClick:()=>{b(),U(!1)},children:d("deleteUser")},"deleteUser"),e(H,{component:"button",onClick:()=>{n(),U(!1)},children:d("unlockAllUsers")},"unlock")]})})}):e(E,{children:e(F,{variant:J.link,onClick:b,"data-testid":"delete-user-btn",isDisabled:m,children:d("deleteUser")})}),j=l(k,{children:[e(E,{children:e(F,{"data-testid":"add-user",onClick:A,children:d("addUser")})}),v]});return l(k,{children:[P(),T?j:null]})}const bt=r=>{const{t:a}=D(),{realm:c}=X();return l(k,{children:[l(Me,{to:ze({realm:c,id:r.id,tab:"settings"}),children:[r.username,e(pt,{user:r})]}),r.attributes?.is_temporary_admin[0]==="true"&&e(ye,{content:a("temporaryAdmin"),children:e(Ae,{className:"pf-v5-u-ml-sm",id:"temporary-admin-label"})})]})},pt=({user:r})=>{const{t:a}=D();return l(k,{children:[!r.enabled&&e(le,{color:"red",icon:e(Xe,{}),children:a("disabled")}),r.bruteForceStatus?.disabled&&e(le,{color:"orange",icon:e(Ae,{}),children:a("temporaryLocked")})]})},ft=r=>{const{t:a}=D();return l(k,{children:[!r.emailVerified&&e(ye,{content:a("notVerified"),children:e(Qe,{className:"keycloak__user-section__email-verified"})})," ",Q()(r.email)]})};function gt(){const{adminClient:r}=Re(),{t:a}=D(),{addAlert:c,addError:m}=pe(),{realm:b,realmRepresentation:n}=X(),A=Oe(),[i,N]=p({}),[w,o]=p(""),[f,x]=p([]),[h,K]=p("default"),[I,V]=p(!1),[u,d]=p({exact:!1,userAttribute:[]}),[C,U]=p({}),[R,T]=p(""),[P,O]=p(0),t=()=>O(P+1);_e(async()=>{try{return await Promise.all([Be(r),r.users.getProfile()])}catch(s){if(s instanceof Le&&s?.response?.status===403)return[{},{}];throw s}},([s,y])=>{N(s),U(y)},[]);const v=async(s,y,ae)=>{const S={first:s,max:y,q:R},B=ae||w||"";if(B&&(S.search=B),u.exact&&(S.exact=!0),!Z&&!(S.search||S.q))return[];try{return await it(r,{briefRepresentation:!0,...S})}catch(se){return i.userProfileProvidersEnabled?m("noUsersFoundErrorStorage",se):m("noUsersFoundError",se),[]}},[j,g]=ce({titleKey:"unlockAllUsers",messageKey:"unlockUsersConfirm",continueButtonLabel:"unlock",onConfirm:async()=>{try{await r.attackDetection.delAll(),t(),c(a("unlockUsersSuccess"),q.success)}catch(s){m("unlockUsersError",s)}}}),[_,G]=ce({titleKey:a("deleteConfirmUsers",{count:f.length,name:f[0]?.username}),messageKey:a("deleteConfirmDialog",{count:f.length}),continueButtonLabel:"delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{for(const s of f)await r.users.del({id:s.id});x([]),W(),c(a("userDeletedSuccess"),q.success)}catch(s){m("userDeletedError",s)}}}),Y=()=>A(Je({realm:b}));if(!i||!n)return e(qe,{});const Z=!i.userProfileProvidersEnabled,W=()=>{d({exact:!1,userAttribute:[]}),o(""),T(""),t()},ee=s=>s.userAttribute.map(y=>`${y.name}:${y.value}`).join(" "),ve=()=>{const s=ee(u);T(s),t()},te=()=>e(Ye,{children:u.userAttribute.length>0&&e(k,{children:Object.values(u.userAttribute).map(s=>e(Ze,{className:"pf-v5-u-mt-md pf-v5-u-mr-md","data-testid":"user-attribute-search-chips-group",categoryName:s.displayName.length?s.displayName:s.name,isClosable:!0,onClick:y=>{y.stopPropagation();const S={userAttribute:[...u.userAttribute].filter(B=>B.name!==s.name),exact:u.exact};d(S),T(ee(S)),t()},children:e(et,{isReadOnly:!0,children:s.value},s.name)},s.name))})}),re=()=>e(ht,{searchDropdownOpen:I,setSearchDropdownOpen:V,realm:n,hasSelectedRows:f.length===0,toggleDeleteDialog:_,toggleUnlockUsersDialog:j,goToCreate:Y,searchType:h,setSearchType:K,searchUser:w,setSearchUser:o,activeFilters:u,setActiveFilters:d,refresh:t,profile:C,clearAllFilters:W,createAttributeSearchChips:te,searchUserWithAttributes:ve}),ke=()=>{if(u.userAttribute.length)return l("div",{className:"user-attribute-search-form-subtoolbar",children:[e(E,{children:te()}),e(E,{children:e(F,{variant:"link",onClick:()=>{W()},children:a("clearAllFilters")})})]})};return l(k,{children:[e(G,{}),e(g,{}),e(je,{isSearching:w!==""||u.userAttribute.length!==0,loader:v,isPaginated:!0,ariaLabelKey:"titleUsers",canSelectAll:!0,onSelect:s=>x([...s]),emptyState:Z?e(He,{message:a("noUsersFound"),instructions:a("emptyInstructions"),primaryActionText:a("createNewUser"),onPrimaryAction:Y}):l(k,{children:[e(Ge,{children:e(We,{children:re()})}),e($e,{"data-testid":"empty-state",variant:"lg",children:e(M,{className:"kc-search-users-text",children:e(L,{children:a("searchForUserDescription")})})})]}),toolbarItem:re(),subToolbar:ke(),actionResolver:s=>{const y=s.data;return y.access?.manage?[{title:a("delete"),onClick:()=>{x([y]),_()}}]:[]},columns:[{name:"username",displayKey:"username",cellRenderer:bt},{name:"email",displayKey:"email",cellRenderer:ft},{name:"lastName",displayKey:"lastName",cellFormatters:[Q()]},{name:"firstName",displayKey:"firstName",cellFormatters:[Q()]}]},P)]})}function Ht(){const{t:r}=D(),{realm:a}=X(),{hasAccess:c}=ge(),b=tt()(rt.AdminFineGrainedAuthz)&&c("manage-authorization","manage-users","manage-clients"),n=N=>ct(oe({realm:a,tab:N})),A=n("list"),i=n("permissions");return l(k,{children:[e(Ce,{titleKey:"titleUsers",subKey:"usersExplain",helpUrl:at.usersUrl,divider:!1}),e(st,{"data-testid":"users-page",variant:"light",className:"pf-v5-u-p-0",children:l(ut,{"data-testid":"user-tabs",defaultLocation:oe({realm:a,tab:"list"}),isBox:!0,mountOnEnter:!0,children:[e(ue,{id:"list","data-testid":"listTab",title:e(de,{children:r("userList")}),...A,children:e(gt,{})}),b&&e(ue,{id:"permissions","data-testid":"permissionsTab",title:e(de,{children:r("permissions")}),...i,children:e(nt,{type:"users"})})]})})]})}export{Ht as default};
//# sourceMappingURL=UsersSection-yZw1ntUl.js.map
