import{jsx as e,jsxs as o,Fragment as x}from"react/jsx-runtime";import{u as J,a as Q,b as U,l as W,bl as X,V as Z,e as _,j as ee,B as te,q as k,ep as w,el as T,y as ie,D as re,ap as ae,P as oe,n as le,Y as se,aK as ne,A as ce,h as d,L as P,ay as de,az as L,G as F,H as V,O as S,ac as me,eq as ue,er as fe,a8 as pe}from"./main-Dml5vH_M.js";import{useState as h,useMemo as xe,Fragment as Pe}from"react";import{u as he}from"./ConfirmDialog-BN0phSta.js";import{F as Ce}from"./FormAccess-Dgk035ov.js";import{V as be}from"./ViewHeader-CnGpO8mW.js";import{u as ge}from"./useParams-Cmi1OAEj.js";/* empty css                               */import{D as ve,a as ye,b as ke,c as Te,d as Ee}from"./DataListItemRow-B3J1tfyO.js";import{T as De}from"./trash-icon-sFYD2cXL.js";import"react-dom";const Ie={name:"",description:"",executors:[]};function Ke(){const{adminClient:p}=J(),{t}=Q(),C=U(),E=W({defaultValues:Ie,mode:"onChange"}),{handleSubmit:A,setValue:b,getValues:H,formState:{isDirty:D},control:q}=E,{fields:g,remove:B}=X({name:"executors",control:q}),{addAlert:v,addError:y}=Z(),[m,G]=h(),[a,K]=h(!1),{realm:n,profileName:l}=ge(),j=_(),O=xe(()=>j.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,$]=h(),c=!!l,[I,z]=h(0),M=()=>z(I+1);ee(()=>p.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{G({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(f=>f.name!==l)});const s=i.globalProfiles?.find(f=>f.name===l),r=i.profiles?.find(f=>f.name===l);K(s!==void 0),b("name",s?.name??r?.name??""),b("description",s?.description??r?.description??""),b("executors",s?.executors??r?.executors??[])},[I]);const R=async i=>{const s=i;try{await p.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),v(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),k.success),C(w({realm:n,profileName:i.name}))}catch(r){y(c?"updateClientProfileError":"createClientProfileError",r)}},[N,Y]=he({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{if(u?.name){B(u.idx);try{await p.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],H()]}),v(t("deleteExecutorSuccess"),k.success),C(w({realm:n,profileName:l}))}catch(i){y("deleteExecutorError",i)}}else try{await p.clientPolicies.createProfiles(m),v(t("deleteClientSuccess"),k.success),C(T({realm:n,tab:"profiles"}))}catch(i){y("deleteClientError",i)}}});return m?o(x,{children:[e(Y,{}),e(be,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:a?e(ae,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!a?[e(re,{value:"delete",onClick:N,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(oe,{variant:"light",children:e(le,{...E,children:o(Ce,{isHorizontal:!0,role:"view-realm",className:"pf-v5-u-mt-lg",children:[e(se,{name:"name",label:t("newClientProfileName"),helperText:t("createClientProfileNameHelperText"),readOnly:a,rules:{required:t("required")}}),e(ne,{name:"description",label:t("description"),readOnly:a}),o(ce,{children:[!a&&e(d,{variant:"primary",onClick:()=>A(R)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!a&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:M,children:t("reload")}),!c&&!a&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:T({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&o(x,{children:[o(de,{children:[e(L,{children:o(F,{className:"kc-executors",component:V.h1,children:[t("executors"),e(S,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!a&&e(L,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:ue({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(me,{}),children:t("addExecutor")})})]}),g.length>0&&o(x,{children:[e(ve,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,s)=>e(ye,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(ke,{"data-testid":"executors-list-row",children:e(Te,{dataListCells:[o(Ee,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:r=>e(P,{...r,to:fe({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),O?.filter(r=>r.id===i.executor).map(r=>o(Pe,{children:[e(S,{helpText:r.helpText,fieldLabelId:"executorTypeTextHelpText"},r.id),!a&&e(d,{"data-testid":`deleteExecutor-${r.id}`,variant:"link",isInline:!0,icon:e(De,{className:"kc-executor-trash-icon"},`executorType-trash-icon-${r.id}`),onClick:()=>{N(),$({idx:s,name:r.id})},"aria-label":t("remove")})]},r.id))]},"executor")]})})},i.executor))}),a&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:T({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&o(x,{children:[e(pe,{}),e(F,{className:"kc-emptyExecutors",component:V.h2,children:t("emptyExecutors")})]})]})]})})})]}):e(ie,{})}export{Ke as default};
//# sourceMappingURL=ClientProfileForm-C4YWg3fD.js.map
